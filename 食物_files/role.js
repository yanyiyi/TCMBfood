var rolejs="here",role_param={unit:"",end:""},member_role={submit_process_status:"",submit_status_helper:function(e){this.submit_process_status=e?e+" processing":""},keep_tag_panel_push:function(e){this.keep_tag_row_push(),$("#tagForm").modal("show");var t="",a="",i=$(e).closest("[data-indexcode]").data("dataObj");i&&(i.IndexCode&&(t=i.IndexCode),i.Id&&(a=i.Id)),t||(t=$(e).closest("[data-indexcode]").attr("data-indexcode")),a||(a=$(e).closest("[data-indexcode]").attr("data-id")),dq(".taglist").setAttribute("data-source",t),dq(".taglist").setAttribute("data-source_id",a),this.keep_tag_checked_push()},keep_tag_row_push:function(e){e||(e=JSON.parse(dqv("#hd_account_tag")));var t="";t="<p>所有標籤</p>",$(e).each(function(){t+="<li data-tag_id='"+this.id+"'>",t+="<label for='chkID"+this.id+"'><input type='checkbox' id='chkID"+this.id+"' name='chkID"+this.id+"' class='check'>標籤選取</label>",t+="<label for='tagID"+this.id+"'></label>",t+="<input type='text' id='tagID"+this.id+"' name='tag_name' value='"+this.tag+"' class='taginput'>",t+="<button type='button' onclick='member_role.keep_tag_remove(this)' class='close'>×</button>",t+="</li>"}),dq(".taglist").innerHTML=t,$(".taglist input").iCheck({radioClass:"formRadio",checkboxClass:"formCheck"}),$(".taglist").overlayScrollbars({className:"os-theme-block-dark",resize:"none",sizeAutoCapable:!0,paddingAbsolute:!0})},keep_tag_checked_push:function(){var e=dq(".taglist").getAttribute("data-source"),t=dq(".taglist").getAttribute("data-source_id"),a=dq("[data-indexcode='"+e+"'][data-id='"+t+"']");if(a){var i=$(a).data("dataObj");if(!i)return;$(".taglist").find("[type=checkbox]").each(function(){if(i.Tag){var e=i.Tag.split(","),t=$(this).closest("li").attr("data-tag_id");t&&e.indexOf(t)>-1&&$(this).iCheck("check")}})}},keep_tag_submit:async function(){if(confirm("確認送出設定?")&&!this.submit_process_status){this.submit_status_helper("keep_tag_submit");var e=dqv("#hd_login_account"),t=[];$(".taglist").find("[data-tag_id]").each(function(){var e=this.getAttribute("data-tag_id"),a=this.querySelector("[name=tag_name]").value;"0"==e&&(a=a+","+this.querySelector("[name=tag_name]").id.replace("tagID",""));t.push({id:e,tag:a})}),cl("tags",t),cl("this.keep_tag_rmIDs",this.keep_tag_rmIDs);var a=await ajax_post("/Home","KeepTagUpdate",{account:e,tags:t,rmIDs:this.keep_tag_rmIDs});if(cl("ret",a),a.hasData){var i=a.data1,r=a.data2;cl("newTagDic",r),dq("#hd_account_tag").value=JSON.stringify(i),r&&$(r).each(function(){var e=this.split(":")[0],t=this.split(":")[1],a=dq("#tagID"+t);cl("DOM",a),a&&$(a).closest("[data-tag_id]").attr("data-tag_id",e)});var l=[],o=$(".taglist").find("[type='checkbox']:checked");$(o).each(function(){var e=$(this).closest("li").attr("data-tag_id");e&&l.push(e)}),cl("tagArr",l);var n=$(".taglist").attr("data-source");cl("source",n);var s=$(".taglist").attr("data-source_id");if(cl("source_id",s),n&&s){a=await ajax_post("/Home","KeepTagSet",{account:e,source:n,source_id:s,tagArr:l});var d=dq("[data-indexcode='"+n+"'][data-id='"+s+"']");if(cl("row",d),d){var c=$(d).data("dataObj");c&&(c.Tag=l.join(","),$(d).data("dataObj",c),$("[data-row=db_row]").each(function(){var e=$(this).data("dataObj"),t=this.querySelector(".tag");if(t){var a="素材標籤 :";if(e.Tag){var i=e.Tag.split(","),r=JSON.parse(dqv("#hd_account_tag"));$(r).each(function(){i.indexOf(this.id.toString())>-1&&(a+="<a href='javascript:;'>#"+this.tag+"</a>")})}t.innerHTML=a}}))}}$("#tagForm").modal("hide"),this.submit_status_helper()}else this.submit_status_helper()}},keep_tag_rmIDs:[0],keep_tag_remove:async function(e){if(confirm("確認移除此標籤?")){var t=$(e).closest("[data-tag_id]")[0],a=t.getAttribute("data-tag_id");"0"!=a&&this.keep_tag_rmIDs.push(a),$(t).remove()}},keep_tag_add:async function(){if(!this.submit_process_status){this.submit_status_helper("keep_tag_add");var e=(new Date).getTime(),t=(dq(".taglist").innerHTML,"");t+="<li data-tag_id='0'>",t+="<label for='chkID"+e+"'><input type='checkbox' id='chkID"+e+"' name='chkID"+e+"' class='check'>標籤選取</label>",t+="<label for='tagID"+e+"'></label>",t+="<input type='text' id='tagID"+e+"' name='tag_name' value='新標籤' class='taginput'>",t+="<button type='button' onclick='member_role.keep_tag_remove(this)' class='close'>×</button>",t+="</li>",$(".taglist").append(t),$("#chkID"+e).iCheck({radioClass:"formRadio",checkboxClass:"formCheck"}),$(".taglist").overlayScrollbars({className:"os-theme-block-dark",resize:"none",sizeAutoCapable:!0,paddingAbsolute:!0}),this.submit_status_helper()}},keep_record_add:async function(e,t,a){(await ajax_post("/Home","KeepRecordAdd",{source:e,source_id:t,did:a})).isSuccess&&window.alert("已加入收藏！")},keep_record_remove:async function(e,t,a){(await ajax_post("/Home","KeepRecordRemove",{source:e,source_id:t,did:a})).isSuccess&&window.alert("已從收藏移除！")},logout:async function(){if(confirm("確認登出?")){await ajax_post("/CultureMemory","Logout");var e=document.querySelector("#hd_memberSSOHost").value,t=window.open(e+"MOCMC/M0003/ajLogout","Logout");t.close&&t.close(),location="/Home/Index"}}},create_role={role_name:"create_role",submit_process_status:"",submit_status_helper:function(e){this.submit_process_status=e?e+" processing":""},story_chapter_remove_ids:[],story_keep_page_process:async function(){var e=getReq("Keyword"),t=getReq("Tag");e?this.story_collect_keyword_list_push():t?this.story_collect_tag_list_push():await this.story_collect_list_push(),await this.material_collect_count_push(),material_role.keep_list_doc_view_helper();for(var a=dqa("[name=Title]"),i=0;i<a.length;i++)material_role.keep_detail_check(a[i])},material_keep_page_process:async function(){var e=getReq("Keyword"),t=getReq("Tag");e?this.material_collect_keyword_list_push():t?this.material_collect_tag_list_push():await this.material_collect_list_push(),await this.story_collect_count_push(),material_role.keep_list_doc_view_helper();for(var a=dqa("[name=Title]"),i=0;i<a.length;i++)material_role.keep_detail_check(a[i])},story_create:async function(){var e=JSON.parse(dqv("#hd_story_obj"));e.file_id=await ajax_post("/Basic","GetNewFileID"),(e=common_role.output_data_process_controller(null,"DataObjInit",e,null)).memo="draft";var t=await ajax_post("/Create","StorySave",e);t.isSuccess&&(location="/Create/StoryForm?id="+t.data1.id+"&mode=new")},material_create:async function(e,t){var a=JSON.parse(dqv("#hd_material_obj"));a.file_id=await ajax_post("/Basic","GetNewFileID"),(a=common_role.output_data_process_controller(null,"DataObjInit",a,null)).memo="draft";var i=await ajax_post("/Create","MaterialSave",[a]);cl("ret",i),i.isSuccess&&(e||(location="/Create/MaterialUpload?id="+i.data1[0].id+"&mode=new"),"new"==e&&(dq("#go_to_material_page").href="/Create/MaterialUpload?id="+i.data1[0].id+"&mode=new",dq("#go_to_material_page").click()))},keep_material_upload:async function(e){var t=JSON.parse(dqv("#hd_material_obj"));t.file_id=await ajax_post("/Basic","GetNewFileID"),(t=common_role.output_data_process_controller(null,"DataObjInit",t,null)).memo="draft",$(e).closest("[data-file_area]").data("dataObj",t),file_upload_data_init($(e).closest(".fileData"),t.file_id)},keep_window_push:async function(e){var t=[],a=JSON.parse(dqv("#hd_kr_data"));if((n=dq("#hd_infos_temp"))&&n.value)t=JSON.parse(n.value);else{var i=JSON.parse(dqv("#hd_my_material"));$(i).each(function(){var e=a.filter(e=>e.source==this.IndexCode&&e.source_id==this.Id);e=e.length>0?e[0].note:"",t.push({Id:this.id,Title:this.title,Rights:this.img_rights.split("@#@")[0],ImageUrl:this.material_image_url.split(";")[0],IndexCode:"member_material",Tag:e})});var r=JSON.parse(dqv("#hd_story_indexcode")),l=JSON.parse(dqv("#hd_keep_q"));if(l.UserId=dqv("#hd_login_account"),l.IndexList=[],indexconfig)for(var o=0;o<indexconfig.length;o++)-1==r.indexOf(indexconfig[o].IndexCode)&&l.IndexList.push(indexconfig[o].IndexCode);l.PageSize=1e3;var n,s=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(l)});if(!s||s.Error)return;s.JsonData=JSON.parse(s.JsonData),cl("keep_window_push => SearchList => $ret",s),s&&!s.Error&&$(s.JsonData.ResultData).each(function(){this.ImageUrl=this.ImageUrl.split(" / ")[0],this.ImageUrl=this.ImageUrl.split(";")[0],this.ImageUrl||(this.ImageUrl="/Content/nrch/images/nopic.png");var e=t.filter(e=>e.IndexCode==this.IndexCode&&e.Id==this.Id);if(this.Title&&this.Rights&&"僅限公開瀏覽"!=this.Rights&&0==e.length){var i=a.filter(e=>e.source==this.IndexCode&&e.source_id==this.Id);i=i.length>0?i[0].note:"",this.Tag=i||"",t.push(this)}}),(n=dq("#hd_infos_temp"))&&(n.value=JSON.stringify(t))}if(e){$(e).closest(".tagNav").find("[data-tag_id]").each(function(){this.setAttribute("class","")}),$(e).attr("class","active");var d=e.getAttribute("data-tag_id");d&&(t=t.filter(e=>e.Tag.split(",").indexOf(d)>-1))}cl("keep_window_push infos",t);var c=dq("#keep_form");if(c){$(c).find("[data-row=db_row]").each(function(){$(this).remove()});var _=c.querySelector("[data-row=temp_row]");$(t).each(function(e,t){var a=$(_).clone();t=common_role.output_data_process_controller(null,"DataObjInit",t,null),a.attr("style",""),a.attr("data-row","db_row");var i=a[0].querySelector("input");i&&(i.id="mt"+t.Id);var r=a[0].querySelector("label");if(r&&r.setAttribute("for","mt"+t.Id),t.ImageUrl){a[0].querySelector("img").src=t.ImageUrl;var l=getImgUrlExten(t.ImageUrl);audioAllowFormat.indexOf(l)>-1?a[0].querySelector("img").src=doc_icon_helper(t.ImageUrl):(videoAllowFormat.indexOf(l)>-1||t.ImageUrl.indexOf("imedia.culture.tw/iframe")>-1||"Culture_Media"==t.IndexCode||"pdf"==l)&&($(a[0].querySelector("img")).hide(),$(a[0].querySelector(".video")).html(mp4_iframe_helper(t.ImageUrl)),$(a[0].querySelector(".video")).show())}var o=JSON.parse(dqv("#hd_right_list")),n=a[0].querySelector(".cp");if(n){n=n.querySelector("img");var s=t.Rights.split(" / ")[0];if(s&&"NULL"!=s){var d=o.filter(e=>e.tag==s);d.length>0?(d=d[0],n.src="../Content/nrch/images/"+d.icon_name+".png",n.alt="licence:"+d.tag):$(n).remove()}else $(n).remove()}var h=a[0].querySelector(".box-content").querySelector("strong");h&&(h.innerHTML=t.Title),push_form_controller(a[0],t,common_role.form_push_format("default")),$(c).append(a)}),$(".promptbox").overlayScrollbars({className:"os-theme-block-dark",resize:"none",sizeAutoCapable:!0,paddingAbsolute:!0})}},keep_select_change_img_dom:"",keep_select_change_img_dom_helper:function(e){if(e){var t=$(e).closest("[name=cover_img]");t.length>0&&(this.keep_select_change_img_dom=t[0])}},keep_select_confirm:function(e){var t=dq("#keep_form").querySelectorAll("input[name=createpic]:checked");if(!t||t.length<1)$(e).parents(".modal").modal("hide");else{cl("selected",t);var a=t[0],i=$(a).closest("li").data("dataObj");if(i){if(cl("data",i),this.keep_select_change_img_dom){var r=this.keep_select_change_img_dom,l=i.ImageUrl?i.ImageUrl:"../Content/nrch/images/nopic.png",o=getImgUrlExten(l);r.querySelector(".img").setAttribute("style","background-image:url('"+l.replaceAll(" ","%20")+"')"),audioAllowFormat.indexOf(o)>-1?($(r.querySelector(".img")).html(""),$(r.querySelector(".img")).css("background-image","url('"+doc_icon_helper(l)+"')")):"Culture_Media"==i.IndexCode||videoAllowFormat.indexOf(o)>-1||l.indexOf("imedia.culture.tw/iframe")>-1||"pdf"==o?(r.querySelector(".img").setAttribute("style","background-image:url('')"),$(r.querySelector(".img")).html(mp4_iframe_helper(l))):$(r.querySelector(".img")).html(""),r.setAttribute("data-indexcode",i.IndexCode),r.setAttribute("data-identity",i.Id),r.setAttribute("data-url",i.ImageUrl),r.setAttribute("data-right",i.Rights),this.keep_select_change_img_dom=""}$(e).parents(".modal").modal("hide")}else $(e).parents(".modal").modal("hide")}},time_input_switch:function(e){e&&("1"==e&&($("#MaterialDate").closest("li").show(),$("#StoryYea").closest("li").hide()),"2"==e&&($("#MaterialDate").closest("li").hide(),$("#StoryYea").closest("li").show()))},location_input_switch:function(e){e&&("1"==e&&($("#MaterialCity1").closest(".placeWay").show(),$("#popupTrigger").closest(".placeWay").hide()),"2"==e&&($("#MaterialCity1").closest(".placeWay").hide(),$("#popupTrigger").closest(".placeWay").show()))},city_changer:function(e){if(e){var t=e.value,a=$(e).closest("div").find("[name=area]");if(!(a.length<1)&&((a=a[0]).innerHTML="<option value=''>請選擇行政區</option>",t)){for(var i=area_data[t],r="",l=0;l<i.length;l++)r+="<option value='"+i[l]+"'>"+i[l]+"</option>";a.innerHTML+=r}}},collect_material_upload:async function(e,t){if(e){var a=dq("#data_form");if(a){var i=$(a).data("dataObj");dqa("[name=file_info]").length<1&&"未上傳任何檔案";for(var r=document.querySelectorAll("[name=file_info]"),l=0;l<r.length;l++){var o=r[l].querySelector("[name=casepic1]")?r[l].querySelector("[name=casepic1]").value:"",n=r[l].querySelector("[name=authorizeRange1]")?r[l].querySelector("[name=authorizeRange1]").value:"",s=r[l].querySelector("[name=owner]")?r[l].querySelector("[name=owner]").value:"";o&&n&&s||!1}if("temp"==t){await file_command_execute(a),await file_info_save(),await file_sort_save();var d=await ajax_post("/Create","MaterialSave",[i]);cl("ret",d),alert("暫時儲存成功");var c=await ajax_post("/Create","MaterialDataValidate",{id:i.id});cl("validRet",c),c.data1&&alert(c.data2+"\n"+c.data1+"\n"),"new"==getReq("mode")&&(location="/Create/MaterialUpload?id="+getReq("id"))}if("go"==t){await file_command_execute(a),await file_info_save(),await file_sort_save(),await ajax_post("/Create","MaterialSave",[i]);c=await ajax_post("/Create","MaterialDataValidate",{id:i.id});cl("validRet",c),c.data1&&alert(c.data2+"\n"+c.data1+"\n"),location="/Create/MaterialForm?id="+getReq("id")}if("timer"==t){await file_command_execute(a),await file_info_save(),await file_sort_save(),await ajax_post("/Create","MaterialSave",[i]);c=await ajax_post("/Create","MaterialDataValidate",{id:i.id});cl("validRet",c),c.data1&&alert(c.data2+"\n"+c.data1+"\n")}}}},collect_material_info:async function(e,t){if(e){var a=dq("[name=form_area]");if(a){var i=a.querySelectorAll("[data-row=db_row]"),r=[];if($(i).each(function(e,t){r.push(create_role.material_info_pull_helper(t));var a=form_validate(t,"material");if(a.size>0){"填寫不完整\n";for(let e of a.keys()){var i=t.querySelector("[name="+e+"]").getAttribute("data-title");i+"  "+langTrans(a.get(e))+"\n"}"\n"}}),r[0].date_material||r[0].date_material_str||"時間資訊  必填\n",(r[0].city||r[0].area||r[0].area_desc||r[0].lng||r[0].lat)&&(!(r[0].city+r[0].area+r[0].area_desc)||r[0].city&&r[0].area&&r[0].area_desc)||"空間資訊  不完整\n","back"==t&&(await ajax_post("/Create","MaterialSave",r),location="/Create/MaterialUpload?id="+getReq("id")),"temp"==t){await ajax_post("/Create","MaterialSave",r),alert("暫時儲存成功");var l=await ajax_post("/Create","MaterialDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n")}if("go"==t){await ajax_post("/Create","MaterialSave",r);l=await ajax_post("/Create","MaterialDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),location="/Create/MaterialConfirm?id="+getReq("id")}if("timer"==t){await ajax_post("/Create","MaterialSave",r);l=await ajax_post("/Create","MaterialDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n")}}}},material_info_pull_helper:function(e){if(e){var t=$(e).data("dataObj");if(t){t.category=$("#MaterialSubject1").val(),t.category=t.category.toString().replaceAll(",","@#@"),t.city=pull_value_controller(e,"city",t.city),t.area=pull_value_controller(e,"area",t.area),t.title=pull_value_controller(e,"title",t.title),t.intro=pull_value_controller(e,"intro",t.intro),t.rights=pull_value_controller(e,"rights",t.rights,"radio"),t.is_enabled=pull_value_controller(e,"is_enabled",t.is_enabled,"radio"),t.keyword=pull_value_controller(e,"keyword",t.keyword),t.date_material="",t.date_material_str="";var a=pull_value_controller(e,"MaterialTime","1","radio");"1"==a&&(t.date_material=pull_value_controller(e,"date_material",t.date_material),t.date_material_str=""),"2"==a&&(t.date_material_str=pull_value_controller(e,"date_material_str",t.date_material_str),t.date_material=""),t.city="",t.area="",t.area_desc="",t.location="",t.lng="",t.lat="";var i=pull_value_controller(e,"StoryPlace1","1","radio");return"1"==i&&(t.city=pull_value_controller(e,"city",t.city),t.area=pull_value_controller(e,"area",t.area),t.area_desc=pull_value_controller(e,"area_desc",t.area_desc)),"2"==i&&(t.location=dq("[name=location]").innerHTML,t.lng=dq("[name=lng]").innerHTML,t.lat=dq("[name=lat]").innerHTML),t}}},material_selected_file_owner_set:function(){var e=dqa("[name=createpic]:checked");if(0!=e.length){var t=dq("#batchOwner").value,a="";"同創作人"==t&&(a=dqv("#hd_login_name")),"自行輸入"==t&&(a=""),$(e).each(function(){$(this).closest("[name=file_info]").find("[name=owner]").val(a)})}else alert("請先勾選要批次設定的項目")},material_selected_photo_right_set:function(){var e=dqa("[name=createpic]:checked");0!=e.length?$(e).each(function(){$(this).closest("[name=file_info]").find("[name=authorizeRange1]").val(dq("#authorizeRange").value)}):alert("請先勾選要批次設定的項目")},material_selected_photo_exif_set:function(){var e=dqa("[name=createpic]:checked");0!=e.length?$(e).each(function(){$(this).closest("[name=file_info]").find("[name=exif]").val(dq("#ExifRange").value.trim())}):alert("請先勾選要批次設定的項目")},material_selected_photo_name_set:function(){var e=dqa("[name=createpic]:checked");0!=e.length?$(e).each(function(){$(this).closest("[name=file_info]").find("[name=casepic1]").val(dq("#PicName").value.trim())}):alert("請先勾選要批次設定的項目")},material_upload_edit_push:async function(){var e=dq("#data_form"),t=JSON.parse(dqv("#hd_material_infos"));t.length>0?t=t[0]:(t=JSON.parse(dqv("#hd_material"))).file_id=await ajax_post("/Basic","GetNewFileID"),t=common_role.output_data_process_controller(null,"DataObjInit",t,null),$(e).data("dataObj",t),"new"==getReq("mode")&&ajax_post("/Create","MaterialNewModeSet",{id:t.id}),file_upload_data_init($(e),t.file_id);var a=e.querySelector("[data-file_tag=material_img]");fileReload(a),$(".lightbox").fancybox({openEffect:"none",closeEffect:"none"});var i=JSON.parse(dqv("#hd_ddl_rights")),r="";r+="<option value=''>請選擇</option>",$(i).each(function(){r+="<option value='"+this.tag+"'>"+this.title+"("+this.tag+")</option>"}),dq("#authorizeRange").innerHTML=r},material_info_edit_push:async function(){init_controller();var e=JSON.parse(dqv("#hd_material_infos"));0==e.length&&(e=[JSON.parse(dqv("#hd_material"))]);var t=dq("[data-row=db_row]"),a=e[0];(a=common_role.output_data_process_controller(null,"DataObjInit",a,null)).date_material&&(a.date_material=moment(a.date_material).format("YYYY-MM-DD")),"NULL"==a.lat&&(a.lat=""),"NULL"==a.lng&&(a.lng=""),push_form_controller(t,a,common_role.form_push_format("default"));var i={obj_id:a.file_id,endmode:"back",checkcode:"123"},r=(await ajax_post("/Basic","FilesSearch",i,null)).data1;if(r){var l=(r=r.filter(e=>""==e.img_size)).filter(e=>e.note.indexOf(";true")>-1);l=l.length>0?l[0]:r[0],dq(".photoImg").querySelector("img").src=doc_icon_helper(l.path),"mp4"==l.exten&&2==l.checkcode.split(";").length&&($(dq(".photoImg").querySelector("img")).hide(),$(dq(".photoImg").querySelector(".video")).html(mp4_iframe_helper(l.checkcode.split(";")[0]+"?api_access_key=87a6fd4d-6b37-4d72-9813-90b2a72be146")),$(dq(".photoImg").querySelector(".video")).show())}if(t.id="data_form",a.date_material_str?(create_role.time_input_switch("2"),push_value_controller(t,"MaterialTime","2","radio")):(moment(a.date_material).format("yyyy-mm-dd"),create_role.time_input_switch("1"),push_value_controller(t,"MaterialTime","1","radio")),t.id="",t.id="data_form",a.city){create_role.location_input_switch("1"),push_value_controller(t,"StoryPlace1","1","radio");var o=t.querySelector("[name=city]"),n=t.querySelector("[name=area]");o&&(create_role.city_changer(o),n.value=a.area)}else create_role.location_input_switch("2"),push_value_controller(t,"StoryPlace1","2","radio");t.id="";var s=t.querySelector("[name=right_select]").querySelector("div"),d=JSON.parse(dqv("#hd_ddl_rights")),c="";c+="<label for='Copywriting0' class='radioCont' title='請選擇'>",c+="<input name='rights' type='radio' data-title='授權方式' id='Copywriting0' value='' checked ><span></span>請選擇",c+="</label>";for(var _=0;_<d.length;_++){var h=d[_];"PDM"!=h.tag&&"CC0"!=h.tag&&"OGDL"!=h.tag&&"CC BY"!=h.tag||(c+="<label for='Copywriting"+(_+1)+"' class='radioCont' title='"+h.title+"'>",c+="<input name='rights' type='radio' data-title='授權方式' id='Copywriting"+(_+1)+"' value='"+h.tag+"'><span><img src='../Content/nrch/images/"+h.icon_name+".png' alt ='licence:"+h.tag+"' style='height: 35px'></span>"+h.title+"("+h.tag+")",c+="</label>")}s.innerHTML=c,$("[data-toggle='tooltip']").tooltip(),t.id="data_form",push_value_controller(t,"rights",a.rights,"radio"),t.id="";$(".checkList").SumoSelect();window.test=$(".testsel").SumoSelect({okCancelInMulti:!0});var u=a.category.split("@#@"),p=t.querySelector("[name=category]").querySelectorAll("option");for(_=0;_<p.length;_++)u.indexOf(p[_].value)>-1&&$(".checkList")[0].sumo.selectItem(_)},material_info_confirm_push:async function(){var e=JSON.parse(dqv("#hd_material_infos"));if(r=dq("[name=form_area]")){$(e).each(function(e,t){(t=common_role.output_data_process_controller(null,"DataObjInit",t,null)).category=t.category.replaceAll("@#@"," / "),"NULL"==t.lat&&(t.lat=""),"NULL"==t.lng&&(t.lng=""),push_form_controller(r,t,common_role.form_push_format("material")),t.lat&&t.lng&&(dq("[name=latlng]").innerHTML=t.lat+" , "+t.lng)});var t={obj_id:e[0].file_id,endmode:"back",checkcode:"123"},a=(await ajax_post("/Basic","FilesSearch",t,null)).data1;if(a){var i=(a=a.filter(e=>""==e.img_size)).filter(e=>e.note.indexOf(";true")>-1);i=i.length>0?i[0]:a[0],dq(".photoImg").querySelector("img").src=doc_icon_helper(i.path),"mp4"==i.exten&&2==i.checkcode.split(";").length&&($(dq(".photoImg").querySelector("img")).hide(),$(dq(".photoImg").querySelector(".video")).html(mp4_iframe_helper(i.checkcode.split(";")[0]+"?api_access_key=87a6fd4d-6b37-4d72-9813-90b2a72be146")),$(dq(".photoImg").querySelector(".video")).show())}var r,l=JSON.parse(dqv("#hd_ddl_rights"));if(r=dq(".photoGallery")){var o=dq("[data-row=temp_row]");$(a).each(function(e,t){var a=$(o).clone();a.show(),a.attr("data-row","db_row");var i=a[0];i.querySelector(".lightbox").href=doc_icon_helper(t.path),i.querySelector(".lightbox").querySelector("img").src=doc_icon_helper(t.path),"mp4"==t.exten&&2==t.checkcode.split(";").length&&($(i.querySelector(".lightbox").querySelector("img")).hide(),$(i.querySelector(".lightbox").querySelector(".video")).html(mp4_iframe_helper(t.checkcode.split(";")[0]+"?api_access_key=87a6fd4d-6b37-4d72-9813-90b2a72be146")),$(i.querySelector(".lightbox").querySelector(".video")).show());var n=t.name,s="";if(t.note.split(";").length>=4){n=t.note.split(";")[0],s=t.note.split(";")[1];var d=l.filter(e=>e.tag==s);d.length>0&&(s=d[0].title+"("+d[0].tag+")")}i.querySelector(".lightbox").setAttribute("data-title",n),i.querySelector("[name=title]").innerHTML=n,i.querySelector("[name=right]").innerHTML=s,$(r).append(a)}),$(".lightbox").fancybox({openEffect:"none",closeEffect:"none"})}}},material_finish:async function(e){var t=JSON.parse(dqv("#hd_material_infos"));if(t[0].date_created=transMSDate(t[0].date_created),t[0].date_modify=transMSDate(t[0].date_modify),t[0].date_material=transMSDate(t[0].date_material),"back"==e&&(location="/Create/MaterialForm?id="+getReq("id")),"go"==e){t[0].memo="",await ajax_post("/Create","MaterialSave",t);var a=await ajax_post("/Create","MaterialDataValidate",{id:t[0].id});cl("validRet",a),a.data1&&alert(a.data2+"\n"+a.data1+"\n"),location="/Create/MaterialFinish?id="+getReq("id")}if("timer"==e){t[0].memo="",await ajax_post("/Create","MaterialSave",t);a=await ajax_post("/Create","MaterialDataValidate",{id:t[0].id});cl("validRet",a),a.data1&&alert(a.data2+"\n"+a.data1+"\n")}},material_publish:async function(e){var t=JSON.parse(dqv("#hd_material_infos"));if(t&&!(t.length<1)){if(1==e){var a=await ajax_post("/Create","MaterialDataValidate",{id:t[0].id});if(cl("validRet",a),!a.isSuccess)return void alert(a.data2+"\n請至編輯頁面確認填寫完成後，再進行公開設定\n")}$(t).each(function(t,a){(a=common_role.output_data_process_controller(null,"DataObjInit",a,null)).is_enabled=e,a.memo=""}),await ajax_post("/Create","MaterialSave",t),ajax_post("/Home","KeepRecordMaterialCloseSwitch",{id:t[0].id}),1==e&&alert("發佈後約5分鐘將可於記憶庫網站查詢。"),location="/Create/MaterialList"}},material_list_push:function(){var e=dq("#material_list");if(e){var t=dq("[data-row=temp_row]"),a=JSON.parse(dqv("#hd_material")),i=a.data1;if($(i).each(function(a,i){var r=$(t).clone();(i=common_role.output_data_process_controller(null,"DataObjInit",i,null)).title||(i.title="(無標題)"),i.category=i.category.replaceAll("@#@"," / "),r.show(),r.attr("data-row","db_row");var l=r[0];push_form_controller(l,i,common_role.form_push_format("material"));var o=l.querySelector("[name=btnModify]");if(o&&(o.href="/Create/MaterialUpload?id="+i.id),o=l.querySelector("[name=date_modify]")){var n=i.date_modify?i.date_modify:i.date_created;n||(n=i.date_created),o.innerHTML=moment(n).format("YYYY年MM月DD日 HH:mm")}1==i.is_close?((o=l.querySelector("[name=date_close]"))&&i.date_close&&(o.innerHTML=moment(i.date_close).format("YYYY年MM月DD日 HH:mm"),$(o).closest("li").removeAttr("style")),(o=l.querySelector("[name=close_reason]"))&&i.close_reason&&(o.innerHTML=i.close_reason,$(o).closest("li").removeAttr("style"))):i.unclose_reason&&((o=l.querySelector("[name=date_unclose]"))&&i.date_unclose&&(o.innerHTML=moment(i.date_unclose).format("YYYY年MM月DD日 HH:mm"),$(o).closest("li").removeAttr("style")),(o=l.querySelector("[name=unclose_reason]"))&&i.unclose_reason&&(o.innerHTML=i.unclose_reason,$(o).closest("li").removeAttr("style"))),(o=$(l.querySelector("[name=title]")).closest("a")[0])&&(o.href="/Home/Detail?Id="+i.id+"&IndexCode=member_material"),cl("info",i.is_enabled+" , "+i.memo),1==i.is_enabled&&$(l.querySelector(".staBtnB")).show(),0==i.is_enabled&&("draft"==i.memo&&$(l.querySelector(".staBtnA")).show(),""==i.memo&&$(l.querySelector(".staBtnC")).show()),i.material_image_url&&((o=l.querySelector(".img"))&&$(o).css("background-image","url('"+doc_icon_helper(i.material_image_url.split(";")[0])+"')"),(o=l.querySelector(".photo"))&&(o.setAttribute("data-url",i.material_image_url.split(";")[0]),o.setAttribute("data-indexcode","member_material"))),$(e).append(r)}),a.data3&&a.data3.length>0){var r=front_default_pager_html2(a.data3);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(r)})}}},material_collect_count_push:async function(){var e=JSON.parse(dqv("#hd_story_indexcode")),t=JSON.parse(dqv("#hd_query"));if(t.UserId=dqv("#hd_login_account"),t.PageSize=10,t.IndexList=[],indexconfig)for(var a=0;a<indexconfig.length;a++)-1==e.indexOf(indexconfig[a].IndexCode)&&t.IndexList.push(indexconfig[a].IndexCode);t.IndexList.push("member_material_keep"),t.IsHighlight=!1,t.IsSearchDateCount=!1,t.IsSearchGeoCount=!1;var i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(t)});i.JsonData=JSON.parse(i.JsonData),cl("material_collect_count_push => ret",i),dq("#material_keep_count").innerHTML=i.JsonData.TotalDocNo},story_collect_count_push:async function(){var e=JSON.parse(dqv("#hd_query"));e.UserId=dqv("#hd_login_account"),e.PageSize=10,e.IndexList=["member_story"],e.IndexList.push("member_story_keep"),e.IsHighlight=!1,e.IsSearchDateCount=!1,e.IsSearchGeoCount=!1;var t=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(e)});t.JsonData=JSON.parse(t.JsonData),cl("story_collect_list_push => ret",t),dq("#story_keep_count").innerHTML=t.JsonData.TotalDocNo},material_collect_list_push:async function(){var e=0,t=0;getReq("p")&&(t=parseInt(getReq("p")))>0&&(t-=1);var a=[],i=[],r=[],l=await this.collect_list_API_data("",t,10,"material");cl("API => ret",l),l.Error||(l.JsonData=JSON.parse(l.JsonData),e=l.JsonData.TotalDocNo,a=l.JsonData.ResultData),this.collect_list_str_filter(a),$(a).each(function(){i.push(this.IndexCode),r.push(this.Id)}),cl("indexcodeArr",i),cl("idArr",r),await this.collect_list_tag(a,i,r),cl("infos",a);var o=dq("#material_collect_list");this.collect_list_table(o,a,t,10),this.collect_list_pager(t,10,e),dq("#material_keep_count").innerHTML=e},material_collect_keyword_list_push:async function(){var e,t=getReq("Keyword"),a=0;getReq("p")&&(a=parseInt(getReq("p")))>0&&(a-=1);var i=[],r=[],l=[],o=[],n=await this.collect_list_API_data("",0,1e3,"material");cl("API => all_ret",n),n.Error||(n.JsonData=JSON.parse(n.JsonData),o=n.JsonData.ResultData),this.collect_list_str_filter(o),$(o).each(function(){r.push(this.IndexCode),l.push(this.Id)}),await this.collect_list_tag(o,r,l),r=[],l=[],$(o).each(function(){this.TagText&&this.TagText.indexOf(t)>-1&&i.push(this)});var s=await this.collect_list_API_data(t,0,1e3,"material");cl("API => ret",s),s.Error||(s.JsonData=JSON.parse(s.JsonData),$(s.JsonData.ResultData).each(function(){i.push(this)})),this.collect_list_str_filter(i),$(i).each(function(){r.push(this.IndexCode),l.push(this.Id)}),await this.collect_list_tag(i,r,l),cl("infos",i);var d=[];$(i).each(function(){0==d.filter(e=>e.IndexCode==this.IndexCode&&e.Id==this.Id).length&&d.push(this)}),cl("show_list",d);var c=dq("#material_collect_list");this.collect_list_table(c,d,a,10),e=d.length,this.collect_list_pager(a,10,e),dq("#material_keep_count").innerHTML=e,dq("[name=Keyword]").value=t},material_collect_tag_list_push:async function(){var e,t=getReq("Tag"),a=0;getReq("p")&&(a=parseInt(getReq("p")))>0&&(a-=1);var i=[],r=[],l=[],o=[],n=await this.collect_list_API_data("",0,1e3,"material");cl("API => all_ret",n),n.Error||(n.JsonData=JSON.parse(n.JsonData),o=n.JsonData.ResultData),this.collect_list_str_filter(o),$(o).each(function(){r.push(this.IndexCode),l.push(this.Id)}),await this.collect_list_tag(o,r,l),r=[],l=[];var s=t.split(",");$(o).each(function(){for(var e=0;e<s.length;e++){var t=s[e];this.Tag&&this.Tag.split(",").indexOf(t)>-1&&-1==i.indexOf(this)&&i.push(this)}}),cl("infos",i);var d=[];$(i).each(function(){0==d.filter(e=>e.IndexCode==this.IndexCode&&e.Id==this.Id).length&&d.push(this)}),cl("show_list",d);var c=dq("#material_collect_list");this.collect_list_table(c,d,a,10),e=d.length,this.collect_list_pager(a,10,e),dq("#material_keep_count").innerHTML=e,dq("[name=Tag]").value=t},collect_list_API_data:async function(e,t,a,i){var r=JSON.parse(dqv("#hd_story_indexcode")),l=JSON.parse(dqv("#hd_query"));if(l.UserId=dqv("#hd_login_account"),l.IsHighlight=!1,l.IsSearchDateCount=!1,l.IsSearchGeoCount=!1,l.AtPage=t,l.PageSize=a,l.Keyword=e,"material"==i){if(l.IndexList=[],indexconfig)for(var o=0;o<indexconfig.length;o++)-1==r.indexOf(indexconfig[o].IndexCode)&&l.IndexList.push(indexconfig[o].IndexCode);l.IndexList.push("member_material_keep")}else"story"==i&&(l.IndexList=["member_story"],l.IndexList.push("member_story_keep"));return l.CustomColumns=["Identifier","Creator","LastUpdateTime","Keyword_Subject_1"],cl("material_collect_list_push => q",l),await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(l)})},collect_list_str_filter:function(e){$(e).each(function(){"MOCCOLLECTIONS"==this.IndexCode&&this.Title&&(this.Title.indexOf("<br />")>-1?this.Title=this.Title.split("<br />")[0]:this.Title.indexOf("<br>")>-1?this.Title=this.Title.split("<br>")[0]:this.Title.indexOf("<br/>")>-1&&(this.Title=this.Title.split("<br/>")[0])),this.ImageUrl=this.ImageUrl.split(" / ")[0],this.ImageUrl=this.ImageUrl.split(";")[0],this.ImageUrl||(this.ImageUrl="/Content/nrch/images/nopic.png"),"member_material_keep"==this.IndexCode&&(this.IndexCode="member_material")})},collect_list_tag:async function(e,t,a){if(t&&0!=t.length&&a&&0!=a.length){var i=getReq("Keyword"),r=dqv("#hd_login_account"),l=await ajax_post("/Home","KeepRecordTagSearch",{account:r,indexcodeArr:t,idArr:a});if(cl("KeepRecordTagSearch => tagRet",l),l.hasData){var o=JSON.parse(dqv("#hd_account_tag"));$(l.data1).each(function(){var t=e.filter(e=>e.IndexCode==this.source&&e.Id==this.source_id);if(t.length>0){t=t[0];var a=[],r=this.note.split(",");$(o).each(function(){r.indexOf(this.id.toString())>-1&&a.push(this.tag)}),t.Tag=this.note,t.TagText=a.join(","),t.TagText&&i&&t.TagText.indexOf(i)>-1&&e.unshift(t)}})}}},collect_list_table:function(e,t,a,i){if(e){var r=getReq("Keyword"),l=getReq("Tag"),o=dq("[data-row=temp_row]"),n=1,s=a*i+1,d=a*i+i;$(t).each(function(t,a){var i=$(o).clone();i.show(),i.attr("data-row","db_row"),i.attr("data-indexcode",a.IndexCode),i.attr("data-id",a.Id),(r||l)&&(i.attr("data-rowno",n),(n<s||n>d)&&i.attr("style","display:none"),n++);var c=i[0];push_form_controller(c,a,common_role.form_push_format("default"));var _=c.querySelector(".img");if(_&&$(_).css("background-image","url('"+a.ImageUrl+"')"),(_=c.querySelector("[name=Date]"))&&(_.innerHTML=moment(a.CustomColumns.LastUpdateTime).format("YYYY年MM月DD日")),(_=$(c.querySelector("[name=Title]")).closest("a")[0])&&(_.href="/Home/Detail?Id="+a.Id+"&IndexCode="+a.IndexCode),(_=c.querySelector("[name=category]"))&&(_.innerHTML=a.CustomColumns.Keyword_Subject_1.replaceAll("@#@"," / ")),(_=c.querySelector("[name=Id]"))&&(_.innerHTML=a.Id),(_=c.querySelector("[name=author]"))&&(_.innerHTML=a.CustomColumns.Creator),(_=c.querySelector(".photo"))&&(_.setAttribute("data-url",a.ImageUrl),_.setAttribute("data-indexcode",a.IndexCode)),_=c.querySelector(".tag")){var h="素材標籤 :";if(a.TagText)for(var u=a.Tag.split(","),p=a.TagText.split(","),m=0;m<p.length;m++){h+="<a href='?Tag="+u[m]+"'>#"+p[m]+"</a>"}_.innerHTML=h}$(e).append(i),$(i).data("dataObj",a)})}},collect_list_pager:function(e,t,a){var i=get_pages_helper(t,e+1,a);if(i&&i.length>0){$(i).each(function(){this.href=encodeURI(this.href)});var r=front_default_pager_html2(i);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(r)})}},material_collect_list_keep_remove:async function(e){if(e&&confirm("確認取消收藏?")){var t=$(e).closest("[data-row=db_row]").data("dataObj"),a=await material_role.fetch_did_helper(t.IndexCode,t.Id);await member_role.keep_record_remove(t.IndexCode,t.Id,a),location=location}},story_collect_list_push:async function(){var e=0,t=0;getReq("p")&&(t=parseInt(getReq("p")))>0&&(t-=1);var a=[],i=[],r=[],l=await this.collect_list_API_data("",t,10,"story");cl("API => ret",l),l.Error||(l.JsonData=JSON.parse(l.JsonData),e=l.JsonData.TotalDocNo,a=l.JsonData.ResultData),this.collect_list_str_filter(a),$(a).each(function(){i.push(this.IndexCode),r.push(this.Id)}),cl("indexcodeArr",i),cl("idArr",r),await this.collect_list_tag(a,i,r),cl("infos",a);var o=dq("#story_collect_list");this.collect_list_table(o,a,t,10),this.collect_list_pager(t,10,e),dq("#story_keep_count").innerHTML=e},story_collect_keyword_list_push:async function(){var e,t=getReq("Keyword"),a=0;getReq("p")&&(a=parseInt(getReq("p")))>0&&(a-=1);var i=[],r=[],l=[],o=[],n=await this.collect_list_API_data("",0,1e3,"story");cl("API => all_ret",n),n.Error||(n.JsonData=JSON.parse(n.JsonData),o=n.JsonData.ResultData),this.collect_list_str_filter(o),$(o).each(function(){r.push(this.IndexCode),l.push(this.Id)}),await this.collect_list_tag(o,r,l),r=[],l=[],$(o).each(function(){this.TagText&&this.TagText.indexOf(t)>-1&&i.push(this)});var s=await this.collect_list_API_data(t,0,1e3,"story");cl("API => ret",s),s.Error||(s.JsonData=JSON.parse(s.JsonData),$(s.JsonData.ResultData).each(function(){i.push(this)})),this.collect_list_str_filter(i),$(i).each(function(){r.push(this.IndexCode),l.push(this.Id)}),await this.collect_list_tag(i,r,l),cl("infos",i);var d=[];$(i).each(function(){0==d.filter(e=>e.IndexCode==this.IndexCode&&e.Id==this.Id).length&&d.push(this)}),cl("show_list",d);var c=dq("#story_collect_list");this.collect_list_table(c,d,a,10),e=d.length,this.collect_list_pager(a,10,e),dq("#story_keep_count").innerHTML=e,dq("[name=Keyword]").value=t},story_collect_tag_list_push:async function(){var e,t=getReq("Tag"),a=0;getReq("p")&&(a=parseInt(getReq("p")))>0&&(a-=1);var i=[],r=[],l=[],o=[],n=await this.collect_list_API_data("",0,1e3,"story");cl("API => all_ret",n),n.Error||(n.JsonData=JSON.parse(n.JsonData),o=n.JsonData.ResultData),this.collect_list_str_filter(o),$(o).each(function(){r.push(this.IndexCode),l.push(this.Id)}),await this.collect_list_tag(o,r,l),r=[],l=[];var s=t.split(",");$(o).each(function(){for(var e=0;e<s.length;e++){var t=s[e];this.Tag&&this.Tag.split(",").indexOf(t)>-1&&-1==i.indexOf(this)&&i.push(this)}}),cl("infos",i);var d=[];$(i).each(function(){0==d.filter(e=>e.IndexCode==this.IndexCode&&e.Id==this.Id).length&&d.push(this)}),cl("show_list",d);var c=dq("#story_collect_list");this.collect_list_table(c,d,a,10),e=d.length,this.collect_list_pager(a,10,e),dq("#story_keep_count").innerHTML=e,dq("[name=Tag]").value=t},data_status_set:async function(e,t,a){if(e){var i=$(e).closest("[data-row=db_row]").data("dataObj"),r={};if("staBtnA"==a){if(!confirm("確認要將狀態切換為草稿?"))return;r={id:i.id,is_enabled:0,memo:"draft"}}if("staBtnB"==a){if(!confirm("確認要將狀態切換為公開?"))return;var l="";if("material"==t&&(l=await ajax_post("/Create","MaterialDataValidate",{id:i.id})),"story"==t&&(l=await ajax_post("/Create","StoryDataValidate",{id:i.id})),cl("validRet",l),!l.isSuccess)return void alert(l.data2+"\n請至編輯頁面確認填寫完成後，再進行公開設定\n");r={id:i.id,is_enabled:1,memo:""}}if("staBtnC"==a){if(!confirm("確認要將狀態切換為關閉?"))return;r={id:i.id,is_enabled:0,memo:""}}"material"==t&&ajax_post("/Create","MaterialStatusSet",r),"story"==t&&ajax_post("/Create","StoryStatusSet",r),$(e).closest("[data-row=db_row]").find(".staBtnA").css("display","none"),$(e).closest("[data-row=db_row]").find(".staBtnB").css("display","none"),$(e).closest("[data-row=db_row]").find(".staBtnC").css("display","none"),$(e).closest("[data-row=db_row]").find("."+a).css("display","block"),"staBtnB"==a&&alert("發佈後約5分鐘將可於記憶庫網站查詢。")}},material_remove:async function(e){if(e&&confirm("確認刪除?")){var t=[$(e).closest("[data-row=db_row]").data("dataObj").id];await ajax_post("/Create","MaterialRemove",t),location=location}},story_list_push:function(){var e=dq("#story_list");if(e){var t=dq("[data-row=temp_row]"),a=JSON.parse(dqv("#hd_story")),i=a.data1;if($(i).each(function(a,i){var r=$(t).clone();i=common_role.output_data_process_controller(null,"DataObjInit",i,null),r.show(),r.attr("data-row","db_row");var l=r[0];i.title||(i.title="(無標題)"),i.category=i.category.replaceAll("@#@"," / "),push_form_controller(l,i,common_role.form_push_format("story"));var o=l.querySelector("[name=btnModify]");if(o&&(o.href="/Create/StoryForm?id="+i.id),o=l.querySelector("[name=date_modify]")){var n=i.date_modify?i.date_modify:i.date_created;n||(n=i.date_created),o.innerHTML=moment(n).format("YYYY年MM月DD日 HH:mm")}1==i.is_close?((o=l.querySelector("[name=date_close]"))&&i.date_close&&(o.innerHTML=moment(i.date_close).format("YYYY年MM月DD日 HH:mm"),$(o).closest("li").removeAttr("style")),(o=l.querySelector("[name=close_reason]"))&&i.close_reason&&(o.innerHTML=i.close_reason,$(o).closest("li").removeAttr("style"))):i.unclose_reason&&((o=l.querySelector("[name=date_unclose]"))&&i.date_unclose&&(o.innerHTML=moment(i.date_unclose).format("YYYY年MM月DD日 HH:mm"),$(o).closest("li").removeAttr("style")),(o=l.querySelector("[name=unclose_reason]"))&&i.unclose_reason&&(o.innerHTML=i.unclose_reason,$(o).closest("li").removeAttr("style"))),1==i.is_enabled&&$(l.querySelector(".staBtnB")).show(),0==i.is_enabled&&("draft"==i.memo&&$(l.querySelector(".staBtnA")).show(),""==i.memo&&$(l.querySelector(".staBtnC")).show()),(o=l.querySelector("[name=title]"))&&(o.innerHTML="<a href='/Story/Detail?Id="+i.id+"&IndexCode=member_story' >"+i.title+"</a>"),i.material_image_url&&((o=l.querySelector(".img"))&&$(o).css("background-image","url('"+i.material_image_url+"')"),(o=l.querySelector(".photo"))&&(o.setAttribute("data-url",i.material_image_url),o.setAttribute("data-indexcode","member_story"))),$(e).append(r)}),a.data3&&a.data3.length>0){var r=front_default_pager_html2(a.data3);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(r)})}}},story_remove:async function(e){if(e&&confirm("確認刪除?")){var t=[$(e).closest("[data-row=db_row]").data("dataObj").id];await ajax_post("/Create","StoryRemove",t),location=location}},collect_story_cover_info:async function(e,t){if(e){var a=dq("[name=form_area]");if(a){var i=a.querySelectorAll("[data-row=db_row]"),r=[];if($(i).each(function(e,t){r.push(create_role.story_cover_pull_helper(t))}),"temp"==t){await ajax_post("/Create","StorySave",r[0]),alert("暫時儲存成功");var l=await ajax_post("/Create","StoryDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),"new"==getReq("mode")&&(location="/Create/StoryForm?id="+r[0].id)}if("go"==t){var o=form_validate(i[0],"story_cover");if(o.size>0){"填寫不完整\n";for(let e of o.keys()){i[0].querySelector("[name="+e+"]").getAttribute("data-title")+"  "+langTrans(o.get(e))+"\n"}}r[0].material_image_url||"故事封面  尚未選擇\n",r[0].date_story||r[0].date_story_str||"時間資訊  必填\n",(r[0].city||r[0].area||r[0].area_desc||r[0].lng||r[0].lat)&&(!(r[0].city+r[0].area+r[0].area_desc)||r[0].city&&r[0].area&&r[0].area_desc)||"空間資訊  不完整\n",await ajax_post("/Create","StorySave",r[0]);l=await ajax_post("/Create","StoryDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),location="/Create/StoryChapter?id="+r[0].id}if("timer"==t){await ajax_post("/Create","StorySave",r[0]);l=await ajax_post("/Create","StoryDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n")}if("more"==t){await ajax_post("/Create","StorySave",r[0]);l=await ajax_post("/Create","StoryDataValidate",{id:r[0].id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),location="/Home/Result?viewmode=pic&editmode=form_"+getReq("id")}}}},story_cover_pull_helper:function(e){if(e){var t=$(e).data("dataObj");t||(t=JSON.parse(dqv("#hd_story"))),t.category=$("#StorySubject").val(),t.category=t.category.toString().replaceAll(",","@#@"),t.title=pull_value_controller(e,"title",t.title),t.intro=pull_value_controller(e,"intro",t.intro),t.rights=pull_value_controller(e,"rights",t.rights,"radio"),t.is_enabled=pull_value_controller(e,"is_enabled",t.is_enabled,"radio"),t.keyword=pull_value_controller(e,"keyword",t.keyword),t.date_story="",t.date_story_str="";var a=pull_value_controller(e,"MaterialTime","1","radio");"1"==a&&(t.date_story=pull_value_controller(e,"date_story",t.date_story),t.date_story_str=""),"2"==a&&(t.date_story_str=pull_value_controller(e,"date_story_str",t.date_story_str),t.date_story=""),t.city="",t.area="",t.area_desc="",t.location="",t.lng="",t.lat="";var i=pull_value_controller(e,"StoryPlace1","1","radio");"1"==i&&(t.city=pull_value_controller(e,"city",t.city),t.area=pull_value_controller(e,"area",t.area),t.area_desc=pull_value_controller(e,"area_desc",t.area_desc)),"2"==i&&(t.location=dq("[name=location]").innerHTML,t.lng=dq("[name=lng]").innerHTML,t.lat=dq("[name=lat]").innerHTML);var r=e.querySelector("[name=cover_img]");return r&&(t.cite_indexcode=r.getAttribute("data-indexcode"),t.cite_identity=r.getAttribute("data-identity"),t.material_image_url=r.getAttribute("data-url"),t.cover_right=r.getAttribute("data-right")),t}},chapter_part_mode_change_helper:function(e){if(e){var t=$(e).closest("[data-row=db_row]").find("[name=cover_img]")[0];"1"==e.value?$(t).hide():$(t).show()}},story_chapter_pull_helper:function(e){if(e){var t=$(e).data("dataObj");if(t){t.story_id=getReq("id"),t.title=pull_value_controller(e,"title",t.title),t.subtitle=pull_value_controller(e,"subtitle",t.subtitle),t.intro=pull_value_controller(e,"intro",t.intro),e.id="data_form",t.part_mode=pull_value_controller(e,"part_mode",t.part_mode,"radio"),e.id="";var a=[],i=[],r=[],l=[],o=e.querySelector("[name=photo_form]").querySelectorAll("[data-row=db_row]");return $(o).each(function(){a.push(this.querySelector(".photo").getAttribute("data-indexcode")),i.push(this.querySelector(".photo").getAttribute("data-identity")),r.push(this.querySelector(".photo").getAttribute("data-url")),l.push(this.querySelector(".photo").getAttribute("data-right"))}),t.cite_indexcode=a.join("@#@"),t.cite_identity=i.join("@#@"),t.material_image_url=r.join("@#@"),t.rights=l.join("@#@"),t}}},story_chapter_keep_select_confirm:async function(){var e=dq("#keep_form").querySelectorAll("input[name=createpic]:checked");if(e&&!(e.length<1)){for(var t=[],a=0;a<e.length;a++){var i=e[a],r=$(i).closest("li").data("dataObj");t.filter(e=>e.cite_indexcode==r.IndexCode&&e.cite_identity==r.Id).length<1&&t.push({indexcode:r.IndexCode?r.IndexCode:"",identity:r.Id?r.Id:"",url:r.ImageUrl?r.ImageUrl:"",right:r.Rights?r.Rights:""})}cl("infos",t);var l=create_role.keep_select_change_img_dom;if(l){var o=l.innerHTML;$(t).each(function(e,t){var a=t.url;a&&(a=a.replace(" ","%20")),o+="<div data-row='db_row' >",o+="<div class='photo' data-indexcode='"+t.indexcode+"' data-identity='"+t.identity+"' data-url='"+a+"' data-right='"+t.right+"'>",o+="<span class='img' style='background-image:url("+a+")'></span><span name='video' style='display:none'></span></div>",o+="<div class='picTool edph'>",o+="<a href='javascript:();' class='tool-delete' onclick='create_role.story_chapter_keep_select_remove(this)' title='刪除'>刪除</a>",o+="<a href='javascript:();' class='tool-prev' onclick='create_role.story_album_keep_select_sort(this, \"prev\")' title='排序向前'>排序向前</a>",o+="<a href='javascript:();' class='tool-next' onclick='create_role.story_album_keep_select_sort(this, \"next\")' title='排序向後'>排序向後</a>",o+="</div></div>"}),l.innerHTML=o,$("#modalAddfile").modal("hide"),$(e).each(function(){this.checked=!1})}}},story_album_pull_helper:function(e){if(e){var t=$(e).data("dataObj");if(t)return t.title=pull_value_controller(e,"casepic1",t.title),t.rights=pull_value_controller(e,"rights",t.rights),t}},story_cover_edit_push:async function(){init_controller(),this.keep_window_push();var e=JSON.parse(dqv("#hd_story")),t=dq("[data-row=db_row]");if(t){if("NULL"==(e=common_role.output_data_process_controller(null,"DataObjInit",e,null)).lat&&(e.lat=""),"NULL"==e.lng&&(e.lng=""),e.date_story&&(e.date_story=moment(e.date_story).format("YYYY-MM-DD")),push_form_controller(t,e,common_role.form_push_format("default")),"new"==getReq("mode")&&ajax_post("/Create","StoryNewModeSet",{id:e.id}),t.id="data_form",e.date_story_str?(this.time_input_switch("2"),push_value_controller(t,"MaterialTime","2","radio")):(moment(e.date_story).format("yyyy-mm-dd"),this.time_input_switch("1"),push_value_controller(t,"MaterialTime","1","radio")),t.id="",t.id="data_form",e.city){this.location_input_switch("1"),push_value_controller(t,"StoryPlace1","1","radio");var a=t.querySelector("[name=city]"),i=t.querySelector("[name=area]");a&&(this.city_changer(a),i.value=e.area)}else this.location_input_switch("2"),push_value_controller(t,"StoryPlace1","2","radio");t.id="";var r=t.querySelector("[name=right_select]").querySelector("div"),l=JSON.parse(dqv("#hd_ddl_rights")),o="";o+="<label for='Copywriting0' class='radioCont' title='請選擇'>",o+="<input name='rights' type='radio' data-title='授權方式' id='Copywriting0' value='' checked ><span></span>請選擇",o+="</label>";for(var n=0;n<l.length;n++){var s=l[n];"PDM"!=s.tag&&"CC0"!=s.tag&&"OGDL"!=s.tag&&"CC BY"!=s.tag||(o+="<label for='Copywriting"+(n+1)+"' class='radioCont' title='"+s.title+"'>",o+="<input name='rights' type='radio' data-title='授權方式' id='Copywriting"+(n+1)+"' value='"+s.tag+"'><span><img src='../Content/nrch/images/"+s.icon_name+".png' alt ='licence:"+s.tag+"' style='height: 35px'></span>"+s.title+"("+s.tag+")",o+="</label>")}r.innerHTML=o,$("[data-toggle='tooltip']").tooltip(),t.id="data_form",push_value_controller(t,"rights",e.rights,"radio"),t.id="";var d=getImgUrlExten(e.material_image_url);$(t.querySelector(".img")).css("background-image","url('"+e.material_image_url+"')"),audioAllowFormat.indexOf(d)>-1?($(t.querySelector(".img")).html(""),$(t.querySelector(".img")).css("background-image","url('"+doc_icon_helper(e.material_image_url)+"')")):"Culture_Media"==e.cite_indexcode||videoAllowFormat.indexOf(d)>-1||e.material_image_url.indexOf("imedia.culture.tw/iframe")>-1||"pdf"==d?($(t.querySelector(".img")).css("background-image","url('')"),$(t.querySelector(".img")).html(mp4_iframe_helper(e.material_image_url))):$(t.querySelector(".img")).html(""),t.querySelector("[name=cover_img]").setAttribute("data-indexcode",e.cite_indexcode),t.querySelector("[name=cover_img]").setAttribute("data-identity",e.cite_identity),t.querySelector("[name=cover_img]").setAttribute("data-url",e.material_image_url),t.querySelector("[name=cover_img]").setAttribute("data-right",e.cover_right);$(".checkList").SumoSelect();window.test=$(".testsel").SumoSelect({okCancelInMulti:!0});var c=e.category.split("@#@"),_=t.querySelector("[name=category]").querySelectorAll("option");for(n=0;n<_.length;n++)c.indexOf(_[n].value)>-1&&$(".checkList")[0].sumo.selectItem(n)}},story_album_edit_push:async function(){this.keep_window_push();var e=JSON.parse(dqv("#hd_story_album")),t=dq("#photo_form");if(t){var a=t.querySelector("[data-row=temp_row]");$(e).each(function(e,i){var r=$(a).clone();r.attr("style",""),r.attr("data-row","db_row"),r.data("dataObj",i);var l="";(l=r[0].querySelector(".lightbox"))&&(l.href=i.material_image_url,l.setAttribute("data-title",i.title),l.setAttribute("data-rights",i.rights)),(l=r[0].querySelector(".lightbox").querySelector("img"))&&(l.src=i.material_image_url,l.alt=i.title);var o=i.cite_indexcode,n=i.material_image_url,s=getImgUrlExten(n);audioAllowFormat.indexOf(s)>-1?r[0].querySelector(".lightbox").querySelector("img").src=doc_icon_helper(n):("Culture_Media"==o||videoAllowFormat.indexOf(s)>-1||n.indexOf("imedia.culture.tw/iframe")>-1||"pdf"==s)&&($(r[0].querySelector(".lightbox").querySelector("img")).hide(),$(r[0].querySelector(".lightbox").querySelector("[name=video]")).html(mp4_iframe_helper(n)),$(r[0].querySelector(".lightbox").querySelector("[name=video]")).show()),(l=r[0].querySelector("[name=casepic1]"))&&(l.value=i.title),(l=r[0].querySelector("[name=rights]"))&&(l.value=i.rights),$(t).append(r)}),dq("#upload_count").innerHTML=e.length}},story_album_keep_select_confirm:async function(){var e=dq("#keep_form").querySelectorAll("input[name=createpic]:checked");if(e&&!(e.length<1)){for(var t=JSON.parse(dqv("#hd_story_album")),a=0;a<e.length;a++){var i=e[a],r=$(i).closest("li").data("dataObj");if(t.filter(e=>e.cite_indexcode==r.IndexCode&&e.cite_identity==r.Id).length<1){var l=JSON.parse(dqv("#hd_story_album_obj"));(l=common_role.output_data_process_controller(null,"DataObjInit",l,null)).title=r.Title,l.cite_indexcode=r.IndexCode,l.cite_identity=r.Id,l.material_image_url=r.ImageUrl,l.story_id=getReq("id"),l.rights=r.Rights,t.push(l)}}dq("#upload_count").innerHTML=t.length;var o=dq("#photo_form");if(o){$(o).find("[data-row=db_row]").each(function(){$(this).remove()});var n=o.querySelector("[data-row=temp_row]");$(t).each(function(e,t){var a=$(n).clone();a.attr("style",""),a.attr("data-row","db_row"),a.data("dataObj",t);var i="";(i=a[0].querySelector(".lightbox"))&&(i.href=t.material_image_url,i.setAttribute("data-title",t.title),i.setAttribute("data-rights",t.rights)),(i=a[0].querySelector(".lightbox").querySelector("img"))&&(i.src=t.material_image_url,i.alt=t.title);var r=t.cite_indexcode,l=t.material_image_url,s=getImgUrlExten(l);audioAllowFormat.indexOf(s)>-1?a[0].querySelector(".lightbox").querySelector("img").src=doc_icon_helper(l):("Culture_Media"==r||videoAllowFormat.indexOf(s)>-1||l.indexOf("imedia.culture.tw/iframe")>-1||"pdf"==s)&&($(a[0].querySelector(".lightbox").querySelector("img")).hide(),$(a[0].querySelector(".lightbox").querySelector("[name=video]")).html(mp4_iframe_helper(l)),$(a[0].querySelector(".lightbox").querySelector("[name=video]")).show()),(i=a[0].querySelector("[name=casepic1]"))&&(i.value=t.title),(i=a[0].querySelector("[name=rights]"))&&(i.value=t.rights),$(o).append(a)}),dq("#hd_story_album").value=JSON.stringify(t)}}},story_album_keep_select_sort:async function(e,t){if(e){var a=$(e).closest("[data-row=db_row]");if(a.data("dataObj")){var i=dq("#photo_form");$(i.querySelectorAll("[data-order]")).each(function(){$(this).removeAttr("data-order")}),"next"==t&&(a.next().attr("data-order","1"),a.attr("data-order","2")),"prev"==t&&(a.attr("data-order","1"),a.prev().attr("data-order","2"));var r=[],l=1;$(i.querySelectorAll("[data-row=db_row]")).each(function(){var e=create_role.story_album_pull_helper(this);"2"==$(this).attr("data-order")?e.sort=l+2:e.sort=l,l++,r.push(e)}),r.sort(function(e,t){return e.sort-t.sort}),$(i.querySelectorAll("[data-row=db_row]")).each(function(){$(this).remove()});var o=i.querySelector("[data-row=temp_row]");$(r).each(function(){var e=$(o).clone();e.attr("style",""),e.attr("data-row","db_row"),e.data("dataObj",this);var t="";(t=e[0].querySelector(".lightbox"))&&(t.href=this.material_image_url,t.setAttribute("data-title",this.title),t.setAttribute("data-rights",this.rights)),(t=e[0].querySelector(".lightbox").querySelector("img"))&&(t.src=this.material_image_url,t.alt=this.title);var a=this.cite_indexcode,r=this.material_image_url,l=getImgUrlExten(r);audioAllowFormat.indexOf(l)>-1?e[0].querySelector(".lightbox").querySelector("img").src=doc_icon_helper(r):("Culture_Media"==a||videoAllowFormat.indexOf(l)>-1||r.indexOf("imedia.culture.tw/iframe")>-1||"pdf"==l)&&($(e[0].querySelector(".lightbox").querySelector("img")).hide(),$(e[0].querySelector(".lightbox").querySelector("[name=video]")).html(mp4_iframe_helper(r)),$(e[0].querySelector(".lightbox").querySelector("[name=video]")).show()),(t=e[0].querySelector("[name=casepic1]"))&&(t.value=this.title),(t=e[0].querySelector("[name=rights]"))&&(t.value=this.rights),$(i).append(e)})}}},material_upload_select_sort:async function(e,t){if(e){var a=$(e).closest("[name=file_info]").attr("data-file_id"),i=$(e).closest("[data-file_area]");if(common_role.file_info_record_helper(i),"next"==t)for(var r=0;r<file_info_temp.length;r++)file_info_temp[r].id==a&&(file_info_temp[r].sort+=1,file_info_temp[r+1].sort-=1);if("prev"==t)for(r=0;r<file_info_temp.length;r++)file_info_temp[r].id==a&&(file_info_temp[r].sort-=1,file_info_temp[r-1].sort+=1);fileReload(i[0])}},story_album_keep_select_remove:async function(e){if(e&&confirm("確認移除此圖片?")){var t=$(e).closest("[data-row=db_row]"),a=t.data("dataObj");if(a){if(a&&a.id>0){await ajax_post("/Create","StoryAlbumRemove",[a.id]);var i=JSON.parse(dqv("#hd_story_album")),r=i.indexOf(a);i.splice(r,1),dq("#hd_story_album").value=JSON.stringify(i)}t.remove();var l=dq("#upload_count").innerHTML;dq("#upload_count").innerHTML=parseInt(l)-1}}},story_chapter_keep_select_remove:function(e){if(e&&confirm("確認移除此圖片?")){var t=$(e).closest("[data-row=db_row]");t.length>0&&t.remove()}},add_story_chapter_form:async function(e){if(!this.submit_process_status)if(this.submit_status_helper("add_story_chapter_form"),e){var t=dq("[data-row=temp_row]"),a=$(t).clone(),i=dq("[name=form_area]");if(i){var r=JSON.parse(dqv("#hd_chapter_obj"));if(r){r=common_role.output_data_process_controller(null,"DataObjInit",r,null),a.data("dataObj",r),a.show(),a.attr("data-row","db_row"),$(i).append(a);var l=dqa(".createBox[data-row=db_row]");$(l).each(function(e,t){var a=t.querySelector("[name=item_no]");a&&(a.innerHTML=e+1)}),this.submit_status_helper()}else this.submit_status_helper()}else this.submit_status_helper()}else this.submit_status_helper()},remove_story_chapter_form:async function(e){if(e){var t=$(e).closest("[data-row=db_row]");if(!(t.length<1)&&confirm("確認刪除此段落?")){var a=$(t[0]).data("dataObj");if(a&&a.id>0){await ajax_post("/Create","StoryChapterRemove",[a.id]);var i=JSON.parse(dqv("#hd_story_chapter")),r=i.indexOf(a);i.splice(r,1),dq("#hd_story_chapter").value=JSON.stringify(i)}$(t[0]).remove();var l=dqa("[data-row=db_row]");$(l).each(function(e,t){var a=t.querySelector("[name=item_no]");a&&(a.innerHTML=e+1)})}}},collect_story_chapter:async function(e,t){if(e){var a=JSON.parse(dqv("#hd_story")),i=dq("[name=form_area]");if(i){var r=i.querySelectorAll(".createBox[data-row=db_row]"),l=[];if($(r).each(function(e,t){l.push(create_role.story_chapter_pull_helper(t));var a=!0,i=pull_value_controller(t,"part_mode","0","radio");if(parseInt(i)>1){var o=t.querySelector("[data-url]");o&&o.getAttribute("data-url")||(a=!1)}var n=form_validate(t,"story_chapter");if(n.size>0||!a){"第"+(e+1)+"篇故事 填寫不完整\n";for(let e of n.keys()){var s=r[0].querySelector("[name="+e+"]").getAttribute("data-title");s+"  "+langTrans(n.get(e))+"\n"}a||"圖片尚未選擇\n","\n"}}),"back"==t){await ajax_post("/Create","StoryChapterSave",l);var o=await ajax_post("/Create","StoryDataValidate",{id:a.id});cl("validRet",o),o.data1&&alert(o.data2+"\n"+o.data1+"\n"),location="/Create/StoryForm?id="+getReq("id")}if("view"==t){await ajax_post("/Create","StoryChapterSave",l);o=await ajax_post("/Create","StoryDataValidate",{id:a.id});cl("validRet",o),o.data1&&alert(o.data2+"\n"+o.data1+"\n"),window.open("/Home/StoryDetail?id="+getReq("id")),location=location}if("go"==t){await ajax_post("/Create","StoryChapterSave",l);o=await ajax_post("/Create","StoryDataValidate",{id:a.id});cl("validRet",o),o.data1&&alert(o.data2+"\n"+o.data1+"\n"),location="/Create/StoryAlbum?id="+getReq("id")}if("timer"==t){await ajax_post("/Create","StoryChapterSave",l);o=await ajax_post("/Create","StoryDataValidate",{id:a.id});cl("validRet",o),o.data1&&alert(o.data2+"\n"+o.data1+"\n")}if("more"==t){await ajax_post("/Create","StoryChapterSave",l);o=await ajax_post("/Create","StoryDataValidate",{id:a.id});cl("validRet",o),o.data1&&alert(o.data2+"\n"+o.data1+"\n"),location="/Home/Result?viewmode=pic&editmode=chapter_"+getReq("id")}}}},story_chapter_edit_push:function(){this.keep_window_push();var e=JSON.parse(dqv("#hd_story_chapter"));0==e.length&&$("#btnAddForm").click();var t=dq("[name=form_area]");if(t){var a=dq(".createBox[data-row=temp_row]");$(e).each(function(e,i){var r=$(a).clone();i=common_role.output_data_process_controller(null,"DataObjInit",i,null),r.show(),r.attr("data-row","db_row"),push_form_controller(r[0],i,common_role.form_push_format("chapter"));var l=r[0].querySelector("[name=item_no]");l&&(l.innerHTML=e+1),r[0].id="data_form",push_value_controller(r[0],"part_mode",i.part_mode,"radio"),r[0].id="";var o=i.cite_indexcode.split("@#@"),n=i.cite_identity.split("@#@"),s=i.material_image_url.split("@#@"),d=i.rights.split("@#@"),c="";for(e=0;e<s.length;e++){var _=s[e];_&&(_=_.replace(" ","%20")),c+="<div data-row='db_row' >",c+="<div class='photo' data-indexcode='"+o[e]+"' data-identity='"+n[e]+"' data-url='"+_+"' data-right='"+d[e]+"'>",c+="<span class='img' style='background-image:url("+_+")'></span><span name='video' style='display:none'></span></div>",c+="<div class='picTool edph'>",c+="<a href='javascript:();' class='tool-delete' onclick='create_role.story_chapter_keep_select_remove(this)' title='刪除'>刪除</a>",c+="<a href='javascript:();' class='tool-prev' onclick='create_role.story_album_keep_select_sort(this, \"prev\")' title='排序向前'>排序向前</a>",c+="<a href='javascript:();' class='tool-next' onclick='create_role.story_album_keep_select_sort(this, \"next\")' title='排序向後'>排序向後</a>",c+="</div></div>"}r[0].querySelector("[name=photo_form]").innerHTML=c,$(t).append(r);var h=r[0].querySelector("[name=part_mode]:checked");create_role.chapter_part_mode_change_helper(h)})}},story_confirm_push:function(){var e=dq("#story_form");if(e){var t=JSON.parse(dqv("#hd_story"));t=common_role.output_data_process_controller(null,"DataObjInit",t,null),push_form_controller(e,t,common_role.form_push_format("default"));var a=JSON.parse(dqv("#hd_story_chapter")),i=dq("[name=form_area]");if(i){var r=dq("[data-row=temp_row]");$(a).each(function(e,t){var a=$(r).clone();t=common_role.output_data_process_controller(null,"DataObjInit",t,null),a.show(),a.attr("data-row","db_row"),push_form_controller(a[0],t,common_role.form_push_format("story")),$(i).append(a)})}}},story_finish:async function(e){var t=JSON.parse(dqv("#hd_story"));t=common_role.output_data_process_controller(null,"DataObjInit",t,null);var a=[],i=dq("#photo_form");if(i){var r=i.querySelectorAll("[data-row=db_row]");if($(r).each(function(e,t){a.push(create_role.story_album_pull_helper(t))}),"back"==e){await ajax_post("/Create","StoryAlbumSave",a);var l=await ajax_post("/Create","StoryDataValidate",{id:t.id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),location="/Create/StoryChapter?id="+getReq("id")}if("view"==e){await ajax_post("/Create","StoryAlbumSave",a);l=await ajax_post("/Create","StoryDataValidate",{id:t.id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),window.open("/Home/StoryDetail?id="+getReq("id")),location=location}if("go"==e){t.memo="",await ajax_post("/Create","StorySave",t),await ajax_post("/Create","StoryAlbumSave",a);l=await ajax_post("/Create","StoryDataValidate",{id:t.id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n"),location="/Create/StoryFinish?id="+getReq("id")}if("timer"==e){t.memo="",await ajax_post("/Create","StorySave",t),await ajax_post("/Create","StoryAlbumSave",a);l=await ajax_post("/Create","StoryDataValidate",{id:t.id});cl("validRet",l),l.data1&&alert(l.data2+"\n"+l.data1+"\n")}}},story_publish:async function(e){var t=JSON.parse(dqv("#hd_story"));if(t){if(1==e){var a=await ajax_post("/Create","StoryDataValidate",{id:t.id});if(cl("validRet",a),!a.isSuccess)return void alert(a.data2+"\n請至編輯頁面確認填寫完成後，再進行公開設定\n")}(t=common_role.output_data_process_controller(null,"DataObjInit",t,null)).is_enabled=e,t.memo="",await ajax_post("/Create","StorySave",t),ajax_post("/Home","KeepRecordStoryCloseSwitch",{id:t.id}),1==e&&alert("發佈後約5分鐘將可於記憶庫網站查詢。"),location="/Create/StoryList"}},story_list_view_push:function(){var e=dq("#story_list");if(e){var t=dq("[data-row=temp_row]"),a=JSON.parse(dqv("#hd_story")),i=a.data1;if($(i).each(function(a,i){var r=$(t).clone();i=common_role.output_data_process_controller(null,"DataObjInit",i,null),r.show(),r.attr("data-row","db_row");var l=r[0];push_form_controller(l,i,common_role.form_push_format("story"));var o=l.querySelector("[name=btnMore]");o&&(o.href="/Create/StoryDetail?id="+i.id),$(e).append(r)}),a.data3&&a.data3.length>0){var r=front_default_pager_html2(a.data3);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(r)})}}},file_view_helper:function(e,t){if(e){var a=$(e).find("[data-file_view]");a.html("");var i=e.getAttribute("data-file_tag");e.getAttribute("data-file_area");if(dq("#hd_infos_temp"))this.keep_window_upload(e,t);else if(t){var r="",l=[];"material_img"!=i&&"story_cover_img"!=i&&"story_chapter_img"!=i||(l=t.filter(e=>e.tag==i&&""==e.img_size),r=common_role.file_view_html_helper(l,"material_img")),a.html(r)}}},keep_window_upload:async function(e,t){var a=$(e).data("dataObj");if(a){var i=await ajax_post("/Create","MaterialSave",[a]);if(cl("ret",i),i.isSuccess){a=i.data1[0];var r=dq("#hd_infos_temp");if(r.value){var l=JSON.parse(r.value),o=t.length>0?t[0].path:"";l.unshift({Id:a.id,Title:"",Rights:"NULL",ImageUrl:o,IndexCode:"member_material"}),r.value=JSON.stringify(l)}create_role.keep_window_push(),$("#modalUploadTip").modal("show")}}}},material_role={role_name:"material_role",unit_name:"material",add_form_id:"add_form",edit_form_id:"edit_form",table_id:"list_table",option_tags:[],submit_process_status:"",submit_status_helper:function(e){this.submit_process_status=e?e+" processing":""},ControllerName:dq("#ControllerName")?dqv("#ControllerName"):"Home",indexconfig_cache_save:async function(){ajax_post("/Home","SetPageCache",{tag:"indexconfig",content:JSON.stringify(indexconfig)}),ajax_post("/Home","IndexNameCacheUpdate",{content:JSON.stringify(indexconfig)})},SL_right_content_trigger:function(e){if(e){var t=dq("#right_intro");if(t){$(t.querySelector("img")).hide(),t.querySelector("[name=title]").innerHTML="",t.querySelector("[name=content]").innerHTML="";var a=e.getAttribute("data-right");if(a){cl("SL_right_content_trigger => rightName",a);var i=JSON.parse(dqv("#hd_right_list")).filter(e=>e.tag==a);i.length>0&&(i=i[0],$(t.querySelector("img")).show(),t.querySelector("img").src="../Content/nrch/images/"+i.icon_name+".png",t.querySelector("[name=title]").innerHTML=i.tag,t.querySelector("[name=content]").innerHTML=i.content)}}}},typeahead_load:function(){$(".typeahead").typeahead({source:async function(e,t){if(e&&e.length>1){var a={Keyword:e,Size:10};cl("FetchExtendKeyword => input",a);var i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchExtendKeyword",q:JSON.stringify(a)});if(i&&!i.Error){var r=JSON.parse(i.JsonData);r&&r.length>1&&r[0]!=e&&r.unshift(e),t(r)}}else t([])},updater:function(e){return e.replace(/<a(. ?)<\/a>/,"")},afterSelect:function(e){},items:11,delay:500,hint:!0,highlight:!0})},clear_search_input:function(e){if(e){var t=$(e).closest("[search-panel]")[0];if(t){for(var a=t.querySelectorAll("input"),i=0;i<a.length;i++){var r=a[i];"checkbox"==r.type?(r.checked=!1,$(r).parent("div").removeClass("checked")):r.value=""}a=t.querySelectorAll("select");for(i=0;i<a.length;i++)a[i].value=""}}},add_search_redirect:function(e,t,a){if(e&&t){a||(a="replace");var i=location.pathname;i=i.toLowerCase().indexOf("home/news")>-1?"/Home/News":i.toLowerCase().indexOf("home/faq")>-1?"/Home/Faq":"/"+this.ControllerName+"/Result";var r=paramFinder(location.href);if("unique"==a)return(r=[]).push({name:e,v:t}),void(location=redirectAssistant(i,r));var l=r.filter(t=>t.name==e);if(l.length>0){if((l=l[0]).v.split(" ").indexOf(t)>-1||l.v==t)return void(location=location);"add"==a?l.v+=" and "+t:"unique"==a?(r=[]).push({name:e,v:t}):l.v=t}else r.push({name:e,v:t});if("Date"==e){var o=r.filter(e=>"StartDate"==e.name);if(o.length>0)o=o[0],(n=r.indexOf(o))>-1&&r.splice(n,1);var n,s=r.filter(e=>"EndDate"==e.name);if(s.length>0)s=s[0],(n=r.indexOf(s))>-1&&r.splice(n,1)}location=redirectAssistant(i,r)}},search_redirect:function(e){if(e){var t=$(e).closest("[search-panel]")[0];if(t){var a=location.pathname;a="/"+this.ControllerName+"/Result";var i=[],r="",l="";if(l="viewmode",(r=getReq(l))&&i.push({name:l,v:r}),l="editmode",(r=getReq(l))&&i.push({name:l,v:r}),l="Keyword",(r=document.querySelector("[name="+l+"]"))&&r.value)i.push({name:l,v:r.value}),"Story"==this.ControllerName?ajax_post("/Home","StoryHotKeywordSave",{tag:r.value}):ajax_post("/Home","HotKeywordSave",{tag:r.value});else if(dq("#hd_hot_keyword")){var o=dq("#hd_search_query"),n=o.value?JSON.parse(o.value):"";n&&n.Keyword&&(i.push({name:l,v:n.Keyword}),"Story"==this.ControllerName?ajax_post("/Home","StoryHotKeywordSave",{tag:r.value}):ajax_post("/Home","HotKeywordSave",{tag:r.value}))}if(l="Filter_TimePeroid",(r=t.querySelector("[name="+l+"]"))&&r.value&&i.push({name:l,v:r.value}),l="Filter_FileType",(r=t.querySelector("[name="+l+"]"))&&r.value&&i.push({name:l,v:r.value}),l="StartDate",(r=t.querySelector("[name="+l+"]"))&&r.value&&i.push({name:l,v:r.value}),l="EndDate",(r=t.querySelector("[name="+l+"]"))&&r.value&&i.push({name:l,v:r.value}),l="IndexList",r=t.querySelector("[name="+l+"]")){var s=[];if((v=r.querySelectorAll("[value]:checked")).length>0){for(var d=0;d<v.length;d++)s.push(v[d].value);i.push({name:l,v:s.join(",")})}}if(l="story_source",r=t.querySelector("[name="+l+"]")){s=[];if((v=r.querySelectorAll("[value]:checked")).length>0){for(d=0;d<v.length;d++)s.push(v[d].value);i.push({name:"IndexList",v:s.join(",")})}}if(l="Filter_Category",r=t.querySelector("[name="+l+"]")){var c=[];if((v=r.querySelectorAll("[name='classtype'][data-level='1']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:"Filter_Keyword_Subject_1",v:c.join(",")});var _=[];if((v=r.querySelectorAll("[name='classtype'][data-level='2']:checked")).length>0)for(d=0;d<v.length;d++){var h=$(v[d]).closest("li").find("[data-level='1']")[0];c.indexOf(h.value)<0&&_.push(v[d].value)}_.length>0&&i.push({name:"Filter_Keyword_Subject_2",v:_.join(",")})}if(l="Filter_AuthorizedState",r=t.querySelector("[name="+l+"]")){c=[];if((v=r.querySelectorAll("[name='rightsway'][data-level='1']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:"Filter_Keyword_Rights_1",v:c.join(",")});_=[];if((v=r.querySelectorAll("[name='rightsway'][data-level='2']:checked")).length>0)for(d=0;d<v.length;d++){h=$(v[d]).closest("li").closest("ul").closest("li").find("[data-level='1']")[0];cl("parent",h),_.push(v[d].value)}_.length>0&&i.push({name:"Filter_Keyword_Rights_2",v:_.join(",")})}if(l="Filter_Des_Right",r=t.querySelector("[name="+l+"]")){c=[];if((v=r.querySelectorAll("[name='desrightsway'][data-level='1']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:"Filter_Keyword_Des_Rights_1",v:c.join(",")});_=[];if((v=r.querySelectorAll("[name='desrightsway'][data-level='2']:checked")).length>0)for(d=0;d<v.length;d++){h=$(v[d]).closest("li").closest("ul").closest("li").find("[data-level='1']")[0];cl("parent",h),_.push(v[d].value)}_.length>0&&i.push({name:"Filter_Keyword_Des_Rights_2",v:_.join(",")})}if(l="Filter_Format",r=t.querySelector("[name="+l+"]")){c=[];if((v=r.querySelectorAll("[name='format']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:"Filter_Keyword_Format",v:c.join(";")})}if(l="Filter_Century",r=t.querySelector("[name="+l+"]")){c=[];if((v=r.querySelectorAll("[name='Century']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:"Filter_Century",v:c.join(",")})}if(l="Filter_CityDist",r=t.querySelector("[name="+l+"]")){var u=[],p=r.querySelector("[name=city]").value;p&&u.push(p);var m=r.querySelector("[name=area]").value;m&&u.push(m),u.length>0&&i.push({name:"Filter_CityDist",v:u.join(",")})}for(var f=["Filter_Keyword_People","Filter_Keyword_Event","Filter_Keyword_Location","Filter_Keyword_Object"],g=0;g<f.length;g++)if(l=f[g],r=t.querySelector("[name="+l+"]")){c=[];if((v=r.querySelectorAll("[type='checkbox']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:l,v:c.join(",")})}if(l="SearchMode",i.push({name:"SearchMode",v:"Precise"}),l="LanguageMode",r=t.querySelector("[name="+l+"]")){var v;c=[];if((v=r.querySelectorAll("[name='LanguageMode']:checked")).length>0)for(d=0;d<v.length;d++)c.push(v[d].value);c.length>0&&i.push({name:"LanguageMode",v:c.join(";")})}location=redirectAssistant(a,i)}}},size_and_order_redirect:function(e){if(e){var t=$(e).closest("[search-panel]")[0];if(t){for(var a=location.pathname,i=paramFinder(location.href),r=["PageSize","OrderColumn"],l=0;l<r.length;l++){var o=t.querySelector("[name="+r[l]+"]").value,n=i.filter(e=>e.name==r[l]);if(n.length>0)(n=n[0]).v.split(" ").indexOf(o)>-1||(n.v=o);else i.push({name:r[l],v:o})}var s=i.filter(e=>"p"==e.name);if(s.length>0){s=s[0];var d=i.indexOf(s);d>-1&&i.splice(d,1)}location=redirectAssistant(a,i)}}},search_value_push_helper:function(){var e=document.querySelectorAll("[search-panel]");if(!(e.length<1)){for(var t=[],a="",i="",r="",l=0;l<e.length;l++){var o=e[l];if(a="Keyword",i=getReq(a)){for(;i.indexOf("\\")>-1;)i=i.replace("\\","");(r=o.querySelector("[name="+a+"]"))&&(r.value=i),0==l&&t.push({text:"關鍵字："+i,value:a})}if(a="Filter_TimePeroid",(i=getReq(a))&&(r=o.querySelector("[name="+a+"]"))&&(r.value=i),a="Filter_FileType",(i=getReq(a))&&(r=o.querySelector("[name="+a+"]"))&&(r.value=i),a="PageSize",(i=getReq(a))&&((r=o.querySelector("[name="+a+"]"))&&(r.value=i),0==l&&t.push({text:"每頁"+i+"筆",value:a})),a="StartDate",(i=getReq(a))&&((r=o.querySelector("[name="+a+"]"))&&(r.value=i),0==l&&t.push({text:"起始日期："+i,value:a})),a="EndDate",(i=getReq(a))&&((r=o.querySelector("[name="+a+"]"))&&(r.value=i),0==l&&t.push({text:"迄止日期："+i,value:a})),a="Date",i=getReq(a)){var n=JSON.parse(dqv("#hd_search_query"));if(n){var s=o.querySelector("[name=StartDate]");s&&(s.value=n.StartDate);var d=o.querySelector("[name=EndDate]");d&&(d.value=n.EndDate)}0==l&&t.push({text:"時間序列："+i,value:a})}if(a="IndexList",i=getReq(a)){if(r=o.querySelector("[name=story_source]")){for(var c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='source'][value='"+c[_]+"']"))&&(common_role.iCheck_AllCheck_helper(b),$(b).iCheck("check"))}1==l&&t.push({text:"來源："+i.replaceAll("member_story","創作區故事").replaceAll("outside_story","站外故事").replaceAll("cnaphoto","中央社").replaceAll("taiwanstory","臺灣小故事101"),value:a})}if(r=o.querySelector("[name="+a+"]")){for(c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='source'][value='"+c[_]+"']"))&&(common_role.iCheck_AllCheck_helper(b),$(b).iCheck("check"))}if(1==l){var h=[];$(r).find("[data-level='1']:checked").each(function(){h.push(this)}),$(r).find("[data-level='2']:checked").each(function(){h.push(this)});var u=[],p=[],m=$(r).find("[data-stat_name='文化部']").closest("li").find("[data-level='2']:checked");5==m.length&&($(m).each(function(){p.push(this)}),u.push("文化部")),1==(m=$(r).find("[data-stat_name='國史館']").closest("li").find("[data-level='2']:checked")).length&&($(m).each(function(){p.push(this)}),u.push("國史館")),2==(m=$(r).find("[data-stat_name='國立故宮博物院']").closest("li").find("[data-level='2']:checked")).length&&($(m).each(function(){p.push(this)}),u.push("國立故宮博物院")),2==(m=$(r).find("[data-stat_name='陳澄波基金會']").closest("li").find("[data-level='2']:checked")).length&&($(m).each(function(){p.push(this)}),u.push("陳澄波基金會")),$(h).each(function(){-1==p.indexOf(this)&&u.push($(this).closest("[data-stat_name]").attr("data-stat_name"))}),t.push({text:"資料來源機關："+[...new Set(u)].join(","),value:a})}}}if(a="Filter_Century",i=getReq(a)){var f=i.split(","),g=[];for(_=0;_<f.length;_++){var v=parseInt(f[_]);g.push(v?v+"~"+(v+99):"?")}0==l&&t.push({text:"時間區間："+g.join(","),value:a})}a="Filter_CityDist";var y=(f=(i=getReq(a))?i.split(","):[""])[0],S=f.length>1?f[1]:"",q=JSON.parse(dqv("#hd_ddl_city"));if(q&&q.length>0){var x="";for(_=0;_<q.length;_++)x+=optionCreater(q[_].value,q[_].text)}if((r=o.querySelector("[name='Filter_CityDist']"))&&(r=r.querySelector("[name=city]")),r){$(r).append(x),r.value=y,create_role.city_changer(r);var w=o.querySelector("[name='Filter_CityDist']").querySelector("[name=area]");w&&(w.value=S)}if(i&&0==l&&t.push({text:"縣市行政區："+i,value:a}),a="Filter_Keyword_Subject_1",i=getReq(a)){if(r=o.querySelector("[name='Filter_Category']"))for(c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='classtype'][data-level='1'][value='"+c[_]+"']"))&&$(b).click()}0==l&&t.push({text:"主題分類："+i,value:a})}if(a="Filter_Keyword_Subject_2",(i=getReq(a))&&(r=o.querySelector("[name='Filter_Category']")))for(c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='classtype'][data-level='2'][value='"+c[_]+"']"))&&$(b).click()}if(a="Filter_Keyword_Rights_1",(i=getReq(a))&&(r=o.querySelector("[name='Filter_AuthorizedState']")))for(c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='rightsway'][data-level='1'][value='"+c[_]+"']"))&&$(b).iCheck("check")}if(a="Filter_Keyword_Rights_2",i=getReq(a)){if(r=o.querySelector("[name='Filter_AuthorizedState']"))for(c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='rightsway'][data-level='2'][value='"+c[_]+"']"))&&$(b).click()}0==l&&t.push({text:"數位物件授權："+i.replaceAll(";",","),value:a})}if(a="Filter_Keyword_Des_Rights_2",i=getReq(a)){if(r=o.querySelector("[name='Filter_Des_Right']"))for(c=i.split(","),_=0;_<c.length;_++){(b=r.querySelector("[name='desrightsway'][data-level='2'][value='"+c[_]+"']"))&&$(b).click()}0==l&&t.push({text:"描述文字授權："+i.replaceAll(";",","),value:a})}if(a="Filter_Keyword_Format",i=getReq(a)){if(r=o.querySelector("[name='Filter_Format']"))for(c=i.split(";"),_=0;_<c.length;_++){(b=r.querySelector("[name='format'][value='"+c[_]+"']"))&&$(b).iCheck("check")}0==l&&t.push({text:"數位物件類型："+i,value:a})}if(a="OrderColumn",i=getReq(a),r=o.querySelector("[name="+a+"]"),i?(r&&(r.value=i),"date"==i&&(i="時間新→舊"),"imilarity"==i&&(i="相似度高→低"),"view"==i&&(i="點閱高→低"),0==l&&t.push({text:"排序查詢："+i,value:a})):getReq("Keyword")&&r&&(r.value="imilarity"),a="Filter_Keyword_People",(i=getReq(a))&&0==l&&t.push({text:"人物："+i,value:a}),a="Filter_Keyword_Event",(i=getReq(a))&&0==l&&t.push({text:"事件："+i,value:a}),a="Filter_Keyword_Location",(i=getReq(a))&&0==l&&t.push({text:"地點："+i,value:a}),a="Filter_Keyword_Object",(i=getReq(a))&&0==l&&t.push({text:"物品："+i,value:a}),a="SearchMode",(i=getReq(a))||(i="Precise"),i){if(r=o.querySelector("[name='SearchMode']"))for(c=i.split(";"),_=0;_<c.length;_++){(b=r.querySelector("[name='SearchMode'][value='"+c[_]+"']"))&&$(b).iCheck("check")}"Precise"==i&&(i="一字不差(精確搜尋)"),"Fuzzy"==i&&(i="所有結果(模糊搜尋)"),0==l&&t.push({text:"查詢模式："+i,value:a})}if(a="LanguageMode",i=getReq(a)){if(r=o.querySelector("[name='LanguageMode']"))for(c=i.split(";"),_=0;_<c.length;_++){var b;(b=r.querySelector("[name='LanguageMode'][value='"+c[_]+"']"))&&$(b).iCheck("check")}i=i.replaceAll("Soundex","中文同音").replaceAll("Meandex","中英同義").replaceAll("Transfer","繁簡對譯").replaceAll(";","、"),0==l&&t.push({text:"語言轉換："+i,value:a})}}var C=document.createElement("div"),I="";if(t.length>0){$(t).each(function(){C.innerHTML="";var e=document.createTextNode(this.text);C.appendChild(e);var t=C.innerHTML;I+="<li onclick=\"material_role.rm_search_redirect('"+this.value+"')\">"+t+"<span></span></li>"});var k=getReq("viewmode")?"?viewmode="+getReq("viewmode"):"",O=getReq("editmode")?"&editmode="+getReq("editmode"):"";I+="<li class='Terms-Clear' onclick=\"location='/Home/Result"+k+O+"'\">清除全部<span></span></li>",$("#keyWd-list").find("ul").html(I)}I||$("#keyWd-list").hide()}},rm_search_redirect:function(e){var t=paramFinder(location.href),a=t.filter(t=>t.name==e);if(a.length>0){a=a[0];var i=t.indexOf(a);i>-1&&t.splice(i,1)}var r=location.pathname;r.indexOf("/Detail")&&(r=r.replace("/Detail","/Result")),location=redirectAssistant(r,t)},FetchIndex_data_push:function(){var e=document.querySelector("#hd_fi_list").value,t=e?JSON.parse(e):"";if(t&&!t.Error){t.JsonData=JSON.parse(t.JsonData),cl("FetchIndex_data_push => $ret",t);for(var a=t.JsonData,i="",r=document.querySelectorAll("[name=FetchIndex_area]"),l=0;l<r.length;l++){i="";for(var o="<label data-stat_name='{indexname}' for='{indexname}{level}'><input id='{indexname}{level}' type='checkbox' data-level='{level}' name='source' {value_tag} >{indexname}<i></i></label>",n=0;n<a.length;n++){i+="<li>";var s=a[n].ChildIndex,d=[];s&&$(s).each(function(){this.IndexCode&&d.push(this.IndexCode)}),i+=o.replaceAll("{value_tag}",a[n].IndexCode?"value='"+a[n].IndexCode+"'":"").replaceAll("{indexname}",a[n].IndexName).replaceAll("{level}",1).replaceAll("{childs}",d.join(",")),s&&(i+=this.child_option_builder(o,s,2)),i+="</li>"}r[l].innerHTML=i,$(r[l]).find("[value]").closest("ul").hide()}i="";for(l=0;l<a.length;l++){s=$(r[0]).find("#"+a[l].IndexName+"1").closest("li").find("[value]");var c=[];$(s).each(function(){c.push(this.value)}),i+="<li><a href='javascript:;' onclick=\"material_role.add_search_redirect('IndexList', '"+c.join(",")+"', 'unique')\" >"+a[l].IndexName+"</a></li>"}var _=document.querySelector("#source_link");_&&(_.innerHTML=i)}},child_option_builder:function(e,t,a){if(!t||t.length<1)return"";var i="";i+="<ul>";for(var r=0;r<t.length;r++){var l=t[r].ChildIndex,o=[];l&&$(l).each(function(){this.IndexCode&&o.push(this.IndexCode)}),i+="<li>",i+=e.replaceAll("{value_tag}",t[r].IndexCode?"value='"+t[r].IndexCode+"'":"").replaceAll("{indexname}",t[r].IndexName).replaceAll("{level}",a).replaceAll("{childs}",o.join(",")),l&&(i+=this.child_option_builder(e,l,a+1)),i+="</li>"}return i+="</ul>"},Filter_Century_data_push:async function(){var e="",t=dq("#hd_century_data");if(t&&t.value)e=t.value;else{var a=dq("#hd_search_query");if(!a)return;var i=JSON.parse(a.value);i.DateStatisticsType="Century",i.HaveDate=!0;var r=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchDateStatistics",q:JSON.stringify(i)});if(!r||r.Error)return;e=r.JsonData,t&&(t.value=e)}if(e){e=JSON.parse(e);var l=Object.entries(e);cl("Filter_Century_data_push => source ",l);for(var o=getReq("Filter_Century")?getReq("Filter_Century").split(","):[],n="",s=document.querySelectorAll("[name=Filter_Century]"),d=0;d<s.length;d++){n="";for(var c=0;c<l.length;c++){var _=o.indexOf(l[c][0])>-1?"checked=checked":"";n+="<li><label for='Century{name}'><input id='Century{name}' {checkedTag} type='checkbox' name='Century' value='{name}'>{name}~{lastyear}<i></i></label></li>".replaceAll("{name}",l[c][0]).replaceAll("{lastyear}",parseInt(l[c][0])+99).replaceAll("{checkedTag}",_)}s[d].innerHTML=n,$(s[d]).find("input").iCheck({radioClass:"formRadio",checkboxClass:"formCheck"})}var h=document.querySelector("#refineSearch");if(h&&(h=h.querySelector("[name=Filter_Century]"))){var u="";for(d=0;d<l.length;d++){var p=l[d],m=p[0],f=p[1],g=h.querySelector("input[value='"+m+"']");if(g){var v=$(g).closest("label").find("i");v.length>0&&(v[0].innerHTML=moneyFormat(f)),u||(u=$(g).closest(".searchbody")[0])}}if(u){var y=u.querySelectorAll("i");for(d=0;d<y.length;d++){(f=y[d].innerHTML)||(y[d].innerHTML="0")}}}}},Filter_Category_data_push:function(){for(var e=[{IndexName:"人物與團體",IndexCode:"人物與團體"},{IndexName:"藝術與人文",IndexCode:"藝術與人文"},{IndexName:"社會與政治",IndexCode:"社會與政治"},{IndexName:"民俗與宗教",IndexCode:"民俗與宗教"},{IndexName:"產業與經濟",IndexCode:"產業與經濟"},{IndexName:"空間、地域與遷徙",IndexCode:"空間、地域與遷徙"},{IndexName:"族群與語言",IndexCode:"族群與語言"},{IndexName:"生物、生態與環境",IndexCode:"生物、生態與環境"},{IndexName:"其他",IndexCode:"其他"}],t="",a=document.querySelectorAll("[name=Filter_Category]"),i=0;i<a.length;i++){t="";for(var r="<label for='{indexcode}'><input id='{indexcode}' type='checkbox' data-level='{level}' name='classtype' value='{indexcode}'>{indexname}<i></i></label>",l=0;l<e.length;l++){t+="<li>",t+=r.replaceAll("{indexcode}",e[l].IndexCode).replaceAll("{indexname}",e[l].IndexName).replaceAll("{level}","1");var o=e[l].ChildIndex;if(o&&o.length>0){t+="<ul>";for(var n=0;n<o.length;n++)t+="<li>",t+=r.replaceAll("{indexcode}",o[n].IndexCode).replaceAll("{indexname}",o[n].IndexName).replaceAll("{level}","2"),t+="</li>";t+="</ul>"}t+="</li>"}a[i].innerHTML=t}},Filter_AuthorizedState_data_push:function(){for(var e=JSON.parse(dqv("#hd_right_list")),t=[{IndexName:"無償利用 Free Re-use",IndexCode:"無償利用 Free Re-use",ChildIndex:[{IndexName:"PDM",IndexCode:"PDM"},{IndexName:"CC0",IndexCode:"CC0"},{IndexName:"OGDL",IndexCode:"OGDL"},{IndexName:"CC BY",IndexCode:"CC BY"},{IndexName:"CC BY-SA",IndexCode:"CC BY-SA"}]},{IndexName:"有限度利用 Limited Re-use",IndexCode:"有限度利用 Limited Re-use",ChildIndex:[{IndexName:"CC BY-NC",IndexCode:"CC BY-NC"},{IndexName:"CC BY-NC-SA",IndexCode:"CC BY-NC-SA"},{IndexName:"CC BY-ND",IndexCode:"CC BY-ND"},{IndexName:"CC BY-NC-ND",IndexCode:"CC BY-NC-ND"}]},{IndexName:"僅供瀏覽 No Re-use",IndexCode:"僅供瀏覽 No Re-use",ChildIndex:[{IndexName:"僅限公開瀏覽",IndexCode:"僅限公開瀏覽"}]}],a="",i=0;i<t.length;i++){if((c=t[i].ChildIndex)&&c.length>0)for(var r=0;r<c.length;r++){var l="";(_=e.filter(e=>e.tag==c[r].IndexName)).length>0&&(l=_[0].title),a+="<li data-toggle='tooltip' title='"+l+"'><a href='javascript:;' onclick=\"material_role.add_search_redirect('Filter_Keyword_Rights_2', '"+c[r].IndexCode+"', 'unique')\" >"+c[r].IndexName+"</a></li>"}}var o=document.querySelector("#rights_link");o&&(o.innerHTML=a);var n=document.querySelectorAll("[name=Filter_AuthorizedState]");for(i=0;i<n.length;i++){a="";for(var s="<label for='img_"+i+"_{indexcode}' data-toggle='tooltip' title='{popup_text}'><input id='img_"+i+"_{indexcode}' type='checkbox' data-level='{level}' name='rightsway' value='{indexcode}'>{indexname}<i></i></label>",d=0;d<t.length;d++){if((c=t[d].ChildIndex)&&c.length>0)for(r=0;r<c.length;r++){a+="<li>";l="";(_=e.filter(e=>e.tag==c[r].IndexName)).length>0&&(l=_[0].title),a+=s.replaceAll("{indexcode}",c[r].IndexCode).replaceAll("{indexname}",c[r].IndexName).replaceAll("{popup_text}",l).replaceAll("{level}","2"),a+="</li>"}}n[i].innerHTML=a}for(n=document.querySelectorAll("[name=Filter_Des_Right]"),i=0;i<n.length;i++){a="";for(s="<label for='des_"+i+"_{indexcode}' data-toggle='tooltip' title='{popup_text}'><input id='des_"+i+"_{indexcode}' type='checkbox' data-level='{level}' name='desrightsway' value='{indexcode}'>{indexname}<i></i></label>",d=0;d<t.length;d++){var c;if((c=t[d].ChildIndex)&&c.length>0)for(r=0;r<c.length;r++){a+="<li>";var _;l="";(_=e.filter(e=>e.tag==c[r].IndexName)).length>0&&(l=_[0].title),a+=s.replaceAll("{indexcode}",c[r].IndexCode).replaceAll("{indexname}",c[r].IndexName).replaceAll("{popup_text}",l).replaceAll("{level}","2"),a+="</li>"}}n[i].innerHTML=a}},Fetch_Subject1_Statistics_data_push:async function(){var e=dqv("#hd_cache_homepage_FetchKeywordStatistics");try{JSON.parse(e)}catch(t){e=""}var t=dqv("#hd_cache_homepage_totalcount"),a=document.querySelector("[id=hd_search_query]"),i=a.value?JSON.parse(a.value):"";i.HaveDate=!1,i.HaveGeo=!1,i.PageSize=10,i.OrderColumn=[],i.KeywordStatisticsColumn="Keyword_Subject_1",cl("Fetch_Subject1_Statistics_data_push => q",i);var r=i.Keyword,l="";if(e){var o=JSON.parse(e);l=Object.entries(JSON.parse(o.JsonData))}else{var n=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchKeywordStatistics",q:JSON.stringify(i)});if(cl("Fetch_Subject1_Statistics_data_push => ret.JsonData",n),!n||n.Error)return}if((i=(a=document.querySelector("[id=hd_search_query]")).value?JSON.parse(a.value):"").Keyword="",i.HaveDate=!1,i.HaveGeo=!1,i.PageSize=1,i.OrderColumn=[],t)$("#TotalDocNo").html(moneyFormat(t));else{var s=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(i)});s&&!s.Error&&(s.JsonData=JSON.parse(s.JsonData),$("#TotalDocNo").html(moneyFormat(s.JsonData.TotalDocNo)))}cl("Fetch_Subject1_Statistics_data_push => source",l);var d=document.querySelector("#staData");if(d){for(var c=0;c<l.length;c++){var _=l[c],h=_[0],u=_[1],p=d.querySelector("[name='"+h+"']");p&&(p.href="/Home/Result?Filter_Keyword_Subject_1="+h+"&Keyword="+r,(u=moneyFormat(u))||(u=0),p.querySelector("span").innerHTML="("+u+")")}var m=dq("#staData");if(m){var f=m.querySelectorAll("span");for(c=0;c<f.length;c++){(u=f[c].innerHTML)||(f[c].innerHTML="(0)")}}}},FetchKeywordStatistics2_data_push:async function(e){var t=document.querySelector("[id=hd_search_query]"),a=t.value?JSON.parse(t.value):"";a.HaveDate=!1,a.HaveGeo=!1,a.OrderColumn=[],a.KeywordStatisticsColumn=e,a.PageSize=10,cl("FetchKeywordStatistics2_data_push => "+e+" => q",a);var i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchKeywordStatistics",q:JSON.stringify(a)});if(cl("FetchKeywordStatistics2_data_push => "+e+" => ret",i),i&&!i.Error){i.JsonData=JSON.parse(i.JsonData);var r=Object.entries(i.JsonData);cl("FetchKeywordStatistics2_data_push => "+e+" => source",r);var l=getReq("Filter_"+e)?getReq("Filter_"+e).split(","):[],o="",n=dq("[name=Filter_"+e+"]");if(n){for(var s=0;s<(r.length>5?5:r.length);s++){var d=r[s],c=d[0],_=d[1];o+="<li><label for='"+e+s+"'><input id='"+e+s+"' "+(l.indexOf(c)>-1?"checked=checked":"")+" type='checkbox' name='"+e+"' value='"+c+"'>"+c+"<i>"+_+"</i></label></li>"}n.innerHTML=o,$(n).find("input").iCheck({radioClass:"formRadio",checkboxClass:"formCheck"})}}},FetchKeywordStatistics_data_push:async function(e){var t=document.querySelector("[id=hd_search_query]"),a=t.value?JSON.parse(t.value):"";a.HaveDate=!1,a.HaveGeo=!1,a.OrderColumn=[],a.KeywordStatisticsColumn=e,cl("FetchKeywordStatistics_data_push => "+e+" => q",a);var i="",r=dq("#hd_home_FetchKeywordStatistics_"+e);if(r&&r.value?i=JSON.parse(r.value):(i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchKeywordStatistics",q:JSON.stringify(a)}),cl("FetchKeywordStatistics_data_push => "+e+" => ret",i)),i&&!i.Error){i.JsonData=JSON.parse(i.JsonData);var l=Object.entries(i.JsonData);cl("FetchKeywordStatistics_data_push => "+e+" => source",l);var o=dq("#refineSearch").querySelector("[name="+e+"]");if(o){for(var n="",s=0;s<l.length;s++){var d=l[s],c=d[0],_=d[1],h=o.querySelector("input[value='"+c+"']");if(h){var u=$(h).closest("label").find("i");u.length>0&&(u[0].innerHTML=moneyFormat(_)),n||(n=$(h).closest(".searchbody")[0])}}if(n){var p=n.querySelectorAll("i");for(s=0;s<p.length;s++){(_=p[s].innerHTML)||(p[s].innerHTML="0")}}}}},FetchIndexStatistics_data_push:async function(){var e=document.querySelector("[id=hd_search_query]"),t=e.value?JSON.parse(e.value):"";t.HaveDate=!1,t.HaveGeo=!1,t.PageSize=1,cl("FetchIndexStatistics_data_push => q",t);var a="",i=dq("#hd_home_FetchIndexStatistics");if(i&&i.value?a=JSON.parse(i.value):(a=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchIndexStatistics",q:JSON.stringify(t)}),cl("FetchIndexStatistics_data_push => ret",a)),a&&!a.Error){a.JsonData=JSON.parse(a.JsonData);var r=Object.entries(a.JsonData);cl("FetchIndexStatistics => source",r);var l=dqv("#hd_fi_list"),o=l?JSON.parse(l):"";if(o&&!o.Error){var n=JSON.parse(o.JsonData),s=0;for(s=0;s<n.length;s++){var d=n[s];d.AllChildIndexCode=this.get_child_index(r,d.ChildIndex);var c=0;$(d.AllChildIndexCode).each(function(e,t){var a=r.filter(e=>e[0]==t);a.length>0&&(c+=a[0][1])}),d.StatNum=c}cl("source_data",n);var _=document.querySelector("#refineSearch");if(_){for(var h="",u=0;u<n.length;u++){var p=n[u],m=p.IndexName;if((v=p.StatNum)&&0!=v){var f=_.querySelector("[data-stat_name='"+m+"']");if(f){var g=$(f).find("i"),v=moneyFormat(v);g.length>0&&(g[0].innerHTML=v),h||(h=$(f).closest(".searchbody")[0])}}this.push_stat_num_helper(p.ChildIndex)}if(h){var y=h.querySelectorAll("i");for(u=0;u<y.length;u++){(v=y[u].innerHTML)||(y[u].innerHTML="0")}}}}}},FetchStoryIndexStatistics_data_push:async function(){var e=document.querySelector("[id=hd_search_query]"),t=e.value?JSON.parse(e.value):"";t.HaveDate=!1,t.HaveGeo=!1,t.PageSize=1,cl("FetchIndexStatistics_data_push => q",t);var a=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchIndexStatistics",q:JSON.stringify(t)});if(cl("FetchIndexStatistics_data_push => ret",a),a&&!a.Error){a.JsonData=JSON.parse(a.JsonData);var i=Object.entries(a.JsonData);cl("FetchIndexStatistics => source",i);var r=document.querySelector("#refineSearch");if(r){for(var l="",o=0;o<i.length;o++){var n=i[o],s=n[0];if((_=n[1])&&0!=_){var d=r.querySelector("[data-stat_name='"+s+"']");if(d){var c=$(d).find("i"),_=moneyFormat(_);c.length>0&&(c[0].innerHTML=_),l||(l=$(d).closest(".searchbody")[0])}}}if(l){var h=l.querySelectorAll("i");for(o=0;o<h.length;o++){(_=h[o].innerHTML)||(h[o].innerHTML="0")}}}}},push_stat_num_helper:function(e){if(e&&!(e.length<1)){var t=document.querySelector("#refineSearch");if(t)for(var a=0;a<e.length;a++){var i=e[a],r=i.IndexName,l=i.StatNum;if(l&&0!=l){var o=t.querySelector("[data-stat_name='"+r+"']");if(o){var n=$(o).find("i");n.length>0&&(n[0].innerHTML=moneyFormat(l))}}}}},get_child_index:function(e,t){var a=[];if(!t||t.length<1)return a;for(var i=0;i<t.length;i++){var r=t[i],l=r.IndexCode;l&&a.push(l);for(var o=this.get_child_index(e,r.ChildIndex),n=0;n<o.length;n++)a.push(o[n]);r.AllChildIndexCode=o;var s=0;$(r.AllChildIndexCode).each(function(t,a){var i=e.filter(e=>e[0]==a);i.length>0&&(s+=i[0][1])}),r.StatNum=s}return a},StatisticsProcessTag:[],LeftPanelOptionStatisticsProcess:async function(e){"top"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKMap_data_push(),this.tagcloud_data_push(),this.FetchDateStatistics_data_push()),"Keyword_Subject_1"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics_data_push(e)),"Keyword_Rights_2"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics_data_push(e)),"Keyword_Des_Rights_2"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics_data_push(e)),"FetchIndex"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchIndexStatistics_data_push()),"FetchStoryIndex"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchStoryIndexStatistics_data_push()),"Keyword_Format"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics_data_push(e)),"Keyword_People"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics2_data_push(e)),"Keyword_Event"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics2_data_push(e)),"Keyword_Location"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics2_data_push(e)),"Keyword_Object"==e&&this.StatisticsProcessTag.indexOf(e)<0&&(this.StatisticsProcessTag.push(e),this.FetchKeywordStatistics2_data_push(e)),cl("StatisticsProcessTag",this.StatisticsProcessTag)},keep_list_doc_view_helper:function(){var e=dqa(".photo");cl("keep_list_doc_view_helper => items",e),$(e).each(function(){var e=$(this).attr("data-url"),t=$(this).attr("data-indexcode"),a=$(this).closest(".info").find("[name=title]").html(),i=getImgUrlExten(e);e&&t&&("Culture_Media"==t&&($(this).attr("class",""),$(this).html("<iframe title='"+(a?"這裡顯示"+a:"")+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100px; height:80px; padding-top:25%' src='"+e+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe>")),audioAllowFormat.indexOf(i)>-1?$(this).find(".img").css("background-image","url('/Content/nrch/images/sketch-sound.png')"):(e.indexOf("imedia.culture.tw/iframe")>-1||videoAllowFormat.indexOf(i)>-1)&&($(this).attr("class",""),$(this).html("<iframe title='"+(a?"這裡顯示"+a:"")+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100px; height:80px; padding-top:25%;' src='"+e+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe>")),"pdf"==i&&$(this).find(".img").css("background-image","url('/Content/nrch/images/file_icon/pdf.png')"))})},detail_related_doc_view_helper:function(){var e=dq("#related_list").querySelectorAll(".photo");cl("detail_related_doc_view_helper => items",e),$(e).each(function(){var e=$(this).closest("div")[0],t=e.querySelector("[name=img_url]").src,a=e.getAttribute("data-indexcode"),i=$(e).closest("a").find("p").html(),r=getImgUrlExten(t);cl("detail_related_doc_view_helper url & indexcode",t+" "+a),"Culture_Media"==a&&$(e).html("<div class='video'><iframe title='"+(i?"這裡顯示"+i:"")+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100%; height:100%' src='"+t+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe></div>"),audioAllowFormat.indexOf(r)>-1?e.querySelector("[name=img_url]").src="/Content/nrch/images/sketch-sound.png":(videoAllowFormat.indexOf(r)>-1||t.indexOf("imedia.culture.tw/iframe")>-1)&&$(e).html("<div class='video'><iframe title='"+(i?"這裡顯示"+i:"")+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100%; height:100%;' src='"+t+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe></div>"),"pdf"==r&&(e.querySelector("[name=img_url]").src="/Content/nrch/images/file_icon/pdf.png")})},NowAjaxAtPage:-1,GetSearchList:async function(){if(!this.submit_process_status){this.submit_status_helper("GetSearchList"),document.querySelector("[name=pager]").innerHTML="<img style='max-width:30px; max-height:30px;' src='"+loading_icon_url+"' />";var e=JSON.parse(dqv("#hd_search_query"));-1==this.NowAjaxAtPage&&(this.NowAjaxAtPage=e.AtPage),this.NowAjaxAtPage++,e.AtPage=this.NowAjaxAtPage,"pic"==getReq("viewmode")&&(e.SearchMode+="[[PIC]]"),cl("q",e);var t=await ajax_post("/Basic","GetSearchList",{q:e});cl("ret",t),t?(dq("#no_html_div").innerHTML=t.item_html,material_role.result_list_doc_view_helper(dq("#no_html_div")),dq("#result_list").innerHTML+=dq("#no_html_div").innerHTML,dq("#no_html_div").innerHTML="",this.submit_status_helper(),document.querySelector("[name=pager]").innerHTML=""):this.submit_status_helper()}},result_list_doc_view_helper:function(e){e||(e=dq("#result_list"));var t=e.querySelectorAll(".photo");$(t).each(function(){var e=$(this).closest("li")[0],t=e.querySelector("[name=img_url]").src,a=e.getAttribute("data-indexcode"),i="",r=e.querySelector(".listTit");r?i=r.innerHTML:(r=e.querySelector("[name=title]"))&&(i=r.innerHTML);var l=getImgUrlExten(t);("Culture_Media"==a||t.indexOf("imedia.culture.tw")>-1)&&(0!=t.indexOf("http")?t=0==t.indexOf("//")?"https:"+t:"https://"+t:0==t.indexOf("http://")&&(t=t.replace("http://","https://")),$(e).find("[name=img_url]").hide(),$(e).find(".video").html("<iframe title='"+(i?"這裡顯示"+i:"")+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100%; height:100%' src='"+t+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe>"),$(e).find(".video").removeAttr("style")),audioAllowFormat.indexOf(l)>-1?e.querySelector("[name=img_url]").src="/Content/nrch/images/sketch-sound.png":(videoAllowFormat.indexOf(l)>-1||t.indexOf("imedia.culture.tw/iframe")>-1)&&($(e).find("[name=img_url]").hide(),$(e).find(".video").html("<iframe title='"+(i?"這裡顯示"+i:"")+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100%; height:100%' src='"+t+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe>"),$(e).find(".video").removeAttr("style")),"pdf"==l&&(e.querySelector("[name=img_url]").src="/Content/nrch/images/file_icon/pdf.png");var o=$(this).find("[data-right]").attr("data-right");if(o&&"NULL"!=o||$(this).find("[data-right]").hide(),"pic"==getReq("viewmode")){var n=$(this).closest("a").find("[name=btnKeep]")[0];material_role.btnKeep_event_bind_helper(n)}})},btnKeep_event_bind_helper:async function(e){if(e){var t=e,a=$(e).closest("a").attr("href"),i=a.split("IndexCode=")[1].split("&")[0],r=a.split("Id=")[1].split("&")[0],l=await material_role.fetch_did_helper(i,r);$(t).bind("click",function(){material_role.detail_page_keep_click_helper(t,i,r,l)});var o=dqv("#hd_login_account");if(o){var n=JSON.parse(dqv("#hd_keep_query"));n.account=o,n.source=i,n.source_id=r,material_role.btnKeep_status_helper(t,n)}}},result_list_pager_push:function(){var e=JSON.parse(dqv("#hd_search_query")),t=dq("#TotalDocNo").getAttribute("data-total"),a=get_pages_helper(e.PageSize,e.AtPage+1,t);common_role.front_default_pager_helper(a)},news_list_pager_push:function(){var e=JSON.parse(dqv("#hd_news_query")),t=get_pages_helper(e.pageSize,e.pageNo,dqv("#hd_news_total"));common_role.front_default_pager_helper(t)},detail_related_list_push:async function(){var e=JSON.parse(dqv("#hd_related_query")),t=await ajax_post("/Basic","GetRelatedList",{q:e});cl("detail_related_list_push => $ret",t),dq("#related_list").innerHTML=t.item_html,$(".materialOther .listshow").slick({slidesToShow:5,slidesToScroll:5,autoplay:!1,speed:1e3,dots:!1,infinite:!1,autoplaySpeed:5e3,pauseOnFocus:!0,prevArrow:'<a class="slick-prev" href="javascript:void(0);"><span>上一個相關物件</span></a>',nextArrow:'<a class="slick-next" href="javascript:void(0);"><span>上一個相關物件</span></a>',responsive:[{breakpoint:1200,settings:{slidesToShow:4,slidesToScroll:4}},{breakpoint:991,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:641,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:421,settings:{slidesToShow:1,slidesToScroll:1}}]})},story_detail_related_list_push:async function(){var e=JSON.parse(dqv("#hd_related_query")),t=await ajax_post("/Basic","GetStoryRelatedList",{q:e});cl("story_detail_related_list_push => $ret",t),dq("#related_list").innerHTML=t.item_html;var a=t.totalNum;$(".storyBox .listshow").slick({slidesToShow:a<4?a:4,slidesToScroll:a<4?a:4,autoplay:!0,speed:1e3,dots:!1,infinite:!0,autoplaySpeed:5e3,pauseOnFocus:!0,prevArrow:'<a class="slick-prev" href="javascript:void(0);"><span>上一個故事</span></a>',nextArrow:'<a class="slick-next" href="javascript:void(0);"><span>上一個故事</span></a>',responsive:[{breakpoint:1801,settings:{slidesToShow:a<4?a:4,slidesToScroll:a<4?a:4}},{breakpoint:1201,settings:{slidesToShow:a<3?a:3,slidesToScroll:a<3?a:3}},{breakpoint:821,settings:{slidesToShow:a<2?a:2,slidesToScroll:a<2?a:2}},{breakpoint:541,settings:{slidesToShow:1,slidesToScroll:1}},{breakpoint:421,settings:{arrows:!1,slidesToShow:1,slidesToScroll:1}}]})},timemap_list_push:async function(e){var t=dqv("#hd_cache_homepage_timemap_list_push"),a=[];if((k=JSON.parse(dqv("#hd_search_query"))).HaveDate=!0,k.AtPage=0,k.PageSize=100,k.OrderColumn[0]="$3$-1",t){(i=JSON.parse(t)).JsonData=JSON.parse(i.JsonData),a=i.JsonData.ResultData}else{var i;if(k.IsHighlight=!1,k.IsSearchDateCount=!1,k.IsSearchGeoCount=!1,!(i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(k)}))||i.Error)return;i.JsonData=JSON.parse(i.JsonData),a=i.JsonData.ResultData}cl("timemap_list_push => list",a);var r={title:{media:{url:"",caption:"",link:""},text:{headline:"",text:""},start_date:{month:"",day:"",year:""}},events:[]},l=[];dq("#hd_outside_story_list")&&(l=JSON.parse(dqv("#hd_outside_story_list")));for(var o=0;o<a.length;o++){var n=a[o];"MOCCOLLECTIONS"==n.IndexCode&&n.Title&&(n.Title.indexOf("<br />")>-1?n.Title=n.Title.split("<br />")[0]:n.Title.indexOf("<br>")>-1?n.Title=n.Title.split("<br>")[0]:n.Title.indexOf("<br/>")>-1&&(n.Title=n.Title.split("<br/>")[0])),"drnh"==n.IndexCode&&n.Abstract&&n.Abstract.indexOf("{#")>-1&&n.Abstract.indexOf("#}")>-1&&(n.Abstract=n.Abstract.replaceAll("{#","").replaceAll("#}",""));var s="",d="/"+this.ControllerName+"/Detail?Id="+n.Id+"&IndexCode="+n.IndexCode+location.search.replace("?","&");if("member_story"!=n.IndexCode){var c=l.filter(e=>e.id==n.Id);c.length>0&&(d=c[0].location,s=" onclick=\"material_role.import_story_view_record_helper('"+n.Title+"','"+n.IndexCode+"','"+n.Id+"')\" ")}var _=n.Date,h="",u="",p="";_&&3==(_=_.split(" ")[0]).split("/").length&&(h=_.split("/")[0],u=_.split("/")[1],p=_.split("/")[2]);var m=n.ImageUrl?n.ImageUrl:default_img_url;m.indexOf(" / ")>-1&&(m=m.split(" / ")[0]),m.indexOf(";")>-1&&(m=m.split(";")[0]),"Archives"==n.IndexCode&&(m="/ArchivesUpload/"+m),0==o&&("Culture_Media"==n.IndexCode||m.indexOf(".avi")>-1||m.indexOf(".flv")>-1||m.indexOf(".wmv")>-1||m.indexOf(".mov")>-1||m.indexOf(".mpg")>-1?r.title.media.url="../Content/nrch/images/sketch-video.png":r.title.media.url=m,r.title.media.caption="",r.title.media.link=d,r.title.media.link_target="_self",r.title.text.headline="<a href="+d+" "+s+"  >"+n.Title+"</a>",r.title.text.text=n.Abstract,r.title.start_date.month=u,r.title.start_date.day=p,r.title.start_date.year=h);var f={media:{url:"",caption:"",link:""},start_date:{month:"",day:"",year:""},text:{headline:"",text:"",link:""}};"Culture_Media"==n.IndexCode||m.indexOf(".avi")>-1||m.indexOf(".flv")>-1||m.indexOf(".wmv")>-1||m.indexOf(".mov")>-1||m.indexOf(".mpg")>-1?f.media.url="../Content/nrch/images/sketch-video.png":f.media.url=m,f.media.caption="",f.media.link=d,f.media.link_target="_self",f.start_date.month=u,f.start_date.day=p,f.start_date.year=h,f.text.headline="<a href="+d+" "+s+" >"+n.Title+"</a>",f.text.text=n.Abstract,f.text.link=d,r.events.push(f)}if(r.events&&r.events.length>0){new TL.Timeline("timeline-embed",r,{timenav_height_percentage:40,marker_height_min:50,marker_width_min:100,start_at_end:!0});var g=document.querySelector(".tl-slidenav-previous");g&&$(g).remove();var v=document.querySelector(".tl-slidenav-next");if(v&&$(v).remove(),$(".tl-headline").attr("style","color:#000000 !important;font-weight:bold; "),"story"!=dqv("#ControllerName").toLowerCase()){var y=parseFloat($(".tl-timenav-slider").css("width").replace("px",""));if(y&&y>0){var S=.37*y;$(".tl-timenav-slider").css("left","-"+S.toFixed(2)+"px")}}for(var q=document.querySelectorAll(".tl-timemarker-text h2"),x=0;x<q.length;x++){var w=q[x].innerText;w.length>25&&(q[x].innerText=w.substr(0,25)+"...")}$(".tl-icon-image").remove()}else $("#timeline-embed").hide(),$("#TL_tip").hide();var b=document.querySelector("#TotalDocNo"),C=document.querySelector("#TotalDocNo_HaveDate"),I=document.querySelector("#TotalDocNo_HaveGeo");if(b&&C&&I){var k,O=dq("#hd_search_query");if((k=O.value?JSON.parse(O.value):"").HaveDate=!1,k.HaveGeo=!1,k.PageSize=1,cl("TimeMap totalDoc => q",k),!dq("#hd_hot_keyword")){var D=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(k)});if(!D||D.Error)return;cl("totalDocRet >= q",k),cl("totalDocRet",D),D.JsonData=JSON.parse(D.JsonData),b.innerHTML=moneyFormat(D.JsonData.TotalDocNo),C.innerHTML=moneyFormat(D.JsonData.TotalDocNo_HaveDate),I.innerHTML=moneyFormat(D.JsonData.TotalDocNo_HaveGeo)}}},area_markers:[{lat:25.029408,lng:121.551653,title:"台北市"},{lat:25.029408,lng:121.551653,title:"臺北市"},{lat:25.019265,lng:121.459352,title:"新北市"},{lat:25.127139,lng:121.737877,title:"基隆市"},{lat:24.991543,lng:121.292567,title:"桃園市"},{lat:24.840073,lng:121.011488,title:"新竹縣"},{lat:24.813239,lng:120.964623,title:"新竹市"},{lat:24.558272,lng:120.80985,title:"苗栗縣"},{lat:24.14468,lng:120.683919,title:"台中市"},{lat:24.14468,lng:120.683919,title:"臺中市"},{lat:23.967894,lng:120.982352,title:"南投縣"},{lat:24.051455,lng:120.513954,title:"彰化縣"},{lat:23.711358,lng:120.432521,title:"雲林縣"},{lat:23.444014,lng:120.268336,title:"嘉義縣"},{lat:23.479426,lng:120.449811,title:"嘉義市"},{lat:23.000747,lng:120.216442,title:"台南市"},{lat:23.000747,lng:120.216442,title:"臺南市"},{lat:22.612846,lng:120.307786,title:"高雄市"},{lat:22.547336,lng:120.529364,title:"屏東縣"},{lat:24.70482,lng:121.769283,title:"宜蘭縣"},{lat:23.989375,lng:121.583184,title:"花蓮縣"},{lat:22.781655,lng:121.046372,title:"台東縣"},{lat:22.781655,lng:121.046372,title:"臺東縣"},{lat:23.575356,lng:119.575573,title:"澎湖縣"},{lat:24.451267,lng:118.372499,title:"金門縣"},{lat:26.157327,lng:119.951996,title:"連江縣"}],invalidZoom:0,zoomTooSmallAlertTag:!1,storymap_list_push:async function(){var e=dqv("#hd_cache_homepage_storymap_list_push"),t=[];if((O=JSON.parse(dqv("#hd_search_query"))).HaveGeo=!0,O.AtPage=0,O.PageSize=200,e){(a=JSON.parse(e)).JsonData=JSON.parse(a.JsonData),t=a.JsonData.ResultData}else{var a;if(!(a=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(O)}))||a.Error)return;a.JsonData=JSON.parse(a.JsonData),t=a.JsonData.ResultData,cl("list_push => JsonData => markers",t)}for(var i,r=25.047943,l=121.516939,o=1e3,n=0,s=0,d=1e3,c=0,_=0,h=0;h<t.length;h++){if((v=t[h]).Latitude&&v.Longitude){v.latArr=v.Latitude.split(" / "),v.lngArr=v.Longitude.split(" / ");for(var u=0;u<v.lngArr.length;u++){(w=v.lngArr[u])&&(w<100&&cl("marker < 100",v),n<w&&(n=w),o>w&&(o=w))}for(u=0;u<v.latArr.length;u++){(x=v.latArr[u])&&(s<x&&(s=x),d>x&&(d=x))}}}n=parseFloat(n),o=parseFloat(o),s=parseFloat(s),d=parseFloat(d),t.length>1&&(r=((s+d)/2).toFixed(6),l=((n+o)/2).toFixed(6),_<(c=s-d)&&(_=c),_<(i=n-o)&&(_=i));var p=6;_>0&&(_>=5&&(p=3),_>=3.5&&_<5&&(p=6),_>=3&&_<3.5&&(p=6),_>=2.5&&_<3&&(p=6),_>=2&&_<2.5&&(p=7),_>=1.5&&_<2&&(p=8),_>=1&&_<1.5&&(p=9),_>=.5&&_<1&&(p=10),console.log("rightLng:"+n+" leftLng:"+o+" topLat:"+s+" bottomLat:"+d),console.log("maxDiff:"+_+" zoom:"+p+" centerLat:"+r+" centerLng:"+l));var m=L.icon({iconUrl:"/Scripts/maps/images/pin24.png",iconRetinaUrl:"/Scripts/maps/images/pin48.png",iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]}),f=L.map("storymap",{center:[r,l],minZoom:2,zoom:p,scrollWheelZoom:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(f);var g=L.markerClusterGroup();for(h=0;h<t.length;++h){var v;if("MOCCOLLECTIONS"==(v=t[h]).IndexCode&&v.Title&&(v.Title.indexOf("<br />")>-1?v.Title=v.Title.split("<br />")[0]:v.Title.indexOf("<br>")>-1?v.Title=v.Title.split("<br>")[0]:v.Title.indexOf("<br/>")>-1&&(v.Title=v.Title.split("<br/>")[0])),"drnh"==v.IndexCode&&v.Abstract&&v.Abstract.indexOf("{#")>-1&&v.Abstract.indexOf("#}")>-1&&(v.Abstract=v.Abstract.replaceAll("{#","").replaceAll("#}","")),v.Latitude&&v.Longitude){var y="/"+this.ControllerName+"/Detail?Id="+v.Id+"&IndexCode="+v.IndexCode+location.search.replace("?","&"),S=v.ImageUrl?v.ImageUrl:default_img_url;S.indexOf(" / ")>-1&&(S=S.split(" / ")[0]),S.indexOf(";")>-1&&(S=S.split(";")[0]),"Archives"==v.IndexCode&&(S="/ArchivesUpload/"+S);var q="";q="Culture_Media"==v.IndexCode||S.indexOf(".avi")>-1||S.indexOf(".flv")>-1||S.indexOf(".wmv")>-1||S.indexOf(".mov")>-1||S.indexOf(".mp4")>-1||S.indexOf(".mpg")>-1?"<div class='video'><iframe title='這裡顯示"+v.Title+"' autoplay='false' name='media_iframe' scrolling='no' style='width:100%; height:100%' src='"+S+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe></div>":"<div style='height:200px'><a href='"+y+"' ><img src='"+S+"' style='max-width:170px;max-height:170px' alt=\""+v.Title.replaceAll("<font color='red'>","").replaceAll("</font>","")+'" /></a></div>',q+="<br/>",q+="<a href='"+y+"' >"+v.Title+"</a>",q+="<br/>",q+="<br/>"+v.Abstract;for(u=0;u<v.lngArr.length;u++){var x,w=v.lngArr[u];if((x=v.latArr[u])&&w){var b=L.marker([x,w],{title:v.Title,icon:m}).bindPopup(q);g.addLayer(b)}}}}f.addLayer(g),$("#storymap").addClass("map-scroll"),$("#storymap").bind("mousewheel DOMMouseScroll",function(e){e.stopPropagation(),1==e.ctrlKey?(e.preventDefault(),f.scrollWheelZoom.enable(),$("#storymap").removeClass("map-scroll"),setTimeout(function(){f.scrollWheelZoom.disable()},1e3)):(f.scrollWheelZoom.disable(),$("#storymap").addClass("map-scroll"))});var C=document.querySelector("#TotalDocNo"),I=document.querySelector("#TotalDocNo_HaveDate"),k=document.querySelector("#TotalDocNo_HaveGeo");if(C&&I&&k){var O,D=dq("#hd_search_query");if((O=D.value?JSON.parse(D.value):"").HaveDate=!1,O.HaveGeo=!1,O.PageSize=1,cl("StoryMap totalDoc => q",O),!dq("#hd_hot_keyword")){var T=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(O)});if(!T||T.Error)return;cl("totalDocRet >= q",O),cl("totalDocRet",T),T.JsonData=JSON.parse(T.JsonData),C.innerHTML=moneyFormat(T.JsonData.TotalDocNo),I.innerHTML=moneyFormat(T.JsonData.TotalDocNo_HaveDate),k.innerHTML=moneyFormat(T.JsonData.TotalDocNo_HaveGeo);var A=dq("#geo_tip");A&&(A.innerHTML="(地圖顯示前"+t.length+"筆)")}}},map_search_point_push:async function(e){if(e&&0!=e.length){for(var t,a=25.047943,i=121.516939,r=1e3,l=0,o=0,n=1e3,s=0,d=0,c=0;c<e.length;c++){(m=e[c]).Latitude&&m.Longitude&&(m.Longitude&&(m.Longitude<100&&cl("marker < 100",m),l<m.Longitude&&(l=m.Longitude),r>m.Longitude&&(r=m.Longitude)),m.Latitude&&(o<m.Latitude&&(o=m.Latitude),n>m.Latitude&&(n=m.Latitude)))}e.length>1&&(a=((o+n)/2).toFixed(6),i=((l+r)/2).toFixed(6),d<(s=o-n)&&(d=s),d<(t=l-r)&&(d=t));var _=6;d>0&&(d>=5&&(_=3),d>=3.5&&d<5&&(_=6),d>=3&&d<3.5&&(_=6),d>=2.5&&d<3&&(_=6),d>=2&&d<2.5&&(_=7),d>=1.5&&d<2&&(_=8),d>=1&&d<1.5&&(_=9),d>=.5&&d<1&&(_=10),console.log("rightLng:"+l+" leftLng:"+r+" topLat:"+o+" bottomLat:"+n),console.log("maxDiff:"+d+" zoom:"+_+" centerLat:"+a+" centerLng:"+i));var h=L.icon({iconUrl:"/Scripts/maps/images/pin24.png",iconRetinaUrl:"/Scripts/maps/images/pin48.png",iconSize:[29,24],iconAnchor:[9,21],popupAnchor:[0,-14]}),u=L.map("storymap",{center:[a,i],minZoom:2,zoom:_,scrollWheelZoom:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(u);var p=L.markerClusterGroup();for(c=0;c<e.length;++c){var m;if((m=e[c]).Latitude&&m.Longitude){var f=L.marker([m.Latitude,m.Longitude],{title:m.Count+","+m.MarkerNo,icon:h}).on("click",function(e){var t=e.target.options.title,a=0,i=0;t&&(a=t.split(",")[0],i=t.split(",")[1]);var r=e.latlng.lat+","+e.latlng.lng+","+a+","+i,l=[];l.push(["latlon",r]);var o=paramHelper(location.pathname,["p","latlon"],l);window.location=o});f.bindTooltip("No. "+m.MarkerNo.toString(),{permanent:!0,direction:"bottom",className:"transparent-tooltip",offset:[0,-8]}),p.addLayer(f)}}u.addLayer(p),$("#storymap").addClass("map-scroll"),$("#storymap").bind("mousewheel DOMMouseScroll",function(e){e.stopPropagation(),1==e.ctrlKey?(e.preventDefault(),u.scrollWheelZoom.enable(),$("#storymap").removeClass("map-scroll"),setTimeout(function(){u.scrollWheelZoom.disable()},1e3)):(u.scrollWheelZoom.disable(),$("#storymap").addClass("map-scroll"))}),console.log("map point done")}},google_map_search_point_push:async function(){var e=JSON.parse(dqv("#hd_search_query"));e.HaveGeo=!0,e.IsHighlight=!1,e.IsSearchDateCount=!1,e.IsSearchGeoCount=!1,e.PageSize=9999,cl("FKSQ",e);var t=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(e)});t&&(t.JsonData=JSON.parse(t.JsonData)),cl("FKSRet",t),console.log("google map point done")},map_search_total_push:async function(){var e=document.querySelector("#TotalDocNo"),t=document.querySelector("#TotalDocNo_HaveDate"),a=document.querySelector("#TotalDocNo_HaveGeo");if(e&&t&&a){var i=dq("#hd_search_query"),r=i.value?JSON.parse(i.value):"";r.HaveDate=!1,r.HaveGeo=!1,r.PageSize=1,r.SearchMode="Precise";var l=getReq("latlon");l&&l.indexOf(",")>-1&&(r.Filter_Keyword_Latitude=l.split(",")[0],r.Filter_Keyword_Longitude=l.split(",")[1]);var o=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(r)});o&&!o.Error&&(o.JsonData=JSON.parse(o.JsonData),e.innerHTML=moneyFormat(o.JsonData.TotalDocNo),t.innerHTML=moneyFormat(o.JsonData.TotalDocNo_HaveDate),a.innerHTML=moneyFormat(o.JsonData.TotalDocNo_HaveGeo),$(e).closest("span").removeAttr("style"),$(t).closest("span").removeAttr("style"),$(a).closest("span").removeAttr("style"),console.log("map total done"))}},map_search_push:async function(){var e=parseInt(getReq("p"));e||(e=1);var t=[],a=[],i=[],r=getReq("latlon");if(r){var l=r.split(",")[0],o=r.split(",")[1],n=r.split(",")[2],s=r.split(",")[3];i.push({Latitude:l,Longitude:o,MarkerNo:s,Count:n}),t.push(r)}else{var d=JSON.parse(dqv("#hd_search_query"));d.HaveGeo=!0,d.KeywordStatisticsColumn="Keyword_GeoCoordinate",d.SearchMode="Precise",cl("FKSQ",d);var c=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchKeywordStatistics",q:JSON.stringify(d)});if(c&&(i=[],c.JsonData=JSON.parse(c.JsonData),(a=Object.entries(c.JsonData)).length>0))for(var _=0;_<a.length;_++){n=a[_][1];if(a[_][0].indexOf(",")>-1){l=parseFloat(a[_][0].split(",")[0]),o=parseFloat(a[_][0].split(",")[1]);!l||!o||"NULL"==l||"NULL"==o||l>=180||l<=-180||o>=180||o<=-180||((l>=90||l<=-90)&&(l=[o,o=l][0]),i.push({Latitude:l,Longitude:o,MarkerNo:_+1,Count:n}))}}var h=10*(e-1),u=h+10;u>=i.length&&(u=i.length-1);for(_=h;_<u;_++){l=i[_].Latitude,o=i[_].Longitude,n=i[_].Count,s=i[_].MarkerNo;t.push(l+","+o+","+n+","+s)}}if(material_role.map_search_point_push(i),dq(".materialList_mapWp").innerHTML="",r){if((k=r).indexOf(",")>-1){l=(t=k.split(","))[0];var p=t[1];n=t[2],s=t[3];(O=JSON.parse(dqv("#hd_search_query"))).PageSize=30,O.AtPage=e-1,O.HaveGeo=!0,O.SearchMode="Precise",O.CustomColumns=[],O.Filter_Keyword_Latitude=l,O.Filter_Keyword_Longitude=p,cl("SLQ",O);var m=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(O)});if(cl("SLRet: "+k,m),m&&!m.Error){m.JsonData=JSON.parse(m.JsonData);for(var f=m.JsonData.ResultData,g=m.JsonData.TotalDocNo_HaveGeo,v=!1,y=1;y<=10;y++){var S="";S+="<div class='materialList_map clearfix'>",S+="<div class='loca'>",1==y&&(S+="<a href='"+location.toString()+"'><p class='loaction'>"+s+"</p><p class='totalData'>有<strong>"+g+"</strong>筆資料</p></a>"),S+="</div>",S+="<ul>";for(var q=3*(y-1),x=q+3,w=q;w<x;w++){var b=(T=f[w]).Title;if(dq("#no_html_div").innerHTML=b,b=dq("#no_html_div").innerText,(A=T.ImageUrl?T.ImageUrl:"/Content/nrch/images/nopic.png").indexOf(";")>-1&&(A=A.split(";")[0]),T.ImageUrl&&"Archives"==T.IndexCode&&(A="/ArchivesUpload/"+A),S+="<li>",S+="<a href='/Home/Detail?Id="+T.Id+"&IndexCode="+T.IndexCode+(location.search?location.search.replace("?","&"):"")+"'><div class='photo'><img src='"+A+"' alt='"+b+"'></div><div class='word'>"+T.Title+"</div></a>",S+="<div class='photoBot3'><div class='material_copyright'>",S+="<a href='javascript:();' data-toggle='modal' data-target='#modalCreativecommons' title='創用CC 出處/姓名+若有改作只能用相同授權條款分享'><img src='../images/cc_icon/cc_icon2.png' alt='licence:cc by-sa'></a>",S+="</div></div>",S+="</li>",w>=f.length-1){v=!0;break}}if(S+="</ul>",S+="</div>",dq(".materialList_mapWp").innerHTML+=S,v)break}for(var C=y;C<10;C++)dq(".materialList_mapWp").innerHTML+="<div class='materialList_map clearfix'><div class='loca'><a href='javascript:;'><p class='loaction' style='background-image:none'></p></a></div></div>";if((N=get_pages_helper(O.PageSize,e,m.JsonData.TotalDocNo_HaveGeo))&&N.length>0){$(N).each(function(){this.href=encodeURI(this.href)});var I=front_default_pager_html2(N);dq(".materialList_mapWp").innerHTML+="<div id='page' class='clearfix'><div class='num'>"+I+"</div></div>"}}}}else{cl("latlngArr",t);for(_=0;_<t.length;_++){var k;if((k=t[_]).indexOf(",")>-1){var O;l=k.split(",")[0],p=k.split(",")[1],g=k.split(",")[2],s=k.split(",")[3];(O=JSON.parse(dqv("#hd_search_query"))).PageSize=3,O.AtPage=0,O.HaveGeo=!0,O.SearchMode="Precise",O.CustomColumns=[],O.IsHighlight=!1,O.IsSearchDateCount=!1,O.IsSearchGeoCount=!1,O.Filter_Keyword_Latitude=l,O.Filter_Keyword_Longitude=p,cl("SLQ",O);m=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"SearchList",q:JSON.stringify(O)});if(cl("SLRet: "+k,m),m&&!m.Error){m.JsonData=JSON.parse(m.JsonData);f=m.JsonData.ResultData;var D=[];D.push(["latlon",k]);S="";S+="<div class='materialList_map clearfix'>",S+="<div class='loca'><a href='"+paramHelper(location.pathname,["p"],D)+"'><p class='loaction'>"+s+"</p><p class='totalData'>有<strong>"+g+"</strong>筆資料</p></a></div>",S+="<ul>";for(w=0;w<f.length&&!(w>2);w++){var T,A;b=(T=f[w]).Title;dq("#no_html_div").innerHTML=b,b=dq("#no_html_div").innerText,(A=T.ImageUrl?T.ImageUrl:"/Content/nrch/images/nopic.png").indexOf(";")>-1&&(A=A.split(";")[0]),T.ImageUrl&&"Archives"==T.IndexCode&&(A="/ArchivesUpload/"+A),S+="<li>",S+="<a href='/Home/Detail?Id="+T.Id+"&IndexCode="+T.IndexCode+(location.search?location.search.replace("?","&"):"")+"'><div class='photo'><img src='"+A+"' alt='"+b+"'></div><div class='word'>"+T.Title+"</div></a>",S+="<div class='photoBot3'><div class='material_copyright'>",S+="<a href='javascript:();' data-toggle='modal' data-target='#modalCreativecommons' title='創用CC 出處/姓名+若有改作只能用相同授權條款分享'><img src='../images/cc_icon/cc_icon2.png' alt='licence:cc by-sa'></a>",S+="</div></div>",S+="</li>"}S+="</ul>",S+="</div>",dq(".materialList_mapWp").innerHTML+=S}}}for(C=_;C<10;C++)dq(".materialList_mapWp").innerHTML+="<div class='materialList_map clearfix'><div class='loca'><a href='javascript:;'><p class='loaction' style='background-image:none'></p></a></div></div>";var N;if((N=get_pages_helper(10,e,a.length))&&N.length>0){$(N).each(function(){this.href=encodeURI(this.href)});I=front_default_pager_html2(N);dq(".materialList_mapWp").innerHTML+="<div id='page' class='clearfix'><div class='num'>"+I+"</div></div>"}}material_role.map_search_total_push()},tomailbox:async function(){var e=dq("[name=Title]").innerText+";"+location+";"+this.getIndexcodeName(getReq("IndexCode"))+";"+getReq("Id");await ajax_post("/Home","DetailMailBoxSessionSet",{data:e}),window.open("/Home/MailBoxForm")},getIndexcodeName:function(e){var t="";if("member_story"==e)return"創作區故事";if("outside_story"==e)return"站外故事";if("cnaphoto"==e)return"中央社";if("taiwanstory"==e)return"臺灣小故事101";var a=[],i=dq("[value="+e+"]");if(i){var r=i.getAttribute("data-level");"2"==r?a.unshift($(i).closest("ul").closest("li").find("[data-stat_name]")[0].getAttribute("data-stat_name")):"3"==r&&(a.unshift($(i).closest("ul").closest("li").find("[data-stat_name]")[0].getAttribute("data-stat_name")),a.unshift($(i).closest("ul").closest("li").closest("ul").closest("li").find("[data-stat_name]")[0].getAttribute("data-stat_name"))),cl("icArr",a),t=[...new Set(a)].join("-")}return t},tomailboxAfterAgree:async function(){$("#agree-word").is(":checked")?(await ajax_post("/Home","MailBoxAgreeSessionKeep"),location="/Home/MailBoxForm"):alert("請詳閱並同意遵守上述聲明")},captcha_update:async function(e){$("[name=captchaTextBox]").each(function(){this.value=""});var t=await ajax_post("/Basic","UpdateCaptchaCode",{tag:e},null);cl("UpdateCaptchaCode",t),t&&t.isSuccess&&$("[data-captcha="+e+"]").attr("src",t.data1)},openAPI_form_push:async function(){document.getElementById("frmEdit").reset(),this.captcha_update("openAPI")},openAPI_form_submit:async function(){if(!this.submit_process_status){this.submit_status_helper("openAPI_form_submit");var e=dq("#frmEdit"),t=e.querySelector("[name=captchaTextBox]").value.trim(),a=e.querySelector("[name=FullName]").value.trim(),i=e.querySelector("[name=Company]").value.trim(),r=e.querySelector("[name=Tel]").value.trim(),l=e.querySelector("[name=Email]").value.trim(),o=e.querySelector("[name=Contents]").value.trim(),n="",s=form_validate(e,"web_openAPI");if(s.size>0){n+="填寫不完整\n";for(let t of s.keys()){n+=e.querySelector("[name="+t+"]").getAttribute("data-title")+"  "+langTrans(s.get(t))+"\n"}n+="\n"}if(n)return alert(n),void this.submit_status_helper();var d={captcha:t,apply_name:a,apply_unit:i,phone:r,email:l,memo:o};cl("openAPI_form_submit => input",d);var c=await ajax_post("/Home","OpenAPIFormSave",d);cl("openAPI_form_submit => ret",c),c.isSuccess?(alert("本網站已收到您的API 申請案件，請先至信箱進行Email的有效確認"),location=location):alert(c.data2),this.captcha_update("openAPI"),this.submit_status_helper()}},enquiry_form_push:async function(){dq("#frmEdit");document.getElementById("frmEdit").reset(),this.captcha_update("enquiry")},enquiry_submit:async function(){if(!this.submit_process_status){this.submit_status_helper("enquiry_submit");var e=dq("#frmEdit"),t=e.querySelector("[name=name]").value,a=e.querySelector("[name=email]").value,i=e.querySelector("[name=captchaTextBox]").value,r="",l=form_validate(e,"web_report");if(l.size>0){r+="填寫不完整\n";for(let t of l.keys()){r+=e.querySelector("[name="+t+"]").getAttribute("data-title")+"  "+langTrans(l.get(t))+"\n"}}if(r)return alert(r),void this.submit_status_helper();var o={captcha:i,no:t,email:a};cl("enquiry_submit => input",o);var n=await ajax_post("/Home","EnquirySubmit",o);cl("enquiry_submit => ret",n),n.isSuccess?location="/Home/EnquiryResult":alert(n.data2),this.captcha_update("enquiry"),this.submit_status_helper()}},report_form_push:async function(){var e=dq("#frmEdit"),t=await ajax_post("/Basic","GetNewFileID");file_upload_data_init($(e),t),e.querySelector("[data-file_view]").innerHTML="",document.getElementById("frmEdit").reset(),this.captcha_update("report")},report_file_view_helper:function(e,t){if(e){var a=$(e).find("[data-file_view]");a.html("");var i=e.getAttribute("data-file_tag");e.getAttribute("data-file_area");if(t){var r="",l=[];"report_file"==i&&(l=t.filter(e=>e.tag==i),r=common_role.file_view_html_helper(l,"report_file")),a.html(r)}}},report_captcha_mail:async function(e,t){var a="";if(t||(a="請填入電子信箱"),t&&ck_email_format(t)&&(a="電子信箱格式有誤"),a)alert(a);else{var i={tag:e,email:t},r=await ajax_post("/Basic","SendCaptcha",i);cl("report_captcha_mail => errMsg",r),(r="")||($("#btnReSend").bind("click",function(){material_role.report_captcha_mail(e,t)}),$("#btnReSend").bind("keypress",function(){material_role.report_captcha_mail(e,t)}),$(".send_success").each(function(){$(this).removeAttr("style")}))}},report_submit:async function(){if(!this.submit_process_status){this.submit_status_helper("report_submit");var e=dq("#frmEdit"),t=e.querySelector("[name=material_title]").value,a=e.querySelector("[name=material_url]").value,i=e.querySelector("[name=indexcode]").value,r=e.querySelector("[name=material_id]").value,l=e.querySelector("[name=captchaTextBox]").value,o=e.querySelector("[name=name]").value,n=e.querySelector("[name=email]").value,s=e.querySelector("[name=tel]").value,d=e.querySelector("[name=mobile]").value,c=pull_value_controller(e,"Qsort","","checkboxes"),_=e.querySelector("[name=owner]").value,h=e.querySelector("[name=agent]").value,u=pull_value_controller(e,"consentperson","","checkboxes"),p=[];$("[name=file_link]").each(function(){p.push(this.href)});var m=e.querySelector("[name=content]").value.trim(),f="",g=form_validate(e,"web_report");if(g.size>0){f+="填寫不完整\n";for(let t of g.keys()){f+=e.querySelector("[name="+t+"]").getAttribute("data-title")+"  "+langTrans(g.get(t))+"\n"}}if(dq("#Qsort3").checked){_||(f+="著作權人  必填\n");var v=u.split(",");-1!=v.indexOf("consent1")&&-1!=v.indexOf("consent2")&&-1!=v.indexOf("consent3")&&-1!=v.indexOf("consent4")||(f+="立通知書人  需同意前四項\n")}if(f)return alert(f),void this.submit_status_helper();var y={captcha:l,material_source:i,material_id:r,title:t,url:a,name:o,email:n,tel:s,mobile:d,cates:c,content:m,content2:"",file_id:e.querySelector("[data-file_area]").getAttribute("data-file_area"),file_links:p.join("|"),owner:_,agent:h,consents:u};cl("report_submit => input",y);var S=await ajax_post("/Home","ReportSave",y);cl("report_submit => ret",S),S.isSuccess?(await file_command_execute(e),alert("本網站已收到您的問題回報受理案件，請先至信箱進行Email的有效確認"),location=location):alert(S.data2),this.captcha_update("report"),this.submit_status_helper()}},thinking_submit:async function(){if(!this.submit_process_status){this.submit_status_helper("thinking_submit");var e=dq("#suppForm"),t=$("[name=ideaContents]"),a=t.val();if(a.trim()){var i={is_enabled:1,indexcode:getReq("IndexCode"),material_id:getReq("Id"),msg:a,file_id:e.querySelector("[data-file_area]").getAttribute("data-file_area")};cl("thinking_submit => input",i);var r=await ajax_post("/Home","WebThinkingSave",i);cl("thinking_submit => ret",r),await file_command_execute(e),await file_info_save(),await file_sort_save(),t.val("");var l=JSON.parse(dqv("#hd_thinking_query"));l.urlParam=location.search,r=await ajax_post("/Home","WebThinkingSearch",l),cl("thinking_submit => WebThinkingSearch => ret",r),this.thinking_push(r.data1),$("#suppForm").modal("hide"),this.submit_status_helper()}else this.submit_status_helper()}},thinking_form_push:async function(){var e=dq("#suppForm"),t=await ajax_post("/Basic","GetNewFileID");file_upload_data_init($(e),t),e.querySelector("#ideaContents").value="",e.querySelector("[data-file_view]").innerHTML="",e.querySelector("#upload_count").innerHTML="0";var a=JSON.parse(dqv("#hd_right_list")),i="";$(a).each(function(){i+="<option value='"+this.tag+"'>"+this.title+"("+this.tag+")</option>"}),dq("#authorizeRange").innerHTML=i},thinking_file_view_helper:function(e,t){if(e){var a=$(e),i=a.find("[data-file_view]");i.html("");var r=e.getAttribute("data-file_tag");e.getAttribute("data-file_area");if(t){var l="",o=[];"thinking_file"==r&&(o=t.filter(e=>e.tag==r),l=a.closest(".albumsBox").length>0?common_role.file_view_html_helper(o,"thinking_view"):common_role.file_view_html_helper(o,"thinking_file")),i.html(l),$(e).find(".lightbox").fancybox({openEffect:"none",closeEffect:"none",tpl:{error:'<p class="fancybox-error">內容發生錯誤，請稍後再試，謝謝！</p>',closeBtn:'<a title="關閉相片" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="下一張相片" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="上一張相片" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'}})}}},thinking_upload_select_sort:async function(e,t){if(e){var a=$(e).closest("[name=file_info]").attr("data-file_id"),i=$(e).closest("[data-file_area]");if(common_role.file_info_record_helper(i),"next"==t)for(var r=0;r<file_info_temp.length;r++)file_info_temp[r].id==a&&(file_info_temp[r].sort+=1,file_info_temp[r+1].sort-=1);if("prev"==t)for(r=0;r<file_info_temp.length;r++)file_info_temp[r].id==a&&(file_info_temp[r].sort-=1,file_info_temp[r-1].sort+=1);fileReload(i[0])}},thinking_push:function(e){if(cl("thinking_push data",e),e){$(e).each(function(){this.date="@ "+moment(this.date_created).format("YYYY/MM/DD HH:mm"),this.msg=this.msg.replaceAll("\n","</p><p>")}),$("[name=thinking_count]").each(function(){this.innerText=e.length});var t=dq("#thinking_list");push_list_controller(t,e),$(dq("#thinking_list").querySelectorAll("[data-row=db_row]")).each(function(){var e=$(this).data("dataObj");file_upload_data_init($(this),e.file_id);var t=this.querySelector("[data-file_tag]");fileReload(t)})}},thinking_selected_file_owner_set:function(){var e=dqa("[name=createpic]:checked");if(0!=e.length){var t=dq("#batchOwner").value,a="";"同創作人"==t&&(a=dqv("#hd_login_name")),"自行輸入"==t&&(a=""),$(e).each(function(){$(this).closest("[name=file_info]").find("[name=owner]").val(a)})}else alert("請先勾選要批次設定的項目")},thinking_selected_file_right_set:function(){var e=dqa("[name=createpic]:checked");0!=e.length?$(e).each(function(){$(this).closest("[name=file_info]").find("[name=authorizeRange1]").val(dq("#authorizeRange").value)}):alert("請先勾選要批次設定的項目")},thinking_selected_file_exif_set:function(){var e=dqa("[name=createpic]:checked");0!=e.length?$(e).each(function(){$(this).closest("[name=file_info]").find("[name=exif]").val(dq("#ExifRange").value.trim())}):alert("請先勾選要批次設定的項目")},message_submit:async function(e){var t=$(e).closest(".bookR").find("[name=webmessagetext]"),a=t.val();if(a.trim()){var i=await ajax_post("/Basic","GetNewFileID"),r={is_enabled:1,indexcode:getReq("IndexCode"),material_id:getReq("Id"),msg:a,file_id:i};cl("message_submit => input",r);var l=await ajax_post("/Home","WebMessageSave",r);cl("message_submit => ret",l),t.val("");var o=JSON.parse(dqv("#hd_message_query"));o.urlParam=location.search,l=await ajax_post("/Home","WebMessageSearch",o),cl("message_submit => WebMessageSearch => ret",l),this.message_push(l.data1)}},message_reply:async function(e){var t=$(e).closest(".bookR").find("[name=webmessagetext]"),a=t.val();if(a.trim()){var i=await ajax_post("/Basic","GetNewFileID"),r=e.getAttribute("data-replyto"),l={is_enabled:1,replyto:r,indexcode:getReq("IndexCode"),material_id:getReq("Id"),msg:a,file_id:i};cl("message_reply => input",l);var o=await ajax_post("/Home","WebMessageSave",l);cl("message_submit => ret",o),t.val("");var n=JSON.parse(dqv("#hd_message_query"));n.urlParam=location.search,o=await ajax_post("/Home","WebMessageSearch",n),cl("message_submit => WebMessageSearch => ret",o);var s=[];o.data1&&(s=o.data1.filter(e=>e.replyto==r));var d=$(e).closest(".grid-container").find("[name=reply_list]")[0];this.message_reply_push(d,s);d=$(e).closest(".grid-container").find(".quote")[0];this.message_reply_push(d,s)}},message_reply_push:function(e,t){if(cl("message_reply_push form",e),e&&(cl("message_reply_push data",t),t)){$(t).each(function(){this.date="@ "+moment(this.date_created).format("YYYY/MM/DD HH:mm"),this.msg=this.msg.replaceAll("\n","</p><p>")}),$(e).closest(".grid-container").find("[name=reply_count]")[0].innerText=t.length;var a=[];$(e).find("[data-row=db_row_r]").each(function(){$(this).remove()});var i=$(e).find("[data-row=temp_row_r]");if(1==i.length){var r=1;$(t).each(function(){var t=this,l=i.clone();l.show(),l.attr("data-row","db_row_r"),l.attr("data-index",r++),l.data("dataObj",t),t=Object.entries(t);for(var o=0;o<t.length;o++){var n=t[o],s=n[0],d=n[1],c=!1;if(a&&a.length>0){var _=a.filter(e=>e.tag==s);1==_.length&&(_=_[0],push_value_controller(l[0],s,d,_.format),c=!0)}0==c&&push_value_controller(l[0],s,d)}$(e).append(l)})}}},message_push:function(e){if(cl("message_push data",e),e){var t=e.filter(e=>0==e.replyto);$(t).each(function(){this.date="@ "+moment(this.date_created).format("YYYY/MM/DD HH:mm"),this.msg=this.msg.replaceAll("\n","</p><p>")}),$("[name=message_count]").each(function(){this.innerText=t.length});var a=dq("#respond_list");push_list_controller(a,t),$(a.querySelectorAll("[data-row=db_row]")).each(function(){var t=$(this).data("dataObj").id;$(this.querySelectorAll("[name=btnReply]")).each(function(){this.setAttribute("data-replyto",t)});var a=this.querySelector("[name=reply_list]"),i=e.filter(e=>e.replyto==t);material_role.message_reply_push(a,i)}),$(".grid-container").each(function(){$(this).gridQuote()}),$(".quote-container").each(function(){$(this).css("display","none")}),$(".gridName").each(function(){$(this).css("position","absolute")})}},story_detail_view_process:async function(){if(dq("#hd_thinking_data")){var e=JSON.parse(dqv("#hd_thinking_data"));this.thinking_push(e)}for(var t=dqa(".st7"),a=0;a<t.length;a++)this.story_detail_cite_check(t[a]);await this.story_detail_view(),await this.story_detail_related_list_push()},detail_view_process:async function(){var e=JSON.parse(dqv("#hd_thinking_data"));this.thinking_push(e),await this.detail_view(),await this.detail_related_list_push(),this.detail_related_doc_view_helper()},fetch_did_helper:async function(e,t){var a=0,i=[];i.push({IndexCode:e,Id:t});var r=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchSidDid",q:JSON.stringify(i)}),l=JSON.parse(r.JsonData);return cl("fetch_did_helper => fsd_list",l),l.length>0&&(a=l[0].did),a},GetPhotoPID:function(){var e=0;return location.toString().indexOf("pswg-forced&pid=")>-1&&(e=location.toString().split("pswg-forced&pid=")[1],e=parseInt(e)),e},rightInfoModalTrigger:function(){var e=dq("#hd_CustomColumns").value;if(e){e=JSON.parse(e),cl("info",e);var t=this.GetPhotoPID();$(".download-btn").unbind("click"),$(".download-btn").bind("click",function(){material_role.download_img_package_helper(t)}),e.createOrgName&&(dq("[name=info1]").innerHTML="授權人："+e.createOrgName);var a,i,r=dqv("#hd_download_image_url").split(" / "),l=dqv("#hd_DigitalRightInfo").split(" / ");a=r.length>=t?r[t-1]:r[0],i=l.length>=t?l[t-1]:l[0];var o=GetImgWidth(a),n=GetImgHeight(a),s=getImgUrlExten(a);dq(".download-btn").querySelector(".format").innerHTML=o+" x "+n+" 像素 "+s;var d="",c="";if(e.Keyword_Rights_2){var _=e.Keyword_Rights_2.split(" / ");d=_.length>=t?_[t-1]:_[0],dq("[name=info2]").innerHTML=d}var h=dq("[name=info3]").querySelector("img");if(h&&d){var u=JSON.parse(dqv("#hd_right_list")).filter(e=>e.tag==d);u.length>0&&(u=u[0],h.src="../Content/nrch/images/"+u.icon_name+".png",h.alt="licence:"+u.tag,c=u.tag+"("+u.title+")",$(h).closest("a").attr("title","數位物件授權："+c),dq(".DLcitation").innerHTML=i)}dq("[name=info2]").innerHTML=c,$("#modalDownload").modal("show"),$(".zebra_tooltips").length>0&&new $.Zebra_Tooltips($(".zebra_tooltips"))}},detail_view:async function(){var e="",t=getReq("IndexCode"),a={},i=indexconfig[0].DetailColumns,r=[];t&&(a=indexconfig.filter(e=>e.IndexCode==t)).length>0&&(i=a[0].DetailColumns,a[0].IgnoreDate&&(r=a[0].IgnoreDate)),cl("IgnoreDate",r);var l=Object.entries(i);cl("detail_view => IndexCode: "+t+" => DetailColumns",l);var o=JSON.parse(dqv("#hd_search_query"));"PCCU"==t&&o.Columns.push("ImageUrlLarge"),cl("detail_view => q",o);e=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchDetail",q:JSON.stringify(o)});if(cl("detail_view => $ret",e),e&&!e.Error){e.JsonData=JSON.parse(e.JsonData),cl("detail_view => FetchDetail => $ret",e);var n=e.JsonData,s=Object.entries(n.CustomColumns);if(s&&!(s.length<1)){cl("details",s),dq("#hd_CustomColumns").value=JSON.stringify(n.CustomColumns),n.Title=n.Title.replaceAll("\t",""),n.Title=n.Title.replaceAll("　",""),n.Title=n.Title.replaceAll("/","／"),n.Title=n.Title.replaceAll(":","："),n.Title=n.Title.replaceAll('"',"＂"),n.Title=n.Title.replaceAll("<","＜"),n.Title=n.Title.replaceAll(">","＞"),"MOCCOLLECTIONS"==t&&n.Title&&(n.Title.indexOf("<br />")>-1?n.Title=n.Title.split("<br />")[0]:n.Title.indexOf("<br>")>-1?n.Title=n.Title.split("<br>")[0]:n.Title.indexOf("<br/>")>-1&&(n.Title=n.Title.split("<br/>")[0]));var d=dqv("#hd_login_account"),c=dq("#mt001"),_=e.JsonData.Sid,h=e.JsonData.Did,u=e.JsonData.Id;if(t&&u||$(c).closest(".joinlove").hide(),h=await material_role.fetch_did_helper(t,u),$(c).bind("click",function(){material_role.detail_page_keep_click_helper(this,t,u,h)}),"member_material"==t&&this.detail_page_member_material_keep_status_helper(u),d){var p=JSON.parse(dqv("#hd_keep_query"));p.account=d,p.source=t,p.source_id=u,cl("detail_view => keep_q",p),this.detail_page_keep_status_helper(p)}this.detail_page_view_helper(n.Title,t,u,_,h),this.detail_page_keep_helper(t,u),this.detail_page_download_helper(t,u),this.detail_page_ref_helper(t,u);var m=document.querySelector("#detail_view_headline"),f=[];l[0][1].push?f=l[0][1]:f.push(l[0][1]);for(var g="",v=0;v<f.length;v++){var y=s.filter(e=>e[0]==f[v]);y.length>0&&("NULL"==(y=y[0][1].trim())&&(y=""),g+=y?y.replaceAll("\n","</p><p>").replaceAll("<br>","</p><p>"):"")}g=g?"<p>"+g+"</p>":"","drnh"==t&&g&&g.indexOf("{#")>-1&&g.indexOf("#}")>-1&&(g=g.replaceAll("{#","").replaceAll("#}",""));var S=!0;if("MOCCOLLECTIONS"==t){var q=s.filter(e=>"RightPub2"==e[0]);q.length>0&&(q=q[0][1],cl("RightPub2",q),"於文化部典藏網公開文物描述"!=q&&(S=!1))}S||(g="");var x=dq("#text_right");$(x).hide();var w=s.filter(e=>"Keyword_Des_Rights_2"==e[0]);if(x&&w.length>0){w=w[0][1];var b=(T=JSON.parse(dqv("#hd_right_list"))).filter(e=>e.tag==w);if(b.length>0){b=b[0],x.title="描述文字授權："+b.tag+"("+b.title+")",x.querySelector("img").src="../Content/nrch/images/"+b.icon_name+".png",x.querySelector("img").alt="licence:"+b.tag,$(x).show();var C=dq("#text_right_intro");C.querySelector("img").src="../Content/nrch/images/"+b.icon_name+".png",C.querySelector("img").alt="licence:"+b.tag,C.querySelector("[name=title]").innerHTML="描述文字授權："+b.tag+"("+b.title+")",C.querySelector("[name=content]").innerHTML=b.content}}g||($("#text_right").hide(),$("#info_download").hide());var I=dq("title").innerText,k=I.split("-");2!=k.length||k[0]||(dq("title").innerText=n.Title+I),m.querySelector("[name=Title]").innerHTML=n.Title,m.querySelector("[name=Description]").innerHTML=g,dq("#img_download").title="下載數位物件-"+n.Title+"_"+u+".zip",dq("#info_download").title="下載詮釋資料-"+n.Title+"_"+u+".zip";var O=s.filter(e=>"AllImages"==e[0]);O=O.length>0?O[0][1]:"","member_material"==t&&(O=n.ImageUrl),await this.detail_page_photos_helper(m,O,n);for(var D=[],T=JSON.parse(dqv("#hd_right_list")),A=O.split(" / "),N=n.CustomColumns.Keyword_Rights_2.split(" / "),L=1;L<=A.length;L++){var M=N.length>=L?N[L-1]:N[0],j=GetFullRightText(T,M),H=dq("#hd_DigitalRightInfo").value;H=(H=(H=H.replace("{$8$}",n.Title)).replace("{url}",location.toString().split("#")[0])).replace("{Keyword_Rights_2}",j),D.push(H)}var J=dq("#hd_DescRightInfo").value;J=(J=(J=J.replace("{$8$}",n.Title)).replace("{Keyword_Des_Rights_2}",GetFullRightText(T,n.CustomColumns.Keyword_Des_Rights_2))).replace("{url}",location.toString().split("#")[0]),m=document.querySelector("#detail_view_info");var R="",F="",P=[],K=1;for(v=0;v<s.length;v++){var G="",U=s[v][0],z=s[v][1];if("NTU"==t&&"Date"==U&&(z=z.replaceAll("date:","")),"NTU"==t&&"Publisher"==U&&z.indexOf('value": "')>-1&&(z=z.split('value": "')[1].split('"')[0]),"TSNCDM"==t&&"Date"==U&&(z=z.replaceAll("date:","")),"member_material"==t&&"date_material"==U&&(z.indexOf("1753")>-1&&(z=""),z.indexOf("00:00:00")>-1&&(z=z.split(" ")[0])),"NPM_Utensils"==t&&"Type"==U&&z.indexOf("^")>-1&&(z=z.split("^")[z.split("^").length-1]),"Archives"==t&&"Keywords"==U&&z.indexOf("@")>-1&&(z=z.replaceAll("@"," ")),r.indexOf(U)>-1&&(z=z.replaceAll("1900/01/01 00:00:00","")),!(f.indexOf(U)>-1)&&"Keyword_Rights_1"!=U&&"Keyword_Rights_2"!=U&&"Keyword_Des_Rights_2"!=U&&"AllImages"!=U&&"Keyword_Latitude"!=U&&"Keyword_Longitude"!=U&&"RightPub2"!=U&&"ImageUrlLarge"!=U){for(var E=0;E<D.length;E++)D[E]=D[E].replaceAll("{"+U+"}",z);if(J=J.replaceAll("{"+U+"}",z),z=z.replaceAll("@#@"," / "),"Original_Url"==U&&(z="<a href='"+z+"' target='_blank' title='（另開新視窗）' class='linkBtn' "+(z?"style='width:150px'":"style='display:none'")+" ><span>原始連結</span></a>"),0==z.indexOf("http://")||0==z.indexOf("https://"))if(z.indexOf(" / ")>-1){var B="";$(z.split(" / ")).each(function(){B+="<a target='_blank' href='"+this+"' >"+this+"</a><br />"}),z=B}else z="<a target='_blank' href='"+z+"' >"+z+"</a>";"NULL"==z.trim()&&(z=""),"[]"==z.trim()&&(z=""),"-"==z.trim()&&(z="");var Y=l.filter(e=>e[1]==U);0==Y.length&&(Y=l.filter(e=>e[1].indexOf(U)>-1)),Y.length>0&&(G=Y[0][0]);var W="";F&&F!=G?((W=P.join("<br />"))&&"0"!=W&&(R+="<dl><dt>"+F+"</dt><dd>"+W+"</dd></dl>",K++),F=G,P=[],z&&"0"!=z&&P.push(z)):(F||(F=G),z&&"0"!=z&&P.push(z)),2==K&&a.length>0&&(R+="<dl><dt>資料來源機關</dt><dd>"+a[0].IndexName+"</dd></dl>",K++)}}(W=P.join("<br />"))&&"0"!=W&&(R+="<dl><dt>"+F+"</dt><dd>"+W+"</dd></dl>"),m.innerHTML=R,dq("#hd_DigitalRightInfo").value=D.join(" / "),dq("#hd_DescRightInfo").value=J,dq("#hd_download_indexcode").value=t,dq("#hd_download_source_id").value=u;var V=s.filter(e=>"ImageUrlLarge"==e[0]);V.length>0&&(V=V[0])[1]&&V[1].trim()&&(dq("#hd_download_spec_tag").value="ImageUrlLarge",dq("#hd_download_image_url").value=V[1]);var Z=!1;if((w=s.filter(e=>"Keyword_Des_Rights_2"==e[0])).length>0&&(Z=!(!(w=w[0])[1]||"僅限公開瀏覽"==w[1].trim())),Z){var Q=[];Q.push({text:"標題",value:n.Title}),Q.push({text:"描述",value:g}),Q.push({text:"數位物件授權",value:img_right.title}),Q.push({text:"描述文字授權",value:x.title});var X=dq("#detail_view_info").querySelectorAll("dl");$(X).each(function(){"原始資料連結"==this.querySelector("dt").innerHTML.trim()?Q.push({text:this.querySelector("dt").innerHTML,value:this.querySelector("dd").querySelector("a").href}):Q.push({text:this.querySelector("dt").innerHTML,value:this.querySelector("dd").innerHTML})}),Q.push({text:"授權引用說明",value:J}),Q.push({text:"記憶庫原始網址",value:location.toString()});var ee=new Date;Q.push({text:"下載日期",value:ee.getFullYear()+"-"+(ee.getMonth()+1)+"-"+ee.getDate()}),dq("#hd_download_details").value=JSON.stringify(Q),$("#info_download").on("click",function(){material_role.detail_download_agree_trigger("info")})}else $("#info_download").hide(),x.title&&g&&($("#no_info_download").show(),$("#no_info_download").attr("title","授權為["+x.title.split("：")[1]+"]，故不提供下載"));"keep"==dqv("#hd_download_session")&&(dq("#agree-word").checked=!0),$(dq("#btnDownload")).bind("click",function(){if(!dq("#agree-word").checked)return alert("請先詳細閱讀並同意接受以上內容"),!1;ajax_post("/Home","DownloadSessionKeep");var e=dqv("#hd_download_mode");"img"==e&&material_role.download_img_package_helper(),"info"==e&&material_role.download_info_package_helper()}),this.detail_page_effect_helper();var te=s.filter(e=>"Keyword_Latitude"==e[0]);te=te.length>0?te[0][1]:"";var ae=s.filter(e=>"Keyword_Longitude"==e[0]);ae=ae.length>0?ae[0][1]:"",this.detail_map_helper(te,ae)}}else"Not Found"==e.Message&&(alert("資料不存在或已下架"),location="/Home/Index")},detail_download_agree_trigger:function(e){dq("#hd_download_mode").value=e;var t=dqv("#hd_download_mode");dq("#agree-word").checked?(ajax_post("/Home","DownloadSessionKeep"),"img"==t&&material_role.download_img_package_helper(),"info"==t&&material_role.download_info_package_helper()):("img"==t&&(dq("#btnDownload").title="下載數位物件-"+dq("[name=Title]").innerHTML+"_"+getReq("Id")+".zip"),"info"==t&&(dq("#btnDownload").title="下載詮釋資料-"+dq("[name=Title]").innerHTML+"_"+getReq("Id")+".zip"),$("#modalProblem2").modal("show"))},detail_page_effect_helper:function(){$(".photo .listshow").slick({speed:1e3,fade:!0,dots:!1,cssEase:"linear",autoplay:!1,adaptiveHeight:!0,autoplaySpeed:7e3,pauseOnFocus:!0,prevArrow:'<a class="slick-prev" href="javascript:void(0);"><span>上一張</span></a>',nextArrow:'<a class="slick-next" href="javascript:void(0);"><span>下一張</span></a>',accessibility:!0,focusOnSelect:!0}),$(".my-gallery .fancybox").jqPhotoSwipe({forceSingleGallery:!0}),$(".lightbox").fancybox({openEffect:"none",closeEffect:"none",tpl:{error:'<p class="fancybox-error">內容發生錯誤，請稍後再試，謝謝！</p>',closeBtn:'<a title="關閉相片" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="下一張相片" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="上一張相片" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'}}),morecontent_init(),$(".zebra_tooltips").length>0&&new $.Zebra_Tooltips($(".zebra_tooltips"))},detail_page_member_material_keep_status_helper:async function(e){var t=await ajax_post("/Home","MaterialAccountGet",{id:e});cl("detail_page_member_material_keep_status_helper => account",t),dqv("#hd_login_account")==t&&$("#mt001").closest(".joinlove").hide()},detail_page_keep_status_helper:async function(e){var t=await ajax_post("/Home","KeepRecordSearch",e);cl("detail_view => keep_ret",t),dq("#mt001").checked=!!t.hasData},btnKeep_status_helper:async function(e,t){if(e){var a=await ajax_post("/Home","KeepRecordSearch",t);cl("detail_view => keep_ret",a),e.checked=!!a.hasData}},import_story_view_record_helper:async function(e,t,a){var i=await material_role.fetch_did_helper(t,a),r=this.getIndexcodeName(t);cl("import_story_view_record_helper => indexcode_name",r),await ajax_post("/Home","ViewRecordAdd",{source:t,source_id:a,sid:0,did:i,title:e,indexcode_name:r,keyword:getReq("Keyword")})},detail_page_view_helper:async function(e,t,a,i,r){var l=this.getIndexcodeName(t),o=await ajax_post("/Home","ViewRecordAdd",{source:t,source_id:a,sid:i,did:r,title:e,indexcode_name:l,keyword:getReq("Keyword")});dq("[name=view_count]").innerHTML=o.data1},detail_page_keep_click_helper:async function(e,t,a,i){if(!dqv("#hd_login_account")){var r=e.checked+";"+t+";"+a+";"+i;return ajax_post("/Home","MaterialKeepSession",{v:r}),e.checked=!e.checked,$("#modalPrompt").find(".pop_login").attr("href",dqv("#hd_memberSSO")),void $("#modalPrompt").modal("show")}e.checked&&(await member_role.keep_record_add(t,a,i),member_role.keep_tag_panel_push(e)),e.checked||await member_role.keep_record_remove(t,a,i),material_role.detail_page_keep_helper(t,a)},detail_page_keep_helper:async function(e,t){var a=await ajax_post("/Home","GetKeepCount",{source:e,source_id:t});dq("[name=keep_count]")&&(dq("[name=keep_count]").innerHTML=a)},detail_page_download_helper:async function(e,t){var a=await ajax_post("/Home","GetDownloadCount",{source:e,source_id:t});dq("[name=download_count]").innerHTML=a},detail_page_ref_helper:async function(e,t){var a=await ajax_post("/Home","GetRefCount",{source:e,source_id:t});if(cl("refRet",a),a.hasData){dq("[name=ref_count]").innerHTML=a.data2;for(var i="",r=a.data1,l=0;l<r.length;l++){var o=r[l];i+=" <li><a href='/Story/Detail?IndexCode=member_story&Id="+o.id+"' target='_blank'>"+o.title+"</a></li> "}dq("#ref_list").innerHTML=i}},detail_page_photos_helper:async function(e,t,a){cl("AllImages",t);var i=getReq("IndexCode"),r=getReq("Id"),l=e.querySelector(".photo").querySelector(".listshow").innerHTML,o=[];if(t&&(t.indexOf(" / ")>-1?o=t.split(" / "):t.indexOf(";")>-1?o=t.split(";"):o.push(t)),o.length>10&&o.splice(10,o.length-10),"member_material"!=i){var n={indexcode:i,identity:r,imgUrls:o},s=await ajax_post("/Home","MaterialPhotoSpecialCheck",n);cl("MaterialPhotoSpecialCheck specRet",s),s.data1&&(o=s.data1.split(";"))}if(dq("#hd_download_image_url").value=o.join(" / "),cl("imgArr",o),o&&o.length>0){e.querySelector(".photo").querySelector(".listshow").innerHTML="",$(o).each(function(){e.querySelector(".photo").querySelector(".listshow").innerHTML+=l});var d=[];a.CustomColumns.Keyword_Rights_2&&(d=a.CustomColumns.Keyword_Rights_2.split(" / ")),dqv("#hd_member_material_img_rights_str")&&(d=dqv("#hd_member_material_img_rights_str").split("@#@"));var c="";a.CustomColumns.keyword&&(c=a.CustomColumns.keyword),a.CustomColumns.keywords&&(c=a.CustomColumns.keywords),a.CustomColumns.Keywords&&(c=a.CustomColumns.Keywords);var _=e.querySelector("[name=Description]").innerText;_&&_.length>100&&(_=_.substr(0,100)),ajax_post("/Home","ShareImageSave",{indexcode:i,identity:r,img:o[0],desc:_,img_right:d[0],keyword:c});for(var h=e.querySelector(".photo").querySelectorAll(".item"),u=0;u<h.length;u++){var p=h[u];if(p){var m=!1,f=default_img_url;if(o[u]){f=o[u];var g=getImgUrlExten(f);"Archives"==i&&(f="/ArchivesUpload/"+f),"Culture_Media"==i||videoAllowFormat.indexOf(g)>-1||audioAllowFormat.indexOf(g)>-1||f.indexOf("imedia.culture.tw/iframe")>-1?(0!=f.indexOf("http")?0==f.indexOf(dqv("#hd_upload_folder"))||(f=0==f.indexOf("//")?"https:"+f:"https://"+f):0==f.indexOf("http://")&&(f=f.replace("http://","https://")),$(p.querySelector("a")).hide(),$(p.querySelector("#media_frame")).attr("src",f),$(p.querySelector("#media_frame")).attr("title","這裡顯示"+a.Title),$(p.querySelector("#media_frame")).show(),$(p.querySelector(".pic")).attr("class","embed-container"),m=!0):"pdf"==g?(0!=f.indexOf("http")?0==f.indexOf(dqv("#hd_upload_folder"))||(f=0==f.indexOf("//")?"https:"+f:"https://"+f):0==f.indexOf("http://")&&(f=f.replace("http://","https://")),$(p.querySelector("a")).hide(),$(p.querySelector("#media_frame")).attr("src",f),$(p.querySelector("#media_frame")).attr("title","這裡顯示"+a.Title),$(p.querySelector("#media_frame")).show(),$(p.querySelector(".pic")).attr("class","embed-container"),$(p.querySelector("[name=pdf_link]")).attr("href",f),$(p.querySelector("[name=pdf_link]")).html(a.Title),$(p.querySelector("[name=pdf_link]")).removeAttr("style"),m=!0):(p.querySelector("img").src=f,p.querySelector("img").alt=a.Title,p.querySelector("a").href=f,p.querySelector("a").title="放大觀看"+a.Title,p.querySelector("a").setAttribute("class","fancybox"))}else p.querySelector("img").src=f,p.querySelector("img").alt="圖片名稱(暫無圖片)",p.querySelector("a").href=f,p.querySelector("a").title="放大觀看圖片名稱(暫無圖片)",p.querySelector("a").setAttribute("class","fancybox");var v=p.querySelector("#img_right");$(v).hide();var y=d.length>u?d[u]:d[0];if(v&&y){var S=JSON.parse(dqv("#hd_right_list")).filter(e=>e.tag==y);S.length>0&&(S=S[0],v.title="數位物件授權："+S.tag+"("+S.title+")",v.querySelector("img").src="../Content/nrch/images/"+S.icon_name+".png",v.querySelector("img").alt="licence:"+S.tag,$(v).data("dataObj",S),$(v).show()),"僅限公開瀏覽"!=S.tag||($(p).find("#img_download").hide(),v.title&&($(p).find("#no_img_download").show(),$(p).find("#no_img_download").attr("title","授權為["+v.title.split("：")[1]+"]，故不提供下載")))}m&&($(p).find("#img_download").hide(),$(p).find("#no_img_download").show(),$(p).find("#no_img_download").attr("title","本影音檔暫不提供下載，如欲下載該檔案，請與客服聯絡"))}}}},detail_img_right_intro_trigger:function(e){var t=$(e).data("dataObj");cl("rightObj",t);var a=dq("#img_right_intro");a.querySelector("img").src="../Content/nrch/images/"+t.icon_name+".png",a.querySelector("img").alt="licence:"+t.tag,a.querySelector("[name=title]").innerHTML="數位物件授權："+t.tag+"("+t.title+")",a.querySelector("[name=content]").innerHTML=t.content,$("#modalCreativecommonsPic").modal("show")},detail_map_helper:function(e,t){if(e&&t&&"NULL"!=e&&"NULL"!=t){var a=mapsPlaceholder.pop(),i=e.split(" / "),r=t.split(" / ");a.setView([i[0],r[0]]);for(var l=L.icon({iconUrl:"/Scripts/maps/images/pin24.png",iconRetinaUrl:"/Scripts/maps/images/pin48.png",iconSize:[60,50],iconAnchor:[9,21],popupAnchor:[0,-14]}),o=0;o<i.length;o++)i[o]&&r[o]&&L.marker([i[o],r[o]],{title:"",icon:l}).addTo(a)}else $("#mapbox").closest("li").hide()},share_stat_helper:async function(e){var t=getReq("IndexCode"),a=getReq("Id");if(t&&a)await ajax_post("/Home","MaterialCountNumUpdate",{indexcode:t,identity:a,countTag:"share:"+e})},download_img_package_helper:async function(e){e||(e=0);var t=dqv("#hd_download_indexcode"),a=dqv("#hd_download_source_id"),i=dqv("#hd_download_spec_tag"),r=dqv("#hd_download_image_url"),l=[];r.indexOf(" / ")>-1?l=r.split(" / "):r.indexOf(";")>-1?l=r.split(";"):l.push(r);var o={indexcode:t,identity:a,imgUrls:l,title:$(".materialIntro").find("[name=Title]").html(),spec_tag:i,infos:dqv("#hd_DigitalRightInfo").split(" / "),PID:e},n=await ajax_post("/Home","ImgPackageMaterial",o);cl("packageRet",n);var s=await ajax_post("/Home","MaterialCountNumUpdate",{indexcode:t,identity:a,countTag:"download"});dq("[name=download_count]").innerHTML=s,n.data1&&(location=n.data1)},download_info_package_helper:async function(){var e=dqv("#hd_download_indexcode"),t=dqv("#hd_download_source_id"),a={indexcode:e,identity:t,details:dqv("#hd_download_details"),title:$(".materialIntro").find("[name=Title]").html()},i=await ajax_post("/Home","InfoPackageMaterial",a);cl("packageRet",i);var r=await ajax_post("/Home","MaterialCountNumUpdate",{indexcode:e,identity:t,countTag:"info_download"});dq("[name=download_count]").innerHTML=r,location="/upload/material_package_info/"+e+"/詮釋資料-"+a.title+"_"+t+".zip"},story_detail_view:async function(){var e,t=getReq("IndexCode"),a=getReq("Id"),i=dqv("#hd_login_account"),r=JSON.parse(dqv("#hd_story")),l=dq("#mt001");if(e=await material_role.fetch_did_helper(t,a),i==r.account)$(l).closest(".joinlove").hide();else if(i){var o=JSON.parse(dqv("#hd_keep_query"));o.account=i,o.source=t,o.source_id=a,cl("detail_view => keep_q",o),this.detail_page_keep_status_helper(o)}this.detail_page_view_helper(r.title,t,a,0,e),this.detail_page_keep_helper(t,a),"PDM/CC0"==r.rights||"CC BY/政府資料開放授權條款/台中自由文化授權條款"==r.rights||"CC BY-SA相容形式"==r.rights?(dq("#hd_download_indexcode").value=t,dq("#hd_download_source_id").value=a,dq("#hd_download_image_url").value=dq(".photo").querySelector("img").src,$(dq("#btnDownload")).bind("click",function(){if(!dq("#agree-word").checked)return alert("請先詳細閱讀並同意接受以上內容"),!1;material_role.download_package_helper()})):$("#DownLoad").hide(),$(l).bind("click",function(){material_role.detail_page_keep_click_helper(this,t,a,e)})},keep_detail_check:async function(e){if(e){var t=$(e).closest("a")[0].getAttribute("href");if(t){var a=JSON.parse(dqv("#hd_detail_query"));a.IndexCode=t.split("IndexCode=")[1].split("&")[0],a.Id=t.split("Id=")[1].split("&")[0];var i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchDetail",q:JSON.stringify(a)});i&&!i.Error||"Not Found"==i.Message&&$(e).closest(".info").find("[name=disabledTag]").removeAttr("style")}}},story_detail_cite_check:async function(e){if(e){var t=$(e).closest("a")[0],a=t.getAttribute("href");if(a){var i=JSON.parse(dqv("#hd_detail_query"));i.IndexCode=a.split("IndexCode=")[1].split("&")[0],i.Id=a.split("Id=")[1].split("&")[0];var r=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchDetail",q:JSON.stringify(i)});r&&!r.Error||"Not Found"==r.Message&&(t.setAttribute("disabled",""),t.setAttribute("href","javascript:;"),t.setAttribute("title","上傳者未公開，無法查看"),new $.Zebra_Tooltips($(t)),t.querySelector(".img")&&t.querySelector(".img").setAttribute("style","background-image: url('/Content/nrch/images/nopic.png')"))}}},FetchKMap_data_push:async function(){var e=dqv("#hd_hot_keyword"),t=dqv("#hd_cache_homepage_GetKMapData"),a=JSON.parse(dqv("#hd_search_query")),i="",r="";if(t)(i=t.split("@#@")[0])&&(i=JSON.parse(i)),(r=t.split("@#@")[1])&&(r=JSON.parse(r));else{var l=await ajax_post("/Basic","GetKMapData",{q:a});cl("FetchKMap_data_push => $ret",l),(i=l.dataObj.d3config)&&(i=JSON.parse(i)),(r=l.dataObj.d3object)&&(r=JSON.parse(r))}if(!r.data||r.data.length<2)$(".graph").html("<div style='text-align:center;color:#ffcc00;font-size:16px;'>無智慧關聯提示詞</div>");else{createD3ProcessMap(".graph",".graph-container",i,r,{clickEvent:function(t){getReq("Keyword")?material_role.add_search_redirect("Keyword",t,"add"):t==e?material_role.add_search_redirect("Keyword",t,"add"):material_role.add_search_redirect("Keyword",e+" and "+t,"add")}});var o=$(".graph-container").find("line");$(o).css("fill","none").css("stroke","#666").css("stroke-width","1.5px").css("opacity","0.7").css("marker-end","url(#end)").css("transition","opacity 250ms").css("-webkit-transition","opacity 250ms"),$(dqa(".node")).each(function(){$(this).attr("style","cursor:pointer")})}},FetchSearchKeyword_data_push:async function(){getReq("Keyword");var e=JSON.parse(dqv("#hd_search_query"));e.PageSize=10,cl("FetchSearchKeyword_data_push => FetchSearchKeyword => q",e);var t=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchSearchKeyword",q:JSON.stringify(e)});if(t&&!t.Error){t.JsonData=JSON.parse(t.JsonData),cl("FetchSearchKeyword_data_push => FetchSearchKeyword => $ret",t);var a=Object.entries(t.JsonData),i=dq("#dynamicKeywordArea");if(i){for(var r="",l=0;l<a.length;l++){var o=a[l][0],n=a[l][1];r+="<li><a href='javascript:;' onclick=\"material_role.add_search_redirect('Keyword', '"+o+"', 'unique')\" >"+o+"<span>("+moneyFormat(n)+")</span></a></li>"}i.innerHTML=r}}},tagcloud_data_push:async function(){getReq("Keyword");var e=dqv("#hd_cache_homepage_FetchSearchKeyword");try{JSON.parse(e)}catch(t){e=""}var t=JSON.parse(dqv("#hd_search_query"));t.PageSize=10;var a="";if(e){i=JSON.parse(e);a=Object.entries(JSON.parse(i.JsonData))}else{var i;if(!(i=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchSearchKeyword",q:JSON.stringify(t)}))||i.Error)return;i.JsonData=JSON.parse(i.JsonData),cl("tagcloud_data_push => FetchSearchKeyword => $ret",i),a=Object.entries(i.JsonData)}for(var r=[],l=0;l<a.length;l++){var o=a[l][0],n=a[l][1];r.push({tag:o,count:n})}am4core.useTheme(am4themes_dark),am4core.useTheme(am4themes_animated);var s=am4core.create("tagCloud",am4plugins_wordCloud.WordCloud);s.fontFamily="Courier New";var d=s.series.push(new am4plugins_wordCloud.WordCloudSeries);d.randomness=.1,d.rotationThreshold=.5,d.data=r,d.dataFields.word="tag",d.dataFields.value="count",d.heatRules.push({target:d.labels.template,property:"fill",min:am4core.color("#0000CC"),max:am4core.color("#CC00CC"),dataField:"value"}),d.labels.template.url="/"+this.ControllerName+"/Result?Keyword={word}",d.labels.template.urlTarget="_self",d.labels.template.tooltipText="{word}: {value}",d.labels.template.states.create("hover").properties.fill=am4core.color("#FF0000"),s.titles.create().text="(click to open)",$("[aria-labelledby='id-50-title']").remove()},FetchDateStatistics_data_push:async function(){var e="",t=JSON.parse(dqv("#hd_search_query"));if(t.DateStatisticsType="Month",t.HaveDate=!0,(e=await ajax_post("/Home","GetWebGenieAPIData",{API_name:"FetchDateStatistics",q:JSON.stringify(t)}))&&!e.Error){e.JsonData=JSON.parse(e.JsonData),cl("FetchDateStatistics_data_push => FetchDateStatistics => $ret",e);for(var a=e.JsonData,i=[],r=[],l=(a=Object.entries(a)).length-1;l>=0;l--)i.push(a[l][0]),r.push({date:a[l][0],y:a[l][1]});Highcharts.chart("dateStatArea",{chart:{type:"bar"},title:{text:"時間序列"},xAxis:{categories:i,title:{text:"日期"}},yAxis:{min:0,title:{text:"筆數",align:"high"},labels:{overflow:"justify"}},tooltip:{},plotOptions:{bar:{dataLabels:{enabled:!0}},series:{cursor:"pointer",point:{events:{click:function(){material_role.add_search_redirect("Date",this.options.date,"replace")}}}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:160,floating:!0,borderWidth:1,backgroundColor:Highcharts.defaultOptions.legend.backgroundColor||"#FFFFFF",shadow:!0},credits:{enabled:!1},series:[{name:"筆數",turboThreshold:0,data:r}]})}}},file_info_temp=[],common_role={iCheck_AllCheck_helper:function(e){if(e){var t=e.getAttribute("data-level"),a=!e.checked,i=$(e).closest("li").parent("ul").parent("li").children("label").find("input"),r=$(e).closest("li").parent("ul").find("[data-level='"+t+"']"),l=$(e).closest("li").find("ul").find("input");if(a){if(i.length>0){for(var o=!0,n=0;n<r.length;n++)if(e.id!=r[n].id&&0==r[n].checked){o=!1;break}o&&i.iCheck("check")}l.iCheck("check")}else i.iCheck("uncheck"),l.iCheck("uncheck")}},list_push_format:function(e){return"dataObj"==e?[{tag:"date_start",format:"date"},{tag:"date_created",format:"datetime"},{tag:"date_submit",format:"datetime"}]:[]},form_push_format:function(e){return"dataObj"==e?[{tag:"intro",alias:"f_intro",format:""}]:"material"==e?[{tag:"date_material",alias:"",format:"date"}]:"story"==e?[{tag:"is_enabled",alias:"",format:"radio"},{tag:"date_story",alias:"",format:"date"}]:"chapter"==e?[{tag:"part_mode",alias:"",format:"radio"},{tag:"date_created",alias:"",format:"date"}]:"default"==e?[{tag:"is_enabled",alias:"",format:"radio"}]:[]},file_view_process_controller:function(e,t,a){switch(t){case"material_img":case"story_cover_img":case"story_chapter_img":create_role.file_view_helper(e,a);break;case"report_file":material_role.report_file_view_helper(e,a);break;case"thinking_file":case"thinking_view":material_role.thinking_file_view_helper(e,a)}},file_view_html_helper:function(e,t){var a="";if("story_img"==t&&$(e).each(function(){var e=this.oriPath?this.oriPath:"/Content/nrch/images/nopic.png";a='<span class="img" style="background-image:url(\''+e.replaceAll(" ","%20")+"')\"></span>"}),"img"==t&&$(e).each(function(){var e=this;a+="<span style='display: inline-block; padding:5px; margin-right:10px'>",a+="<a target='_blank' href='"+e.oriPath+"'><img style='width:240px;' src='"+e.path+"' align='middle' /></a>&nbsp;&nbsp;&nbsp;&nbsp;",a+="<input type='button' value='刪除' onclick='ImageRemove($(this).closest(\"[data-file_area]\"), \""+e.name+"\")' />&nbsp;&nbsp;&nbsp;&nbsp;",a+="</span>"}),"file"==t&&$(e).each(function(){var e=this;a+="<span style='display: inline-block; padding:10px; margin-right:20px'>",a+="<a target='_blank' href='"+e.path+"'>"+e.name.split("@")[e.name.split("@").length-1]+"."+e.exten+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",a+="<input type='button' value='刪除檔案' onclick='FileRemove($(this).closest(\"[data-file_area]\"), \""+e.id+"\")' />",a+="</span><br />"}),"report_file"==t&&$(e).each(function(){var e=this;a+="<li><a name='file_link' href='"+e.path+"' target='_blank' title='檢視附件檔案1.jpg（另開新視窗）'>"+e.name.split("@")[e.name.split("@").length-1]+"."+e.exten+"</a><span>("+byteconvert(e.file_size)+")</span><a href='javascript:;' class='btnDelet' onclick='FileRemove($(this).closest(\"[data-file_area]\"), \""+e.id+"\")'>刪除</a></li>"}),"thinking_view"==t){var i=1;$(e).each(function(){if(file_info_temp){var e=file_info_temp.filter(e=>e.id==this.id);e.length>0&&(this.sort=e[0].sort)}}),e.sort(function(e,t){return e.sort-t.sort}),$(e).each(function(){var e=this,t=e.name.indexOf("@")>-1?e.name.replaceAll(e.name.split("@")[0]+"@",""):e.name,r="",l="",o="";if(e.note.split(";").length>=5&&(t=e.note.split(";")[0],r=e.note.split(";")[1],l=e.note.split(";")[3],o=e.note.split(";")[4]),file_info_temp){var n=file_info_temp.filter(t=>t.id==e.id);n.length>0&&(t=n[0].title)}var s=doc_icon_helper(e.path),d=e.path;a+="<li class='opinion'>",a+="    <div class='pic'>",a+="        <a class='lightbox' rel='lightbox' href='"+d+"' data-title='"+t+"' title='"+e.exten+"檔案下載'>",a+="           <div class='img' style='background-image: url("+s.replaceAll(" ","%20")+")'></div>",a+="        </a>",a+="    </div>",a+="   <div class='dataBot'>",a+="       <span class='co1'>"+t+"</span>",a+="       <span class='co2'>"+l+"</span>",a+="       <span class='co3'>"+r+"</span>",a+="       <span class='co1'>"+o+"</span>",a+="   </div>",a+="</li>",i++}),file_info_temp=[]}if("thinking_file"==t){i=1;dq("#upload_count").innerHTML=e.length;var r=JSON.parse(dqv("#hd_right_list"));$(e).each(function(){if(file_info_temp){var e=file_info_temp.filter(e=>e.id==this.id);e.length>0&&(this.sort=e[0].sort)}}),e.sort(function(e,t){return e.sort-t.sort}),$(e).each(function(){var e=this,t=e.name.indexOf("@")>-1?e.name.replaceAll(e.name.split("@")[0]+"@",""):e.name,l="",o=dqv("#hd_login_name"),n="";if(e.note.split(";").length>=5&&(t=e.note.split(";")[0],l=e.note.split(";")[1],e.note.split(";")[2],o=e.note.split(";")[3],n=e.note.split(";")[4]),file_info_temp){var s=file_info_temp.filter(t=>t.id==e.id);s.length>0&&(t=s[0].title,l=s[0].right,o=s[0].owner,n=s[0].exif)}var d="";$(r).each(function(){d+="<option value='"+this.tag+"' "+(this.tag==l?"selected":"")+" >"+this.title+"("+this.tag+")</option>"});var c=doc_icon_helper(e.path),_=e.path;a+="<li name='file_info' data-file_id='"+e.id+"' >",a+="    <div class='pic'>",a+="        <div class='photoTop'>",a+="            <div class='checkitem'><input type='checkbox' class='addlove' id='mt00"+i+"' name='createpic' onclick=\"InsertFavorite('addlove','mt001');\"><label for='mt00"+i+"'>選取</label></div>",a+="        </div>",a+="        <a class='lightbox' rel='lightbox' href='"+_+"' data-title='"+t+"' title='"+e.exten+"檔案下載'>",a+="            <img src='"+c+"' alt='"+t+"'>",a+="        </a>",a+="   </div>",a+="   <div class='toolBox'>",a+="       <ul>",a+="           <li><label class='sr-only' for='owner'></label><input name='owner' type='text' class='formInput' value='"+o+"' placeholder='請輸入著作權人'></li>",a+="           <li><label class='sr-only' for='casepic1'></label><input name='casepic1' type='text' class='formInput' value='"+t+"' placeholder='請輸入圖片名稱'></li>",a+="           <li>",a+="               <label class='sr-only' for='authorizeRange1'>選擇授權範圍</label><select name='authorizeRange1' id='authorizeRange1' class='listBar'>",a+=d,a+="               </select>",a+="           </li>",a+="           <li><label class='sr-only' for='exif'></label><input name='exif' type='text' class='formInput' id='exif' value='"+n+"' placeholder='請輸入Exif資訊'></li>",a+="       </ul>",a+="       <div class='picTool'>",a+="           <input type='hidden' name='file_sort' data-file_id='"+e.id+"' value='"+i+"' />",a+="           <a href='javascript:();' class='tool-delete' onclick='common_role.file_info_record_helper($(this).closest(\"[data-file_area]\")); FileRemove($(this).closest(\"[data-file_area]\"), \""+e.id+"\")' title='刪除'>刪除</a>",a+="           <a href='javascript:();' class='tool-prev' onclick='material_role.thinking_upload_select_sort(this, \"prev\")' title='排序向前'>排序向前</a>",a+="           <a href='javascript:();' class='tool-next' onclick='material_role.thinking_upload_select_sort(this, \"next\")' title='排序向後'>排序向後</a>",a+="       </div>",a+="   </div>",a+="</li>",i++}),file_info_temp=[]}if("material_img"==t){i=1;dq("#upload_count").innerHTML=e.length;r=JSON.parse(dqv("#hd_ddl_rights"));$(e).each(function(){if(file_info_temp){var e=file_info_temp.filter(e=>e.id==this.id);e.length>0&&(this.sort=e[0].sort)}}),e.sort(function(e,t){return e.sort-t.sort});$(e).each(function(){var e=this,t=e.name.indexOf("@")>-1?e.name.replaceAll(e.name.split("@")[0]+"@",""):e.name,l="",o=!1,n=dqv("#hd_login_name"),s="";if(e.note.split(";").length>=5&&(t=e.note.split(";")[0],l=e.note.split(";")[1],o=e.note.split(";")[2],n=e.note.split(";")[3],s=e.note.split(";")[4]),file_info_temp){var d=file_info_temp.filter(t=>t.id==e.id);d.length>0&&(t=d[0].title,l=d[0].right,n=d[0].owner,s=d[0].exif)}var c="";c+="<option value=''>請選擇</option>",$(r).each(function(){c+="<option value='"+this.tag+"' "+(this.tag==l?"selected":"")+" >"+this.title+"("+this.tag+")</option>"});var _=doc_icon_helper(e.path),h=e.path;a+="<li name='file_info' data-file_id='"+e.id+"' >",a+="    <div class='pic'>",a+="       <div class='photoTop'>",a+="            <div class='checkitem'><input type='checkbox' class='addlove' id='mt00"+i+"' name='createpic' onclick='InsertFavorite('addlove','mt001');'><label for='mt00"+i+"'>選取</label></div>",a+="        </div>","mp4"==e.exten&&2==e.checkcode.split(";").length?(h=e.checkcode.split(";")[0],_=e.checkcode.split(";")[1].replaceAll(".png","-s.png"),a+="        <a class='lightbox'>"+mp4_iframe_helper(h+"?api_access_key=87a6fd4d-6b37-4d72-9813-90b2a72be146")+"</a>"):"mp3"==e.exten&&2==e.checkcode.split(";").length?(h=e.checkcode.split(";")[0],a+="        <a class='lightbox' rel='lightbox' href='"+h+"' data-title='"+e.name+"'>",a+="            <img src='"+_+"' alt='"+e.name+"'>",a+="        </a>"):(a+="        <a class='lightbox' rel='lightbox' href='"+h+"' data-title='"+e.name+"'>",a+="            <img src='"+_+"' alt='"+e.name+"'>",a+="        </a>"),a+="   </div>",a+="    <div class='toolBox'>",a+="       <ul>",a+="           <li><label class='sr-only' for='owner'></label><input name='owner' type='text' class='formInput' value='"+n+"' placeholder='請輸入著作權人'></li>",a+="           <li><label class='sr-only' for='casepic1'></label><input name='casepic1' type='text' class='formInput' id='casepic1' value='"+t+"' placeholder='請輸入名稱'>",a+="               <input type='hidden' name='file_sort' data-file_id='"+e.id+"' value='"+i+"' />",a+="           </li>",a+="           <li>",a+="              <label class='sr-only' for='authorizeRange1'>選擇授權範圍</label><select name='authorizeRange1' id='authorizeRange1' class='listBar'>",a+=c,a+="              </select>",a+="           </li>",a+="           <li><label class='sr-only' for='exif'></label><input name='exif' type='text' class='formInput' id='exif' value='"+s+"' placeholder='請輸入Exif資訊'></li>",a+="       </ul>",a+="     <div class='picTool'>",a+="           <span class='representBtn'>",a+="              <input type='radio' class='addlove' id='rp00"+i+"' name='representpic' "+("true"==o?"checked":"")+" onclick='InsertFavorite('addlove','rp00"+i+"');'><label for='rp00"+i+"'>代表圖</label>",a+="            </span>",a+="           <a href='javascript:();' class='tool-delete' onclick='common_role.file_info_record_helper($(this).closest(\"[data-file_area]\"));FileRemove($(this).closest(\"[data-file_area]\"), \""+e.id+"\"); ' title='刪除'>刪除</a>",a+="           <a href='javascript:();' class='tool-prev' onclick='create_role.material_upload_select_sort(this, \"prev\")' title='排序向前'>排序向前</a>",a+="           <a href='javascript:();' class='tool-next' onclick='create_role.material_upload_select_sort(this, \"next\")' title='排序向後'>排序向後</a>",a+="       </div>",a+="   </div>",a+="</li>",i++}),file_info_temp=[]}return a},file_info_record_helper:function(e){file_info_temp=[];var t=1;e.find("[name=file_info]").each(function(){var e=this.getAttribute("data-file_id"),a=t++,i="",r="",l="",o="",n="";(n=this.querySelector("[name=casepic1]"))&&(i=n.value),(n=this.querySelector("[name=authorizeRange1]"))&&(r=n.value),(n=this.querySelector("[name=owner]"))&&(l=n.value),(n=this.querySelector("[name=exif]"))&&(o=n.value),file_info_temp.push({id:e,sort:a,title:i,right:r,owner:l,exif:o})}),cl("file_info_temp",file_info_temp)},output_data_process_controller:function(e,t,a,i){if(t)switch(t){case"FilesSearch":a&&a.data1&&$(a.data1).each(function(){this.path=buildFilePath(this),this.oriPath=buildImgOriPath(this),this.date_created=transMSDate(this.date_created),this.date_modify=transMSDate(this.date_modify)});break;case"DataObjInit":case"QueryObjInit":a&&(a.date_created&&(a.date_created=transMSDate(a.date_created)),a.date_modify&&(a.date_modify=transMSDate(a.date_modify)),a.date_start&&(a.date_start=transMSDate(a.date_start)),a.date_end&&(a.date_end=transMSDate(a.date_end)),a.date_post&&(a.date_post=transMSDate(a.date_post)),a.date_story&&(a.date_story=transMSDate(a.date_story)),a.date_material&&(a.date_material=transMSDate(a.date_material)),a.date_close&&(a.date_close=transMSDate(a.date_close)));default:a&&a.hasData&&$(a.data1).each(function(){this.date_created&&(this.date_created=transMSDate(this.date_created)),this.date_modify&&(this.date_modify=transMSDate(this.date_modify)),this.date_start&&(this.date_start=transMSDate(this.date_start)),this.date_end&&(this.date_end=transMSDate(this.date_end)),this.date_post&&(this.date_post=transMSDate(this.date_post)),this.date_story&&(this.date_story=transMSDate(this.date_story)),this.date_material&&(this.date_material=transMSDate(this.date_material)),this.date_close&&(this.date_close=transMSDate(this.date_close))})}return a},front_default_pager_helper:function(e){if(e&&e.length>0){var t=front_default_pager_html(e);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(t)})}},backend_pager_helper:function(e){var t=e.data3,a=e.data2;if(t&&t.length>0){var i=admin_pager_html(t,a);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(i)})}}},paramFinder=function(e,t){var a=[];if(!e||e.indexOf("?")<0)return a;for(var i=(e=decodeURIComponent(e)).split("?")[1].split("&"),r=0;r<i.length;r++){var l=i[r].split("=")[0],o=i[r].split("=")[1];a.push({name:l,v:o})}return t&&(a=a.filter(e=>e.name==t)),a},get_pages_helper=function(e,t,a){var i=[];if(e<1)return i;var r=parseInt(Math.ceil(parseFloat(a)/parseFloat(e))),l=paramFinder(location.search),o=l.filter(e=>"p"==e.name);o.length>0&&l.splice(l.indexOf(o[0]),1);for(var n=[],s=0;s<l.length;s++)n.push(l[s].name+"="+l[s].v);var d=n.join("&");d&&(d+="&");for(s=1;s<=r;s++){var c={};c.no=s,c.text=s,c.href="?"+d+"p="+s,t==s&&(c.active="active"),i.push(c)}return i},area_data={"臺北市":["中正區","大同區","中山區","萬華區","信義區","松山區","大安區","南港區","北投區","內湖區","士林區","文山區"],"新北市":["板橋區","新莊區","泰山區","林口區","淡水區","金山區","八里區","萬里區","石門區","三芝區","瑞芳區","汐止區","平溪區","貢寮區","雙溪區","深坑區","石碇區","新店區","坪林區","烏來區","中和區","永和區","土城區","三峽區","樹林區","鶯歌區","三重區","蘆洲區","五股區"],"基隆市":["仁愛區","中正區","信義區","中山區","安樂區","暖暖區","七堵區"],"桃園市":["桃園區","中壢區","平鎮區","八德區","楊梅區","蘆竹區","龜山區","龍潭區","大溪區","大園區","觀音區","新屋區","復興區"],"新竹縣":["竹北市","竹東鎮","新埔鎮","關西鎮","峨眉鄉","寶山鄉","北埔鄉","橫山鄉","芎林鄉","湖口鄉","新豐鄉","尖石鄉","五峰鄉"],"新竹市":["東區","北區","香山區"],"苗栗縣":["苗栗市","通霄鎮","苑裡鎮","竹南鎮","頭份鎮","後龍鎮","卓蘭鎮","西湖鄉","頭屋鄉","公館鄉","銅鑼鄉","三義鄉","造橋鄉","三灣鄉","南庄鄉","大湖鄉","獅潭鄉","泰安鄉"],"臺中市":["中區","東區","南區","西區","北區","北屯區","西屯區","南屯區","太平區","大里區","霧峰區","烏日區","豐原區","后里區","東勢區","石岡區","新社區","和平區","神岡區","潭子區","大雅區","大肚區","龍井區","沙鹿區","梧棲區","清水區","大甲區","外埔區","大安區"],"南投縣":["南投市","埔里鎮","草屯鎮","竹山鎮","集集鎮","名間鄉","鹿谷鄉","中寮鄉","魚池鄉","國姓鄉","水里鄉","信義鄉","仁愛鄉"],"彰化縣":["彰化市","員林鎮","和美鎮","鹿港鎮","溪湖鎮","二林鎮","田中鎮","北斗鎮","花壇鄉","芬園鄉","大村鄉","永靖鄉","伸港鄉","線西鄉","福興鄉","秀水鄉","埔心鄉","埔鹽鄉","大城鄉","芳苑鄉","竹塘鄉","社頭鄉","二水鄉","田尾鄉","埤頭鄉","溪州鄉"],"雲林縣":["斗六市","斗南鎮","虎尾鎮","西螺鎮","土庫鎮","北港鎮","莿桐鄉","林內鄉","古坑鄉","大埤鄉","崙背鄉","二崙鄉","麥寮鄉","臺西鄉","東勢鄉","褒忠鄉","四湖鄉","口湖鄉","水林鄉","元長鄉"],"嘉義縣":["太保市","朴子市","布袋鎮","大林鎮","民雄鄉","溪口鄉","新港鄉","六腳鄉","東石鄉","義竹鄉","鹿草鄉","水上鄉","中埔鄉","竹崎鄉","梅山鄉","番路鄉","大埔鄉","阿里山鄉"],"嘉義市":["東區","西區"],"臺南市":["中西區","東區","南區","北區","安平區","安南區","永康區","歸仁區","新化區","左鎮區","玉井區","楠西區","南化區","仁德區","關廟區","龍崎區","官田區","麻豆區","佳里區","西港區","七股區","將軍區","學甲區","北門區","新營區","後壁區","白河區","東山區","六甲區","下營區","柳營區","鹽水區","善化區","大內區","山上區","新市區","安定區"],"高雄市":["楠梓區","左營區","鼓山區","三民區","鹽埕區","前金區","新興區","苓雅區","前鎮區","小港區","旗津區","鳳山區","大寮區","鳥松區","林園區","仁武區","大樹區","大社區","岡山區","路竹區","橋頭區","梓官區","彌陀區","永安區","燕巢區","田寮區","阿蓮區","茄萣區","湖內區","旗山區","美濃區","內門區","杉林區","甲仙區","六龜區","茂林區","桃源區","那瑪夏區"],"屏東縣":["屏東市","潮州鎮","東港鎮","恆春鎮","萬丹鄉","長治鄉","麟洛鄉","九如鄉","里港鄉","鹽埔鄉","高樹鄉","萬巒鄉","內埔鄉","竹田鄉","新埤鄉","枋寮鄉","新園鄉","崁頂鄉","林邊鄉","南州鄉","佳冬鄉","琉球鄉","車城鄉","滿州鄉","枋山鄉","霧台鄉","瑪家鄉","泰武鄉","來義鄉","春日鄉","獅子鄉","牡丹鄉","三地門鄉"],"宜蘭縣":["宜蘭市","羅東鎮","蘇澳鎮","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","冬山鄉","五結鄉","三星鄉","大同鄉","南澳鄉"],"花蓮縣":["花蓮市","鳳林鎮","玉里鎮","新城鄉","吉安鄉","壽豐鄉","秀林鄉","光復鄉","豐濱鄉","瑞穗鄉","萬榮鄉","富里鄉","卓溪鄉"],"臺東縣":["臺東市","成功鎮","關山鎮","長濱鄉","海端鄉","池上鄉","東河鄉","鹿野鄉","延平鄉","卑南鄉","金峰鄉","大武鄉","達仁鄉","綠島鄉","蘭嶼鄉","太麻里鄉"],"澎湖縣":["馬公市","湖西鄉","白沙鄉","西嶼鄉","望安鄉","七美鄉"],"金門縣":["金城鎮","金湖鎮","金沙鎮","金寧鄉","烈嶼鄉","烏坵鄉"],"連江縣":["南竿鄉","北竿鄉","莒光鄉","東引鄉"]},doc_icon_helper=function(e){var t=e,a=getImgUrlExten(e);return"pdf"==a&&(t="/Content/nrch/images/file_icon/pdf.png"),"mp4"==a&&(t="/Content/nrch/images/file_icon/mp4.png"),"mp3"==a&&(t="/Content/nrch/images/sketch-sound.png"),"docx"!=a&&"doc"!=a||(t="/Content/nrch/images/file_icon/docx.png"),"odt"==a&&(t="/Content/nrch/images/file_icon/odt.png"),"ods"==a&&(t="/Content/nrch/images/file_icon/ods.png"),"odp"==a&&(t="/Content/nrch/images/file_icon/odp.png"),t},mp4_iframe_helper=function(e){var t="";return e&&(t="<iframe title='這裡顯示影片名稱' name='media_iframe' scrolling='no' style='width:100%;height:100%' autoplay='false' src='"+e+"' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe>"),t};