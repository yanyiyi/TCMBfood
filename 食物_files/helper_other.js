function GetImgWidth(e){var t=new Image;return t.src=e,t.width}function GetImgHeight(e){var t=new Image;return t.src=e,t.height}var GetFullRightText=function(e,t){var a="",n=e.filter(e=>e.tag==t);return n.length>0&&(a=(n=n[0]).tag+"("+n.title+")"),a},ArrayDistinct=function(e,t,a){return a.indexOf(e)===t},common_edit_cancel=async function(e){confirm("未儲存的資料可能會遺失，確定取消?")&&(location="/Admin/"+e)},cl=function(e,t){console.log("=========="+e+"=========="),console.log(t)},dq=function(e){return document.querySelector(e)},dqa=function(e){return document.querySelectorAll(e)},dqv=function(e){return document.querySelector(e)?document.querySelector(e).value:""},ot=function(e,t){var a="";if(!e||!t)return"";var n=JSON.parse(dqv("#"+e));if(!n)return"";var r=n.filter(e=>e.value==t);return r.length>0&&(a=r[0].text),a},DataObjInit=function(e){return ajax_post("asmx/api.asmx","DataObjInit",{type:e})},QueryObjInit=function(e){return ajax_post("asmx/api.asmx","QueryObjInit",{type:e})},OptionObjInit=function(e){return ajax_post("asmx/api.asmx","OptionObjInit",{type:e})},ajax_post=function(e,t,a,n){var r=e+"/"+t;return new Promise(function(l,i){$.ajax({url:r,data:JSON.stringify(a),type:"POST",dataType:"json",cache:!1,processData:!1,contentType:"application/json; charset=utf-8",success:function(a){a=common_role.output_data_process_controller(e,t,a,n),l(a)},error:function(e){console.log(e)}})})},transMSDate=function(e){if("string"==typeof e){var t=new Date(parseInt(e.replace("/Date(","").replace(")/","")));return"17530101"==moment(t).format("YYYYMMDD")?"":t}return e},getUploadFolder=function(){var e="/upload/";return dq("#hd_upload_folder")&&(e=dqv("#hd_upload_folder")),e},buildFilePath=function(e){var t="";return"img"==e.type?t=""==e.img_size?getUploadFolder()+e._class+"/"+e.obj_id+"/"+e.name+"."+e.exten:getUploadFolder()+e._class+"/"+e.obj_id+"/"+e.name+"@"+e.img_size+"."+e.exten:"file"==e.type&&(t=getUploadFolder()+e._class+"/"+e.obj_id+"/"+e.name+"."+e.exten),t},buildImgOriPath=function(e){var t="";return"img"==e.type&&(t=getUploadFolder()+e._class+"/"+e.obj_id+"/"+e.name+"."+e.exten),t},redirectAssistant=function(e,t){var a=e;if(t&&t.length>0){a+="?";for(var n=[],r=0;r<t.length;r++)n.push(t[r].name+"="+t[r].v);a+=n.join("&")}return a=(a=a.replaceAll("<","\\<\\")).replaceAll(">","\\>\\"),encodeURI(a)},paramHelper=function(e,t,a){if(e){var n=paramFinder(location.href);if(t&&t.length>0)for(var r=0;r<t.length;r++){var l=n.filter(e=>e.name==t[r]);if(l.length>0){l=l[0];var i=n.indexOf(l);i>-1&&n.splice(i,1)}}if(a&&a.length>0)for(r=0;r<a.length;r++)n.push({name:a[r][0],v:a[r][1]});return redirectAssistant(e,n)}};String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)};var getReq=function(e,t){var a=location.search;if(t&&(a=t),e=new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(a))return decodeURIComponent(e[1])},optionCreater=function(e,t){return"<option value='"+e+"'>"+t+"</option>"},langTrans=function(e){var t=e;return langObj[e]&&(t=langObj[e]),t},moneyFormat=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},pagerHelper=function(e,t){if(1==t.pager){var a=e.data3,n=e.data2;if(a&&a.length>0){var r="";if("front"==t.end&&front_pager_html2(a,n),"back"==t.end){r=admin_pager_html(a,n);r=admin_pager_html(a,n);$("[name=pager]").length>0&&$("[name=pager]").each(function(){$(this).html(r)})}}}},admin_pager_html=function(e,t){if(e.length<1||t<1)return"";var a=0,n=e.filter(e=>"active"==e.active);n.length>0&&(a=(n=n[0]).no);var r="",l=a-1;l<1&&(l=1),r+="<li class='page-item "+(u=e[l-1]).active+"'><a href='"+u.href+"' aria-label='Previous' class='page-link'><span aria-hidden='true'>«</span><span class='sr-only'>Previous</span></a></li>";var i=a-1,c=e.length-a,o=0,s=0;5==i&&4==c&&(o=1,s=10),5==i&&c>4&&(o=1,s=10),5==i&&c<4&&(o=1,s=e.length),i>5&&4==c&&(o=e.length-9,s=e.length),i>5&&c>4&&(o=a-5,s=a+4),i>5&&c<4&&(o=e.length-9,s=e.length),i<5&&4==c&&(o=1,s=e.length),i<5&&c>4&&(o=1,s=10),i<5&&c<4&&(o=1,s=e.length),o<1&&(o=1),s>e.length&&(s=e.length);for(var h=o;h<=s;h++){var u,p="href="+(u=e[h-1]).href;r+="<li class='page-item "+u.active+"'><a "+p+" class='page-link'>"+u.no+"</a></li>"}var g=a+1;return g>e.length&&(g=e.length),r+="<li class='page-item "+(u=e[g-1]).active+"'><a href='"+u.href+"' aria-label='Next' class='page-link'><span aria-hidden='true'>»</span><span class='sr-only'>Next</span></a></li>"},front_default_pager_html=function(e){if(e.length<1)return"";var t=0,a=e.filter(e=>"active"==e.active);a.length>0&&(t=(a=a[0]).no);var n="",r="";n+="<a href='javascript:;' onclick=\"material_role.add_search_redirect('p', '"+(r=e[0]).no+"', 'replace')\" class='btn-first'>最前頁</a>";var l=t-1;l<1&&(l=1),n+="<a href='javascript:;' onclick=\"material_role.add_search_redirect('p', '"+(r=e[l-1]).no+"', 'replace')\" class='btn-prev'>上一頁</a>";var i=t-1,c=e.length-t,o=0,s=0;5==i&&4==c&&(o=1,s=10),5==i&&c>4&&(o=1,s=10),5==i&&c<4&&(o=1,s=e.length),i>5&&4==c&&(o=e.length-9,s=e.length),i>5&&c>4&&(o=t-5,s=t+4),i>5&&c<4&&(o=e.length-9,s=e.length),i<5&&4==c&&(o=1,s=e.length),i<5&&c>4&&(o=1,s=10),i<5&&c<4&&(o=1,s=e.length),o<1&&(o=1),s>e.length&&(s=e.length);for(var h=o;h<=s;h++){r=e[h-1];n+=t==h?"<span class='cur'>"+r.no+"</span>":"<a href='javascript:;' onclick=\"material_role.add_search_redirect('p', '"+r.no+"', 'replace')\">"+r.no+"</a>"}var u=t+1;return u>e.length&&(u=e.length),n+="<a href='javascript:;' onclick=\"material_role.add_search_redirect('p', '"+(r=e[u-1]).no+"', 'replace')\" class='btn-next'>下一頁</a>",n+="<a href='javascript:;' onclick=\"material_role.add_search_redirect('p', '"+(r=e[e.length-1]).no+"', 'replace')\" class='btn-last'>最末頁</a>"},front_default_pager_html2=function(e){if(e.length<1)return"";var t=0,a=e.filter(e=>"active"==e.active);a.length>0&&(t=(a=a[0]).no);var n="",r="";n+="<a href='"+(r=e[0]).href+"' class='btn-first'>最前頁</a>";var l=t-1;l<1&&(l=1),n+="<a href='"+(r=e[l-1]).href+"' class='btn-prev'>上一頁</a>";var i=t-1,c=e.length-t,o=0,s=0;5==i&&4==c&&(o=1,s=10),5==i&&c>4&&(o=1,s=10),5==i&&c<4&&(o=1,s=e.length),i>5&&4==c&&(o=e.length-9,s=e.length),i>5&&c>4&&(o=t-5,s=t+4),i>5&&c<4&&(o=e.length-9,s=e.length),i<5&&4==c&&(o=1,s=e.length),i<5&&c>4&&(o=1,s=10),i<5&&c<4&&(o=1,s=e.length),o<1&&(o=1),s>e.length&&(s=e.length);for(var h=o;h<=s;h++){r=e[h-1];n+=t==h?"<span class='cur'>"+r.no+"</span>":"<a href='"+r.href+"'>"+r.no+"</a>"}var u=t+1;return u>e.length&&(u=e.length),n+="<a href='"+(r=e[u-1]).href+"' class='btn-next'>下一頁</a>",n+="<a href='"+(r=e[e.length-1]).href+"' class='btn-last'>最末頁</a>"},backend_menu_push=function(){var e="",t="",a="";if(admin_parent_menu.filter(e=>e.url.toLowerCase()==location.pathname.toLowerCase()).length>0&&(t=admin_parent_menu.filter(e=>e.url.toLowerCase()==location.pathname.toLowerCase())[0]),admin_child_menu.filter(e=>e.url.toLowerCase()==location.pathname.toLowerCase()).length>0){var n=getReq("tag");a=(a=n?admin_child_menu.filter(e=>e.url.toLowerCase()==location.pathname.toLowerCase()&&e.tag==n):admin_child_menu.filter(e=>e.url.toLowerCase()==location.pathname.toLowerCase())).length>0?a[0]:"",admin_parent_menu.filter(e=>e.c==a.p).length>0&&(t=admin_parent_menu.filter(e=>e.c==a.p)[0])}cl("backend_menu . parent_node",t),cl("backend_menu . child_node",a);var r=[],l=document.querySelector("#manager_scope").value;if("admin"!=l)for(var i=l.split(";"),c=0;c<i.length;c++){var o=admin_parent_menu.filter(e=>e.c==i[c]);o.length>0&&r.push(o[0])}else r=admin_parent_menu;e+="<ul>",$(r).each(function(){var a="";if(this.url)a=this.tag?this.url+"?tag="+this.tag:this.url;else{var n=admin_child_menu.filter(e=>e.p==this.c);n.length>0&&(a=(n=n[0]).tag?n.url+"?tag="+n.tag:n.url)}e+="<li>",e+="<a href="+a+" "+(t==this?"style=background:#FFF":"")+">"+this.name+"</a>",e+="</li>"}),e+="</ul>",1==$("[name=main_menu]").length&&$("[name=main_menu]").html(e),e="",t&&(admin_child_menu=admin_child_menu.filter(e=>e.p==t.c),$(admin_child_menu).each(function(){if(this.view){var t=role_param.unit!=this.unit||getReq("tag")&&getReq("tag")!=this.tag?"":"style=background:#E1E3B0";e+="<li>",e+="<a href="+(this.tag?this.url+"?tag="+this.tag:this.url)+" "+t+">"+this.name+"</a>",e+="</li>"}}),1==$("[name=sub_menu]").length&&$("[name=sub_menu]").html(e))},alert_push2=function(e,t){$("#"+e+" [data-alert]").each(function(){$(this).html("");var a=$(this).attr("data-alert"),n=$("#"+e).find("#"+a),r=t.get(a),l="",i=0;"lang_type"!=a&&"lang_proficiency"!=a||((l=$(this).closest("div").attr("data-row"))&&(i=l.split("_")[2]),n=$("[data-row="+l+"]").find("#"+a),r=t.get(a+"_"+i),cl("alert_push2 . inputByTag","[data-row="+l+"] #"+a)),1==n.length&&(n.attr("class")&&("agree"==a?n.removeClass("checkbox_alert"):n.removeClass("required-border")),r&&r.length>0&&($(this).html(r.join(", ")),"agree"==a?n.addClass("checkbox_alert"):n.addClass("required-border"))),"summary"==a&&r&&r.length>0&&$(this).html(r.join(", "))})},CovertErrorResultToMap=function(e){var t=new Map;if(null!=e)for(var a=0;a<e.length;a++){for(var n=e[a],r=0;r<n.checkResult.length;r++)n.checkResult[r]=langTrans("error_"+n.checkResult[r]);t.set(n.checkTag,n.checkResult)}return t},all_row_check=function(e){var t=$(e).prop("checked");$("[name=ckb_delete]").each(function(){$(this).prop("checked",t)})},user_login_update_captcha=function(){update_captcha("user_login")},user_contact_update_captcha=function(){update_captcha("user_contact")},admin_login_update_captcha=function(){update_captcha("admin_login")},update_captcha=async function(e){var t=await ajax_post("Shared","UpdateCaptchaCode",{tag:e},null);cl("UpdateCaptchaCode",t),t&&t.isSuccess&&1==$("#captcha_img").length&&$("#captcha_img").attr("src",t.data1)},captcha_voice=function(e){setTimeout(function(){captcha_pos_voice(e,1)},900),setTimeout(function(){captcha_pos_voice(e,2)},1800),setTimeout(function(){captcha_pos_voice(e,3)},2700),setTimeout(function(){captcha_pos_voice(e,4)},3600)},captcha_pos_voice=async function(e,t){var a=await ajax_post("Shared","GetCaptchaVoice",{tag:e,pos:t},null);a&&a.isSuccess&&($("#myaudio").attr("src","https://eyemail.ey.gov.tw/WWW/sound/"+a.data1+".mp3"),document.getElementById("myaudio").play())},httpsRedirect=function(){cl("location",location),0==location.href.indexOf("http://")&&(location=location.href.replace("http://","https://"))},element_startup=function(){for(var e=document.querySelectorAll("[data-startup]"),t=0;t<e.length;t++){var a=e[t];$(a).show()}},getImgUrlExten=function(e){return e?e.split(".")[e.split(".").length-1].toLowerCase():e};