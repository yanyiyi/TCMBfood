var init_controller=async function(){var e=document.querySelectorAll("[data-init]");if(e.length>0)for(var t=0;t<e.length;t++){var r=e[t],a=r.getAttribute("data-init");if(a){if(a.indexOf("member_selectize:")>-1){var l=a.split(":")[1],o=JSON.parse($("[id*=hd_member_opts]").val());$(r).selectize({maxItems:l,valueField:"value",labelField:"text",searchField:"text",options:o,create:!1})}if("ckeditor"==a&&CKEDITOR.replace(r.name,{filebrowserImageBrowseUrl:"../Scripts/ckeditor/ckfinder/ckfinder.html?type=Images"}),"datepicker"==a&&$(r).datepicker({dateFormat:"yy/mm/dd"}),"datetimepicker"==a&&$(r).datetimepicker({dateFormat:"yy/mm/dd",timeFormat:"HH:mm"}),"timepicker"==a&&$(r).datetimepicker({format:"HH:mm"}),"ddl_y"==a){for(var i=new Date,n=optionCreater(0,langTrans("O6")),c=i.getFullYear();c>=i.getFullYear()-100;c--)n+=optionCreater(c,c);r.innerHTML=n}if("ddl_m"==a){for(i=new Date,n=optionCreater(0,langTrans("O7")),c=1;c<=12;c++)n+=optionCreater(c,c);r.innerHTML=n}if("ddl_d"==a){for(i=new Date,n=optionCreater(0,langTrans("O8")),c=1;c<=31;c++)n+=optionCreater(c,c);r.innerHTML=n}if(a.indexOf("ddl:")>-1){var u=a.split(":")[1],f=document.querySelector("[id*=hd_ddl_"+u+"]");if(!(o=f?JSON.parse(f.value):[])||o.length<1)return;for(n="",c=0;c<o.length;c++)n+=optionCreater(o[c].value,o[c].text);r.innerHTML=n}if(a.indexOf("ckb:")>-1){u=a.split(":")[1];if(!(o=await OptionObjInit(u))||o.length<1)return;for(n="",c=0;c<o.length;c++)n+=checkboxOptionCreater(r.getAttribute("data-name"),o[c].value,o[c].text);r.innerHTML=n}if(a.indexOf("form_data_init:")>-1){u=a.split(":")[1];var m=JSON.parse($("[id*=hd_"+u+"]").val());if(!m)return;m=common_role.output_data_process_controller(null,"DataObjInit",m,null),push_form_controller(r,m,common_role.form_push_format(u))}if("access_units"==a){var d="";for(c=0;c<admin_parent_menu.length;c++){var p=admin_parent_menu[c];u="u"+p.c;9!=p.c&&(d+="<input name='"+u+"' id='"+u+"' value='"+p.c+"' type='checkbox' /><label for='"+u+"'>"+p.name+"</label>&nbsp;&nbsp;")}r.innerHTML=d,$(r).hide()}}}},get_all_options_by_unit=async function(e){if(e&&!(e.length<1)){for(var t=0;t<e.length;t++){var r=e[t],a=await OptionObjInit(r);role_option_map&&0==role_option_map.has(r)&&role_option_map.set(r,a)}cl("role_option_map",role_option_map)}},push_value_controller=function(e,t,r,a){if(e&&t){if(a||(a="text"),"ckeditor"==a)(d=e.querySelector("[name="+t+"]"))&&CKEDITOR.instances[t].setData(r);if("date"==a)r&&(r=new Date(r)),(d=e.querySelector("[name="+t+"]"))?(r&&(r=moment(r).format("YYYY-MM-DD")),"0001/01/01"==r&&(r=""),d.value=r,$(d).html(r)):((d=e.querySelector("[name="+t+"_y]"))&&(d.value=r.getFullYear()),(d=e.querySelector("[name="+t+"_m]"))&&(d.value=r.getMonth()+1),(d=e.querySelector("[name="+t+"_d]"))&&(d.value=r.getDate()));if("datetime"==a){if(!r)return;r=new Date(r),(d=e.querySelector("[name="+t+"]"))&&(r=moment(r).format("YYYY-MM-DD HH:mm"),d.value=r,$(d).html(r))}if("time"==a){if(!r)return;r=new Date(r),(d=e.querySelector("[name="+t+"]"))&&(r=moment(r).format("HH:mm"),d.value=r,$(d).html(r))}if("radio"==a)if(e.id.indexOf("form")>-1)(d=e.querySelector("[name='"+t+"'][value='"+r+"']"))&&(d.checked=!0);else(d=e.querySelector("[name="+t+"]"))&&$(d).html(r);if("checkbox"==a)(d=e.querySelector("[name='"+t+"']"))&&(d.checked=1==r);if("checkboxes"==a){r=r.split(",");for(var l=0;l<r.length;l++){(d=e.querySelector("[name='"+t+"'][value='"+r[l]+"']"))&&(d.checked=!0)}}if("text"==a)if(d=e.querySelector("[name="+t+"]")){if(d.value=r,"SELECT"==d.tagName)return;$(d).html(r)}if("money"==a)r=moneyFormat(r),(d=e.querySelector("[name="+t+"]"))&&(d.value=r,$(d).html(r));if("textarea"==a)(d=e.querySelector("[name="+t+"]"))&&$(d).html(r);if("html"==a)(d=e.querySelector("[name="+t+"]"))&&$(d).html(r.replaceAll("\n","<br />"));if("link_spec1"==a){var o=e.querySelector("input[name=tag]"),i=e.querySelector("select[name=tag]");["_web","_signup","_act"].indexOf(r)>-1?(o.remove(),i.value=r,i.setAttribute("style","")):(o.value=r,o.setAttribute("style",""),i.remove())}if("scope"==a)if(e.id.indexOf("form")>-1){var n=e.querySelector("[name=scope_type]");if(!n)return;if("admin"==r)n.value=r;else{n.value="",n.onchange();var c=e.querySelector("#access_units");if(!c)return;var u=r.split(";");for(l=0;l<u.length;l++){(d=c.querySelector("[type='checkbox'][value='"+u[l]+"']"))&&(d.checked=!0)}}}else{(d=e.querySelector("[name="+t+"]"))&&$(d).html(r)}if("option_text"==a)if(d=e.querySelector("[name="+t+"]")){var f=d.getAttribute("data-option");if(role_option_map&&role_option_map.has(f)){var m=role_option_map.get(f).filter(e=>e.value==r);1==m.length&&(r=m[0].text)}$(d).html(r)}if("login_record"==a){var d;if(!(d=document.querySelector("#login_record"))||!r||r.length<1)return;var p="";for(l=0;l<r.length;l++){var v=r[l];p+="IP: "+v.ip+" - "+moment(v.login_time).format("YYYY/MM/DD HH:mm:ss")+"<br />"}d.innerHTML=p}}},pull_value_controller=function(e,t,r,a){if(e&&t){var l;if(a||(a="text"),"ckeditor"==a)(l=e.querySelector("[name="+t+"]"))&&(r=CKEDITOR.instances[t].getData());if("date"==a)(l=e.querySelector("[name="+t+"]"))&&(r=l.value);if("datetime"==a)(l=e.querySelector("[name="+t+"]"))&&(r=l.value);if("time"==a)(l=e.querySelector("[name="+t+"]"))&&(r=l.value);if("radio"==a)(l=e.querySelector("[name='"+t+"']:checked"))&&(r=l.value);if("checkbox"==a)(l=e.querySelector("[name='"+t+"']"))&&(r=l.checked?1:0);if("checkboxes"==a){var o=e.querySelectorAll("[type=checkbox][name='"+t+"']"),i=[];o.forEach(function(e){e.checked&&i.push(e.value)}),r=i.join(",")}if("text"==a)(l=e.querySelector("[name="+t+"]"))&&(r=l.value),r&&(r=r.toString().trim());if("money"==a)(l=e.querySelector("[name="+t+"]"))&&(r=l.value.replaceAll(",",""));if("link_spec1"==a){var n=e.querySelector("input[name=tag]"),c=e.querySelector("select[name=tag]");n&&(r=n.value),c&&(r=c.value)}if("scope"==a){var u=e.querySelector("[name=scope_type]");if(u)if("admin"==u.value)r=u.value;else{var f=e.querySelector("#access_units");if(f){for(var m=[],d=f.querySelectorAll("[type=checkbox]:checked"),p=0;p<d.length;p++)m.push(d[p].value);r=m.join(";")}}}if("selectize"==a)if(l=e.querySelector("[name="+t+"]")){var v=[],s=l.querySelectorAll("option");if(s.length>0)for(p=0;p<s.length;p++)v.push(s[p].value);r=v.join(",")}return r}},push_form_controller=function(e,t,r){if(e){$(e).data("dataObj",t),t=Object.entries(t);for(var a=0;a<t.length;a++){var l=t[a],o=l[0],i=l[1],n=!1;if(r&&r.length>0){var c=r.filter(e=>e.tag==o);if(1==c.length){c=c[0];var u=o;c.alias&&(u=c.alias),push_value_controller(e,u,i,c.format),n=!0}}0==n&&push_value_controller(e,o,i)}}},push_list_controller=function(e,t,r,a){if(e){t.length>0?($("#data_empty_tip").hide(),$(e).show()):($("#data_empty_tip").show(),$(e).hide()),$(e).find("[data-row=db_row]").each(function(){$(this).remove()});var l=$(e).find("[data-row=temp_row]");if(1==l.length){var o=1;$(t).each(function(){var t=this,r=l.clone();r.show(),r.attr("data-row","db_row"),r.attr("data-index",o++),r.data("dataObj",t),t=Object.entries(t);for(var i=0;i<t.length;i++){var n=t[i],c=n[0],u=n[1],f=!1;if(a&&a.length>0){var m=a.filter(e=>e.tag==c);1==m.length&&(m=m[0],push_value_controller(r[0],c,u,m.format),f=!0)}0==f&&push_value_controller(r[0],c,u)}$(e).append(r)})}}},form_clear=function(e){e&&(e.querySelectorAll("input[type=text]").forEach(function(e){e.value=""}),e.querySelectorAll("input[type=email]").forEach(function(e){e.value=""}),e.querySelectorAll("input[type=password]").forEach(function(e){e.value=""}),e.querySelectorAll("textarea").forEach(function(e){e.value=""}),e.querySelectorAll("select").forEach(function(e){var t=e.querySelector("option:eq(0)");t&&(e.value=t.value)}))},form_disabled=function(e){if(e){for(var t=e.querySelectorAll("input[type=text]"),r=0;r<t.length;r++)t[r].disabled=!0;for(t=e.querySelectorAll("input[type=email]"),r=0;r<t.length;r++)t[r].disabled=!0;for(t=e.querySelectorAll("input[type=password]"),r=0;r<t.length;r++)t[r].disabled=!0;for(t=e.querySelectorAll("textarea"),r=0;r<t.length;r++)t[r].disabled=!0;for(t=e.querySelectorAll("select"),r=0;r<t.length;r++)t[r].disabled=!0;for(t=e.querySelectorAll("input[type=checkbox]"),r=0;r<t.length;r++)t[r].disabled=!0;for(t=e.querySelectorAll("input[type=radio]"),r=0;r<t.length;r++)t[r].disabled=!0}},ddl_trigger=function(e,t){if(e&&t){var r=e.getAttribute("data-init");if(r){var a=r.split(":")[1],l=document.querySelector("[id*=hd_ddl_"+a+"]"),o=l?JSON.parse(l.value):[];o=o.filter(e=>0==e.p||e.p==t);for(var i="",n=0;n<o.length;n++)i+=optionCreater(o[n].value,o[n].text);e.innerHTML=i}}},ddl_trigger_unit=function(e,t){if(e&&t){var r=e.querySelector("[name="+t+"]");if(r){var a=e.querySelector("[name=unit_level]");if(a){a=a.value;var l=e.querySelector("[name=city]");if(l){l=l.value;var o=r.getAttribute("data-init");if(o){var i=o.split(":")[1],n=document.querySelector("[id*=hd_ddl_"+i+"]"),c=n?JSON.parse(n.value):[];c=c.filter(e=>0==e.p||e.p==a&&e.tag.indexOf(l)>-1);for(var u="",f=0;f<c.length;f++)u+=optionCreater(c[f].value,c[f].text);r.innerHTML=u}}}}}};